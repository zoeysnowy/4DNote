<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>4DNote æ•°æ®æµæµ‹è¯•å·¥å…·</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
      color: #333;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      overflow: hidden;
    }

    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .header h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
    }

    .header p {
      font-size: 1.1em;
      opacity: 0.9;
    }

    .content {
      padding: 30px;
    }

    .info-card {
      background: #f8f9fa;
      border-left: 4px solid #667eea;
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 4px;
    }

    .info-card h3 {
      color: #667eea;
      margin-bottom: 10px;
    }

    .info-card ul {
      list-style: none;
      padding-left: 0;
    }

    .info-card ul li {
      padding: 5px 0;
      padding-left: 20px;
      position: relative;
    }

    .info-card ul li:before {
      content: "âœ“";
      position: absolute;
      left: 0;
      color: #667eea;
      font-weight: bold;
    }

    .button-group {
      display: flex;
      gap: 15px;
      margin-bottom: 30px;
    }

    .btn {
      flex: 1;
      padding: 15px 30px;
      font-size: 1.1em;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 600;
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
    }

    .btn-secondary {
      background: #6c757d;
      color: white;
    }

    .btn-secondary:hover {
      background: #5a6268;
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .console-output {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 20px;
      border-radius: 8px;
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 14px;
      max-height: 600px;
      overflow-y: auto;
      white-space: pre-wrap;
      word-wrap: break-word;
    }

    .console-output:empty:before {
      content: "ç‚¹å‡»ã€Œå¼€å§‹æµ‹è¯•ã€æŒ‰é’®è¿è¡Œæµ‹è¯•...";
      color: #858585;
    }

    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid #f3f3f3;
      border-top: 3px solid #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-right: 10px;
      vertical-align: middle;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .status {
      padding: 10px 20px;
      border-radius: 4px;
      margin-bottom: 20px;
      font-weight: 500;
    }

    .status.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .status.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .status.info {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }

    .footer {
      background: #f8f9fa;
      padding: 20px;
      text-align: center;
      color: #6c757d;
      border-top: 1px solid #dee2e6;
    }

    .test-modules {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }

    .module-card {
      background: white;
      border: 2px solid #e9ecef;
      border-radius: 8px;
      padding: 15px;
      transition: all 0.3s;
    }

    .module-card:hover {
      border-color: #667eea;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
    }

    .module-card h4 {
      color: #667eea;
      margin-bottom: 5px;
    }

    .module-card p {
      font-size: 0.9em;
      color: #6c757d;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ§ª 4DNote æ•°æ®æµæµ‹è¯•å·¥å…·</h1>
      <p>å…¨é¢éªŒè¯å­˜å‚¨æ¶æ„ä¸æ¨¡å—æ•°æ®æµçš„å®Œæ•´æ€§</p>
    </div>

    <div class="content">
      <div class="info-card">
        <h3>ğŸ“‹ æµ‹è¯•èŒƒå›´</h3>
        <div class="test-modules">
          <div class="module-card">
            <h4>1. å­˜å‚¨æ¶æ„</h4>
            <p>IndexedDB + SQLite + LRU Cache</p>
          </div>
          <div class="module-card">
            <h4>2. EventService Hub</h4>
            <p>CRUD + äº‹ä»¶å¹¿æ’­</p>
          </div>
          <div class="module-card">
            <h4>3. EventHub</h4>
            <p>å†…å®¹/æ ‡ç­¾/é™„ä»¶ç®¡ç†</p>
          </div>
          <div class="module-card">
            <h4>4. TimeHub</h4>
            <p>æ—¶é—´/è®¡æ—¶å™¨ç®¡ç†</p>
          </div>
          <div class="module-card">
            <h4>5. ContactService</h4>
            <p>è”ç³»äººç®¡ç†</p>
          </div>
          <div class="module-card">
            <h4>6. TagService</h4>
            <p>æ ‡ç­¾ç®¡ç†</p>
          </div>
          <div class="module-card">
            <h4>7. EventTree</h4>
            <p>çˆ¶å­äº‹ä»¶å±‚çº§</p>
          </div>
          <div class="module-card">
            <h4>8. åŒå‘é“¾æ¥</h4>
            <p>äº‹ä»¶å…³ç³»ç½‘ç»œ</p>
          </div>
          <div class="module-card">
            <h4>9. è·¨æ¨¡å—è”åŠ¨</h4>
            <p>å®Œæ•´äº‹ä»¶ç”Ÿå‘½å‘¨æœŸ</p>
          </div>
          <div class="module-card">
            <h4>10. æ€§èƒ½æµ‹è¯•</h4>
            <p>æ‰¹é‡æ“ä½œéªŒè¯</p>
          </div>
        </div>
      </div>

      <div class="info-card">
        <h3>âš™ï¸ ä½¿ç”¨è¯´æ˜</h3>
        <ul>
          <li>ç¡®ä¿ 4DNote åº”ç”¨å·²å¯åŠ¨ï¼ˆæœ¬æµ‹è¯•é¡µé¢éœ€è¦è®¿é—®åº”ç”¨çš„å…¨å±€å¯¹è±¡ï¼‰</li>
          <li>ç‚¹å‡»ã€Œå¼€å§‹æµ‹è¯•ã€æŒ‰é’®è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶</li>
          <li>æµ‹è¯•ä¼šåˆ›å»ºå°‘é‡ä¸´æ—¶æ•°æ®ï¼ˆçº¦ 60 ä¸ªäº‹ä»¶ï¼‰ï¼Œæµ‹è¯•åè‡ªåŠ¨æ¸…ç†</li>
          <li>æŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºäº†è§£è¯¦ç»†æµ‹è¯•è¿‡ç¨‹</li>
          <li>æµ‹è¯•å®Œæˆåä¼šæ˜¾ç¤ºé€šè¿‡ç‡å’Œå¤±è´¥é¡¹</li>
        </ul>
      </div>

      <div class="button-group">
        <button class="btn btn-primary" id="runTestBtn" onclick="runTest()">
          ğŸš€ å¼€å§‹æµ‹è¯•
        </button>
        <button class="btn btn-secondary" id="clearBtn" onclick="clearConsole()">
          ğŸ—‘ï¸ æ¸…ç©ºè¾“å‡º
        </button>
      </div>

      <div id="statusContainer"></div>

      <h3 style="margin-bottom: 15px;">ğŸ“Š æµ‹è¯•è¾“å‡º</h3>
      <div class="console-output" id="consoleOutput"></div>
    </div>

    <div class="footer">
      <p>4DNote v1.3.0 - å››ç»´æ—¶é—´ç®¡ç†ç³»ç»Ÿ</p>
      <p style="margin-top: 5px; font-size: 0.9em;">Made with â¤ï¸ by the 4DNote Team</p>
    </div>
  </div>

  <script>
    // æ•è· console.log è¾“å‡º
    const originalLog = console.log;
    const originalError = console.error;
    const originalWarn = console.warn;
    const consoleOutput = document.getElementById('consoleOutput');

    function formatLogMessage(type, args) {
      const timestamp = new Date().toLocaleTimeString();
      let message = `[${timestamp}] `;
      
      // æ ¹æ®ç±»å‹æ·»åŠ é¢œè‰²
      const colors = {
        log: '#d4d4d4',
        error: '#f48771',
        warn: '#dcdcaa',
        info: '#4fc3f7',
        success: '#4caf50',
      };

      const color = colors[type] || colors.log;
      
      // æ ¼å¼åŒ–å‚æ•°
      const formatted = args.map(arg => {
        if (typeof arg === 'object') {
          return JSON.stringify(arg, null, 2);
        }
        return String(arg);
      }).join(' ');

      return `<span style="color: ${color}">${message}${formatted}</span>\n`;
    }

    console.log = function(...args) {
      consoleOutput.innerHTML += formatLogMessage('log', args);
      consoleOutput.scrollTop = consoleOutput.scrollHeight;
      originalLog.apply(console, args);
    };

    console.error = function(...args) {
      consoleOutput.innerHTML += formatLogMessage('error', args);
      consoleOutput.scrollTop = consoleOutput.scrollHeight;
      originalError.apply(console, args);
    };

    console.warn = function(...args) {
      consoleOutput.innerHTML += formatLogMessage('warn', args);
      consoleOutput.scrollTop = consoleOutput.scrollHeight;
      originalWarn.apply(console, args);
    };

    // åŠ è½½æµ‹è¯•è„šæœ¬
    const script = document.createElement('script');
    script.src = '/test-data-flow-complete.js';
    script.onload = () => {
      console.log('âœ… æµ‹è¯•è„šæœ¬åŠ è½½æˆåŠŸ');
      showStatus('info', 'æµ‹è¯•è„šæœ¬å·²åŠ è½½ï¼Œç‚¹å‡»ã€Œå¼€å§‹æµ‹è¯•ã€æŒ‰é’®è¿è¡Œæµ‹è¯•');
    };
    script.onerror = () => {
      console.error('âŒ æµ‹è¯•è„šæœ¬åŠ è½½å¤±è´¥ï¼Œè¯·å°è¯•åˆ·æ–°é¡µé¢');
      showStatus('error', 'æµ‹è¯•è„šæœ¬åŠ è½½å¤±è´¥ï¼Œè¯·å°è¯•åˆ·æ–°é¡µé¢');
    };
    document.head.appendChild(script);

    function showStatus(type, message) {
      const statusContainer = document.getElementById('statusContainer');
      statusContainer.innerHTML = `<div class="status ${type}">${message}</div>`;
    }

    async function runTest() {
      const runBtn = document.getElementById('runTestBtn');
      runBtn.disabled = true;
      runBtn.innerHTML = '<span class="loading"></span> æµ‹è¯•è¿›è¡Œä¸­...';
      
      showStatus('info', 'æµ‹è¯•æ­£åœ¨è¿è¡Œï¼Œè¯·ç¨å€™...');
      consoleOutput.innerHTML = '';

      try {
        if (!window.testDataFlow) {
          throw new Error('æµ‹è¯•å‡½æ•°æœªåŠ è½½ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
        }

        const results = await window.testDataFlow();
        
        if (results.failed === 0) {
          showStatus('success', `ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼æ€»è®¡ ${results.total} ä¸ªæµ‹è¯•ï¼Œé€šè¿‡ç‡ 100%`);
        } else {
          showStatus('error', `æµ‹è¯•å®Œæˆï¼š${results.passed}/${results.total} é€šè¿‡ï¼Œ${results.failed} ä¸ªå¤±è´¥`);
        }
      } catch (error) {
        console.error('æµ‹è¯•æ‰§è¡Œå¤±è´¥:', error);
        showStatus('error', `æµ‹è¯•æ‰§è¡Œå¤±è´¥: ${error.message}`);
      } finally {
        runBtn.disabled = false;
        runBtn.innerHTML = 'ğŸš€ å¼€å§‹æµ‹è¯•';
      }
    }

    function clearConsole() {
      consoleOutput.innerHTML = '';
      document.getElementById('statusContainer').innerHTML = '';
    }

    // æ¬¢è¿æ¶ˆæ¯
    window.addEventListener('load', () => {
      console.log(`
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                               â•‘
â•‘   ğŸ§ª 4DNote æ•°æ®æµå®Œæ•´æµ‹è¯•å·¥å…·                                 â•‘
â•‘                                                               â•‘
â•‘   æµ‹è¯•èŒƒå›´ï¼šå­˜å‚¨æ¶æ„ã€äº‹ä»¶ç®¡ç†ã€è”ç³»äººã€æ ‡ç­¾ã€äº‹ä»¶æ ‘           â•‘
â•‘   æµ‹è¯•æ•°é‡ï¼šçº¦ 60 ä¸ªæµ‹è¯•ç”¨ä¾‹                                   â•‘
â•‘   é¢„è®¡æ—¶é—´ï¼š30-60 ç§’                                          â•‘
â•‘                                                               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      `);
    });
  </script>
</body>
</html>
