<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>æµ‹è¯•ç­¾åæ¸…ç†</title>
  <style>
    body { font-family: monospace; padding: 20px; }
    .test { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
    .label { font-weight: bold; margin-bottom: 5px; }
    pre { background: #f5f5f5; padding: 10px; white-space: pre-wrap; }
    .pass { color: green; }
    .fail { color: red; }
  </style>
</head>
<body>
  <h1>ç­¾åæ¸…ç†æµ‹è¯•</h1>
  
  <div id="results"></div>

  <script type="module">
    // ç®€åŒ–çš„ extractCoreContent å®ç°
    function extractCoreContent(description) {
      if (!description) return '';

      let core = description;
      
      // ğŸ”¥ [CRITICAL] å¾ªç¯ç§»é™¤ç›´åˆ°æ²¡æœ‰ç­¾åè¡Œï¼ˆå¤„ç†å¤šå±‚åµŒå¥—ï¼‰
      let previousCore = '';
      let iterations = 0;
      while (core !== previousCore && iterations < 10) {
        previousCore = core;
        core = core
          // ç§»é™¤ HTML æ³¨é‡Š
          .replace(/<!--[\s\S]*?-->/g, '')
          // ç§»é™¤æ‰€æœ‰ "---" åˆ†éš”ç¬¦ï¼ˆåŒ…æ‹¬å‰åçš„æ¢è¡Œï¼‰
          .replace(/\s*---+\s*/g, '\n')
          // ç§»é™¤æ‰€æœ‰ç­¾åè¡Œï¼ˆæ›´ä¸¥æ ¼çš„åŒ¹é…ï¼ŒåŒ…æ‹¬å®Œæ•´çš„æ—¶é—´æˆ³ï¼‰
          .replace(/\n*\s*[ã€‚ï¼Œ]*\s*ç”±\s+(?:ğŸ”®|ğŸ“§|ğŸŸ£)?\s*(?:4DNote|Outlook|ReMarkable)\s*(?:åˆ›å»ºäº|ç¼–è¾‘äº|æœ€å(?:ä¿®æ”¹|ç¼–è¾‘)äº)\s*[\d\-:\/\s]+/gi, '')
          // ç§»é™¤åªåŒ…å«é€—å·ã€å¥å·çš„è¡Œ
          .replace(/\n\s*[ã€‚ï¼Œ]+\s*\n/g, '\n')
          // ç§»é™¤å¤šä½™ç©ºè¡Œ
          .replace(/\n\s*\n+/g, '\n')
          .trim();
        iterations++;
      }

      return core;
    }

    const tests = [
      {
        name: 'HTMLæ³¨é‡Šæ¸…ç†',
        input: '<!-- .EmailQuote { margin-left: 1pt; padding-left: 4pt; border-left: #800000 2px solid; } -->\n\næœ€åä¿®æ”¹äº 2025-12-15 14:26:30',
        expected: 'æœ€åä¿®æ”¹äº 2025-12-15 14:26:30'
      },
      {
        name: 'å®Œæ•´ç­¾åæ¸…ç†',
        input: 'æµ‹è¯•å†…å®¹\n\n---\n\nç”± ğŸ”® 4DNote åˆ›å»ºäº 2025-12-17 03:06:16',
        expected: 'æµ‹è¯•å†…å®¹'
      },
      {
        name: 'å¤šé‡ç­¾åæ¸…ç†',
        input: 'æ ¸å¿ƒå†…å®¹\n\n---\n\nç”± ğŸ“§ Outlook åˆ›å»ºäº 2025-12-15 14:26:30\n\n---\n\nç”± ğŸ”® 4DNote æœ€åç¼–è¾‘äº 2025-12-17 03:06:16',
        expected: 'æ ¸å¿ƒå†…å®¹'
      },
      {
        name: 'ç­¾å+HTMLæ³¨é‡Š',
        input: '<!-- .EmailQuote { margin-left: 1pt; padding-left: 4pt; border-left: #800000 2px solid; } -->\n\næµ‹è¯•å†…å®¹\n\n---\n\nç”± ğŸ”® ReMarkable æœ€åä¿®æ”¹äº 2025-12-15 14:26:30',
        expected: 'æµ‹è¯•å†…å®¹'
      },
      {
        name: 'ä¸€è¡Œç­¾åï¼ˆåˆ›å»º+ä¿®æ”¹ï¼‰',
        input: 'æ ¸å¿ƒå†…å®¹\n\n---\n\nç”± ğŸ“§ Outlook åˆ›å»ºäº 2025-12-15 14:26:30ï¼Œæœ€åä¿®æ”¹äº 2025-12-17 03:06:16',
        expected: 'æ ¸å¿ƒå†…å®¹'
      },
      {
        name: 'æ®‹ç•™é€—å·æ¸…ç†',
        input: 'æµ‹è¯•å†…å®¹\n\nï¼Œ\n\nç”± ğŸ”® 4DNote åˆ›å»ºäº 2025-12-17 03:06:16',
        expected: 'æµ‹è¯•å†…å®¹'
      }
    ];

    const resultsDiv = document.getElementById('results');
    
    tests.forEach((test, index) => {
      const result = extractCoreContent(test.input);
      const passed = result === test.expected;
      
      const testDiv = document.createElement('div');
      testDiv.className = 'test';
      testDiv.innerHTML = `
        <div class="label ${passed ? 'pass' : 'fail'}">
          Test ${index + 1}: ${test.name} ${passed ? 'âœ“' : 'âœ—'}
        </div>
        <div><strong>Input:</strong></div>
        <pre>${test.input}</pre>
        <div><strong>Expected:</strong></div>
        <pre>${test.expected}</pre>
        <div><strong>Result:</strong></div>
        <pre>${result}</pre>
        ${!passed ? `<div class="fail"><strong>Difference:</strong> Expected length ${test.expected.length}, got ${result.length}</div>` : ''}
      `;
      resultsDiv.appendChild(testDiv);
    });
  </script>
</body>
</html>
