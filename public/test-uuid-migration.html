<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>UUID è¿ç§»æµ‹è¯• - v2.17</title>
  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      max-width: 900px;
      margin: 40px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      border-radius: 12px;
      padding: 30px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 {
      color: #2c3e50;
      border-bottom: 3px solid #3498db;
      padding-bottom: 15px;
    }
    h2 {
      color: #34495e;
      margin-top: 30px;
    }
    button {
      background: #3498db;
      color: white;
      border: none;
      padding: 12px 24px;
      margin: 8px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: background 0.2s;
    }
    button:hover {
      background: #2980b9;
    }
    button:active {
      transform: scale(0.98);
    }
    .success { background: #27ae60; }
    .success:hover { background: #229954; }
    .warning { background: #f39c12; }
    .warning:hover { background: #e67e22; }
    .error { background: #e74c3c; }
    .error:hover { background: #c0392b; }
    
    pre {
      background: #2c3e50;
      color: #ecf0f1;
      padding: 20px;
      border-radius: 8px;
      overflow-x: auto;
      font-size: 13px;
      line-height: 1.6;
    }
    .log-entry {
      margin: 8px 0;
      padding: 10px;
      border-left: 4px solid #3498db;
      background: #ecf0f1;
      border-radius: 4px;
      font-family: monospace;
      font-size: 13px;
    }
    .log-success {
      border-left-color: #27ae60;
      background: #d5f4e6;
    }
    .log-error {
      border-left-color: #e74c3c;
      background: #fadbd8;
    }
    .log-warning {
      border-left-color: #f39c12;
      background: #fef5e7;
    }
    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin: 20px 0;
    }
    .stat-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      border-radius: 8px;
      text-align: center;
    }
    .stat-value {
      font-size: 32px;
      font-weight: bold;
      margin: 10px 0;
    }
    .stat-label {
      font-size: 14px;
      opacity: 0.9;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ¯ UUID è¿ç§»æµ‹è¯•å·¥å…· (v2.17)</h1>
    
    <div class="stats">
      <div class="stat-card">
        <div class="stat-label">å·²ç”ŸæˆUUIDæ•°é‡</div>
        <div class="stat-value" id="generatedCount">0</div>
      </div>
      <div class="stat-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
        <div class="stat-label">nanoidäº‹ä»¶æ•°é‡</div>
        <div class="stat-value" id="nanoidCount">-</div>
      </div>
      <div class="stat-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
        <div class="stat-label">UUIDäº‹ä»¶æ•°é‡</div>
        <div class="stat-value" id="uuidCount">-</div>
      </div>
    </div>

    <h2>ğŸ“‹ åŸºæœ¬æµ‹è¯•</h2>
    <button onclick="testUUIDGeneration()">1ï¸âƒ£ æµ‹è¯•UUIDç”Ÿæˆ</button>
    <button onclick="testUUIDFormat()" class="success">2ï¸âƒ£ éªŒè¯UUIDæ ¼å¼</button>
    <button onclick="testUUIDUniqueness()" class="warning">3ï¸âƒ£ æµ‹è¯•UUIDå”¯ä¸€æ€§</button>
    <button onclick="testPerformance()">4ï¸âƒ£ æ€§èƒ½æµ‹è¯•</button>

    <h2>ğŸ—„ï¸ æ•°æ®åº“æµ‹è¯•</h2>
    <button onclick="scanDatabase()">5ï¸âƒ£ æ‰«ææ•°æ®åº“IDæ ¼å¼</button>
    <button onclick="testEventCreation()" class="success">6ï¸âƒ£ æµ‹è¯•åˆ›å»ºäº‹ä»¶</button>
    <button onclick="testHierarchyFields()" class="success">7ï¸âƒ£ æµ‹è¯•å±‚çº§ç»“æ„å­—æ®µ</button>
    <button onclick="clearTestData()" class="error">ğŸ—‘ï¸ æ¸…ç†æµ‹è¯•æ•°æ®</button>

    <h2>ğŸ“Š æµ‹è¯•ç»“æœ</h2>
    <div id="output"></div>
  </div>

  <script type="module">
    import { generateEventId } from './src/utils/idGenerator.js';
    
    const output = document.getElementById('output');
    let generatedUUIDs = [];
    
    function log(message, type = 'info') {
      const div = document.createElement('div');
      div.className = `log-entry log-${type}`;
      div.innerHTML = `<strong>[${new Date().toLocaleTimeString()}]</strong> ${message}`;
      output.appendChild(div);
      output.scrollTop = output.scrollHeight;
    }
    
    function clearOutput() {
      output.innerHTML = '';
      generatedUUIDs = [];
    }

    // 1. æµ‹è¯•UUIDç”Ÿæˆ
    window.testUUIDGeneration = () => {
      clearOutput();
      log('å¼€å§‹æµ‹è¯•UUIDç”Ÿæˆ...', 'info');
      
      try {
        const uuid1 = generateEventId();
        const uuid2 = generateEventId();
        const uuid3 = generateEventId();
        
        log(`âœ… ç”ŸæˆUUID 1: <code>${uuid1}</code>`, 'success');
        log(`âœ… ç”ŸæˆUUID 2: <code>${uuid2}</code>`, 'success');
        log(`âœ… ç”ŸæˆUUID 3: <code>${uuid3}</code>`, 'success');
        
        generatedUUIDs.push(uuid1, uuid2, uuid3);
        document.getElementById('generatedCount').textContent = generatedUUIDs.length;
        
        log('âœ… UUIDç”Ÿæˆæµ‹è¯•é€šè¿‡', 'success');
      } catch (error) {
        log(`âŒ UUIDç”Ÿæˆå¤±è´¥: ${error.message}`, 'error');
      }
    };

    // 2. éªŒè¯UUIDæ ¼å¼
    window.testUUIDFormat = () => {
      clearOutput();
      log('å¼€å§‹éªŒè¯UUIDæ ¼å¼...', 'info');
      
      const uuidRegex = /^event_[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;
      
      for (let i = 0; i < 10; i++) {
        const uuid = generateEventId();
        const isValid = uuidRegex.test(uuid);
        
        if (isValid) {
          log(`âœ… UUID ${i+1}: ${uuid} - æ ¼å¼æ­£ç¡®`, 'success');
        } else {
          log(`âŒ UUID ${i+1}: ${uuid} - æ ¼å¼é”™è¯¯`, 'error');
        }
        
        generatedUUIDs.push(uuid);
      }
      
      document.getElementById('generatedCount').textContent = generatedUUIDs.length;
      log('âœ… UUIDæ ¼å¼éªŒè¯å®Œæˆ', 'success');
    };

    // 3. æµ‹è¯•UUIDå”¯ä¸€æ€§
    window.testUUIDUniqueness = () => {
      clearOutput();
      log('å¼€å§‹æµ‹è¯•UUIDå”¯ä¸€æ€§ï¼ˆç”Ÿæˆ10000ä¸ªUUIDï¼‰...', 'info');
      
      const startTime = performance.now();
      const uuids = new Set();
      let duplicates = 0;
      
      for (let i = 0; i < 10000; i++) {
        const uuid = generateEventId();
        if (uuids.has(uuid)) {
          duplicates++;
          log(`âŒ å‘ç°é‡å¤UUID: ${uuid}`, 'error');
        } else {
          uuids.add(uuid);
        }
      }
      
      const endTime = performance.now();
      const elapsed = (endTime - startTime).toFixed(2);
      
      if (duplicates === 0) {
        log(`âœ… ç”Ÿæˆ10000ä¸ªUUIDï¼Œæ— é‡å¤`, 'success');
        log(`âœ… å”¯ä¸€æ€§æµ‹è¯•é€šè¿‡`, 'success');
      } else {
        log(`âŒ å‘ç° ${duplicates} ä¸ªé‡å¤UUID`, 'error');
      }
      
      log(`â±ï¸ è€—æ—¶: ${elapsed}ms`, 'info');
      
      generatedUUIDs = Array.from(uuids);
      document.getElementById('generatedCount').textContent = generatedUUIDs.length;
    };

    // 4. æ€§èƒ½æµ‹è¯•
    window.testPerformance = () => {
      clearOutput();
      log('å¼€å§‹æ€§èƒ½æµ‹è¯•...', 'info');
      
      const iterations = [100, 1000, 10000, 100000];
      
      iterations.forEach(count => {
        const startTime = performance.now();
        
        for (let i = 0; i < count; i++) {
          generateEventId();
        }
        
        const endTime = performance.now();
        const elapsed = (endTime - startTime).toFixed(2);
        const avgTime = (elapsed / count).toFixed(4);
        
        log(`âœ… ç”Ÿæˆ ${count.toLocaleString()} ä¸ªUUID: ${elapsed}ms (å¹³å‡ ${avgTime}ms/ä¸ª)`, 'success');
      });
      
      log('âœ… æ€§èƒ½æµ‹è¯•å®Œæˆ', 'success');
    };

    // 5. æ‰«ææ•°æ®åº“IDæ ¼å¼
    window.scanDatabase = async () => {
      clearOutput();
      log('å¼€å§‹æ‰«ææ•°æ®åº“...', 'info');
      
      try {
        const db = await new Promise((resolve, reject) => {
          const request = indexedDB.open('4DNoteDB', 2); // v2: Added event_history store
          request.onsuccess = () => resolve(request.result);
          request.onerror = () => reject(request.error);
        });
        
        const tx = db.transaction(['events'], 'readonly');
        const store = tx.objectStore('events');
        const allEvents = await new Promise((resolve, reject) => {
          const request = store.getAll();
          request.onsuccess = () => resolve(request.result);
          request.onerror = () => reject(request.error);
        });
        
        log(`âœ… æ‰¾åˆ° ${allEvents.length} ä¸ªäº‹ä»¶`, 'success');
        
        const nanoidRegex = /^event_[A-Za-z0-9_-]{21}$/;
        const uuidRegex = /^event_[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;
        const tempIdRegex = /^line-/;
        const outlookRegex = /^outlook-/;
        const googleRegex = /^google-/;
        
        let nanoidCount = 0;
        let uuidCount = 0;
        let tempIdCount = 0;
        let outlookCount = 0;
        let googleCount = 0;
        let otherCount = 0;
        
        allEvents.forEach(event => {
          if (tempIdRegex.test(event.id)) {
            tempIdCount++;
            log(`âš ï¸ ä¸´æ—¶ID: ${event.id}`, 'warning');
          } else if (outlookRegex.test(event.id)) {
            outlookCount++;
          } else if (googleRegex.test(event.id)) {
            googleCount++;
          } else if (nanoidRegex.test(event.id)) {
            nanoidCount++;
          } else if (uuidRegex.test(event.id)) {
            uuidCount++;
          } else {
            otherCount++;
            log(`âš ï¸ æœªçŸ¥æ ¼å¼: ${event.id}`, 'warning');
          }
        });
        
        log(`\nğŸ“Š IDæ ¼å¼ç»Ÿè®¡:`, 'info');
        log(`  â€¢ 4DNote nanoidæ ¼å¼: ${nanoidCount} ä¸ª`, 'info');
        log(`  â€¢ 4DNote UUIDæ ¼å¼: ${uuidCount} ä¸ª`, 'success');
        log(`  â€¢ Outlookæ—¥å†äº‹ä»¶: ${outlookCount} ä¸ª`, 'info');
        log(`  â€¢ Googleæ—¥å†äº‹ä»¶: ${googleCount} ä¸ª`, 'info');
        log(`  â€¢ ä¸´æ—¶ID: ${tempIdCount} ä¸ª`, tempIdCount > 0 ? 'warning' : 'info');
        log(`  â€¢ å…¶ä»–æ ¼å¼: ${otherCount} ä¸ª`, otherCount > 0 ? 'warning' : 'info');
        
        document.getElementById('nanoidCount').textContent = nanoidCount;
        document.getElementById('uuidCount').textContent = uuidCount;
        
        if (tempIdCount > 0) {
          log(`\nâš ï¸ è­¦å‘Š: å‘ç° ${tempIdCount} ä¸ªä¸´æ—¶IDï¼Œå»ºè®®æ¸…ç†`, 'warning');
        } else {
          log(`\nâœ… æ•°æ®åº“ä¸­æ— ä¸´æ—¶ID`, 'success');
        }
        
      } catch (error) {
        log(`âŒ æ‰«ææ•°æ®åº“å¤±è´¥: ${error.message}`, 'error');
      }
    };

    // 6. æµ‹è¯•åˆ›å»ºäº‹ä»¶
    window.testEventCreation = async () => {
      clearOutput();
      log('æµ‹è¯•åˆ›å»ºäº‹ä»¶...', 'info');
      
      try {
        const EventService = (await import('./src/services/EventService.js')).EventService;
        
        const testEventId = generateEventId();
        const testEvent = {
          id: testEventId,
          title: {
            simpleTitle: 'UUIDæµ‹è¯•äº‹ä»¶ ' + new Date().toLocaleTimeString(),
            slateContent: null
          },
          isPlan: true,
          isTask: true,
          fourDNoteSource: true
        };
        
        log(`åˆ›å»ºæµ‹è¯•äº‹ä»¶: ${testEventId}`, 'info');
        
        const result = await EventService.createEvent(testEvent);
        
        if (!result.success) {
          log(`âŒ äº‹ä»¶åˆ›å»ºå¤±è´¥: ${result.error}`, 'error');
          return;
        }
        
        const created = result.event;
        log(`âœ… äº‹ä»¶åˆ›å»ºæˆåŠŸ: ${created.id}`, 'success');
        log(`  â€¢ æ ‡é¢˜: ${created.title?.simpleTitle || created.title}`, 'info');
        log(`  â€¢ åˆ›å»ºæ—¶é—´: ${created.createdAt}`, 'info');
        log(`  â€¢ UUIDæ ¼å¼: ${/^event_[0-9a-f-]{36}$/.test(created.id) ? 'âœ…' : 'âŒ'}`, created.id.includes('-') ? 'success' : 'error');
        
        // éªŒè¯äº‹ä»¶å·²ä¿å­˜
        const retrieved = await EventService.getEventById(created.id);
        if (retrieved) {
          log(`âœ… äº‹ä»¶ä¿å­˜éªŒè¯é€šè¿‡`, 'success');
          log(`  â€¢ ä»æ•°æ®åº“è¯»å–æ ‡é¢˜: ${retrieved.title?.simpleTitle || retrieved.title}`, 'info');
        } else {
          log(`âŒ äº‹ä»¶ä¿å­˜éªŒè¯å¤±è´¥`, 'error');
        }
        
      } catch (error) {
        log(`âŒ åˆ›å»ºäº‹ä»¶å¤±è´¥: ${error.message}`, 'error');
        console.error('Full error:', error);
      }
    };

    // 7. æ¸…ç†æµ‹è¯•æ•°æ®
    window.clearTestData = async () => {
      if (!confirm('ç¡®å®šè¦åˆ é™¤æ‰€æœ‰æµ‹è¯•äº‹ä»¶å—ï¼Ÿ')) return;
      
      clearOutput();
      log('å¼€å§‹æ¸…ç†æµ‹è¯•æ•°æ®...', 'warning');
      
      try {
        const EventService = (await import('./src/services/EventService.js')).EventService;
        const allEvents = await EventService.getAllEvents();
        
        // åŒ¹é…æ‰€æœ‰UUIDæµ‹è¯•äº‹ä»¶ï¼ˆåŒ…æ‹¬å±‚çº§ç»“æ„æµ‹è¯•ï¼‰
        const testEvents = allEvents.filter(e => {
          const titleStr = e.title?.simpleTitle || e.title || '';
          return titleStr.includes('UUID') && (
            titleStr.includes('æµ‹è¯•äº‹ä»¶') || 
            titleStr.includes('æ ¹äº‹ä»¶') || 
            titleStr.includes('çˆ¶äº‹ä»¶') || 
            titleStr.includes('å­äº‹ä»¶')
          );
        });
        
        log(`æ‰¾åˆ° ${testEvents.length} ä¸ªæµ‹è¯•äº‹ä»¶`, 'info');
        
        let deletedCount = 0;
        for (const event of testEvents) {
          try {
            await EventService.deleteEvent(event.id);
            deletedCount++;
            log(`âœ… å·²åˆ é™¤: ${event.title?.simpleTitle || event.id}`, 'success');
          } catch (err) {
            log(`âŒ åˆ é™¤å¤±è´¥: ${event.id} - ${err.message}`, 'error');
          }
        }
        
        log(`âœ… æ¸…ç†å®Œæˆï¼Œå…±åˆ é™¤ ${deletedCount} / ${testEvents.length} ä¸ªæµ‹è¯•äº‹ä»¶`, 'success');
        
      } catch (error) {
        log(`âŒ æ¸…ç†å¤±è´¥: ${error.message}`, 'error');
      }
    };

    // 8. æµ‹è¯•å±‚çº§ç»“æ„å­—æ®µï¼ˆå¤šçº§åµŒå¥—ï¼‰
    window.testHierarchyFields = async () => {
      clearOutput();
      log('æµ‹è¯•å¤šå±‚çº§ç»“æ„å­—æ®µ...', 'info');
      log('å°†åˆ›å»º3ä¸ªä¸€çº§äº‹ä»¶ï¼Œæ¯ä¸ªä¸‹é¢æœ‰2-5çº§çš„éšæœºå±‚çº§ç»“æ„', 'info');
      
      try {
        const EventService = (await import('./src/services/EventService.js')).EventService;
        
        const allCreatedEvents = [];
        const timestamp = new Date().toLocaleTimeString();
        
        // åˆ›å»º3ä¸ªä¸€çº§äº‹ä»¶
        for (let rootIndex = 0; rootIndex < 3; rootIndex++) {
          const rootId = generateEventId();
          const now = new Date();
          const startTime = new Date(now.getTime() + rootIndex * 3600000); // æ¯ä¸ªæ ¹äº‹ä»¶é—´éš”1å°æ—¶
          const endTime = new Date(startTime.getTime() + 1800000); // 30åˆ†é’Ÿæ—¶é•¿
          
          const rootEvent = {
            id: rootId,
            title: { simpleTitle: `UUIDæ ¹äº‹ä»¶${rootIndex + 1} ${timestamp}`, slateContent: null },
            isPlan: true,
            isTask: true,
            fourDNoteSource: true,
            bulletLevel: 0,
            position: rootIndex * 10000,
            startTime: startTime.toISOString().replace('T', ' ').substring(0, 19),
            endTime: endTime.toISOString().replace('T', ' ').substring(0, 19)
          };
          
          log(`\nğŸ“Œ åˆ›å»ºæ ¹äº‹ä»¶ ${rootIndex + 1}: ${rootId.slice(-8)}`, 'info');
          const rootResult = await EventService.createEvent(rootEvent);
          
          if (!rootResult.success) {
            log(`âŒ æ ¹äº‹ä»¶${rootIndex + 1}åˆ›å»ºå¤±è´¥: ${rootResult.error}`, 'error');
            continue;
          }
          
          const actualRootId = rootResult.event.id; // ä½¿ç”¨å®é™…è¿”å›çš„ID
          log(`âœ… æ ¹äº‹ä»¶${rootIndex + 1}åˆ›å»ºæˆåŠŸ`, 'success');
          log(`  â€¢ ä¼ å…¥ID: ${rootId}`, 'info');
          log(`  â€¢ è¿”å›ID: ${actualRootId}`, 'info');
          log(`  â€¢ IDç›¸åŒ: ${rootId === actualRootId}`, actualRootId === rootId ? 'success' : 'warning');
          allCreatedEvents.push({ id: actualRootId, level: 0, title: rootEvent.title.simpleTitle });
          
          // ä¸ºæ¯ä¸ªæ ¹äº‹ä»¶åˆ›å»ºéšæœºå±‚çº§ç»“æ„ (2-5çº§)
          const maxLevel = 2 + Math.floor(Math.random() * 4); // 2-5
          let parentsByLevel = { 0: [actualRootId] }; // ä½¿ç”¨å®é™…è¿”å›çš„ID
          
          log(`  â””â”€ å°†åˆ›å»ºæ·±åº¦ä¸º ${maxLevel} çš„å±‚çº§ç»“æ„`, 'info');
          
          for (let level = 1; level <= maxLevel; level++) {
            const parentsAtPrevLevel = parentsByLevel[level - 1] || [];
            parentsByLevel[level] = [];
            
            for (const parentId of parentsAtPrevLevel) {
              // æ¯ä¸ªçˆ¶èŠ‚ç‚¹éšæœºåˆ›å»º1-3ä¸ªå­èŠ‚ç‚¹
              const childCount = 1 + Math.floor(Math.random() * 3);
              
              for (let childIdx = 0; childIdx < childCount; childIdx++) {
                const childId = generateEventId();
                const childEvent = {
                  id: childId,
                  title: { 
                    simpleTitle: `L${level}-å­äº‹ä»¶${childIdx + 1} (çˆ¶:${parentId.slice(-8)})`, 
                    slateContent: null 
                  },
                  isPlan: true,
                  isTask: true,
                  fourDNoteSource: true,
                  parentEventId: parentId,
                  bulletLevel: level,
                  position: (level * 10000) + (childIdx * 1000) + Math.random() * 100
                };
                
                const childResult = await EventService.createEvent(childEvent);
                
                if (childResult.success) {
                  const actualId = childResult.event.id; // ä½¿ç”¨å®é™…è¿”å›çš„ID
                  parentsByLevel[level].push(actualId);
                  allCreatedEvents.push({ 
                    id: actualId,  // ä¿å­˜å®é™…ID
                    level, 
                    parentId,
                    title: childEvent.title.simpleTitle 
                  });
                  // æ˜¾ç¤ºå®Œæ•´IDçš„æœ€å12ä½ï¼ˆåŒ…å«è¿å­—ç¬¦ï¼‰
                  const displayId = actualId.length > 12 ? actualId.slice(-12) : actualId;
                  log(`  ${'  '.repeat(level)}â””â”€ L${level} å­äº‹ä»¶: ${displayId}`, 'success');
                } else {
                  log(`  ${'  '.repeat(level)}âœ— L${level} åˆ›å»ºå¤±è´¥: ${childResult.error}`, 'error');
                }
              }
            }
            
            log(`  â””â”€ ç¬¬${level}çº§: åˆ›å»ºäº† ${parentsByLevel[level].length} ä¸ªäº‹ä»¶`, 'info');
          }
        }
        
        log(`\nğŸ“Š å±‚çº§ç»“æ„ç»Ÿè®¡:`, 'success');
        log(`  â€¢ æ€»äº‹ä»¶æ•°: ${allCreatedEvents.length}`, 'info');
        
        for (let level = 0; level <= 5; level++) {
          const count = allCreatedEvents.filter(e => e.level === level).length;
          if (count > 0) {
            log(`  â€¢ ${level}çº§äº‹ä»¶: ${count} ä¸ª`, 'info');
          }
        }
        
        // éšæœºæŠ½å–å‡ ä¸ªäº‹ä»¶éªŒè¯å­—æ®µ
        log(`\nğŸ” éªŒè¯å±‚çº§å­—æ®µæŒä¹…åŒ–:`, 'info');
        
        const samplesToVerify = allCreatedEvents
          .filter(e => e.level > 0) // åªéªŒè¯æœ‰çˆ¶çº§çš„äº‹ä»¶
          .sort(() => Math.random() - 0.5)
          .slice(0, 5); // éšæœºæŠ½å–5ä¸ª
        
        let verifySuccessCount = 0;
        let verifyFailCount = 0;
        
        // å…ˆæ£€æŸ¥ç¬¬ä¸€ä¸ªæ ·æœ¬çš„IDæ ¼å¼
        if (samplesToVerify.length > 0) {
          const firstSample = samplesToVerify[0];
          log(`  ğŸ” è°ƒè¯•ç¬¬ä¸€ä¸ªæ ·æœ¬:`, 'info');
          log(`    â€¢ ID: ${firstSample.id}`, 'info');
          log(`    â€¢ IDç±»å‹: ${typeof firstSample.id}`, 'info');
          log(`    â€¢ IDé•¿åº¦: ${firstSample.id?.length}`, 'info');
          log(`    â€¢ æ˜¯å¦åŒ…å«event_: ${firstSample.id?.includes('event_')}`, 'info');
        }
        
        for (const sample of samplesToVerify) {
          const retrieved = await EventService.getEventById(sample.id);
          
          if (!retrieved) {
            log(`  âŒ æ— æ³•è¯»å–äº‹ä»¶: ${sample.id}`, 'error');
            verifyFailCount++;
            continue;
          }
          
          const parentIdMatch = retrieved.parentEventId === sample.parentId;
          const levelMatch = retrieved.bulletLevel === sample.level;
          const hasPosition = retrieved.position !== undefined;
          
          if (parentIdMatch && levelMatch && hasPosition) {
            log(`  âœ… ${sample.title}: å­—æ®µæ­£ç¡®`, 'success');
            log(`    â€¢ parentId: ${retrieved.parentEventId?.slice(-8)}`, 'info');
            log(`    â€¢ bulletLevel: ${retrieved.bulletLevel}`, 'info');
            log(`    â€¢ position: ${retrieved.position?.toFixed(2)}`, 'info');
            verifySuccessCount++;
          } else {
            log(`  âŒ ${sample.title}: å­—æ®µé”™è¯¯`, 'error');
            log(`    â€¢ parentId: ${parentIdMatch ? 'âœ…' : 'âŒ'} ${retrieved.parentEventId?.slice(-8)}`, 'warning');
            log(`    â€¢ bulletLevel: ${levelMatch ? 'âœ…' : 'âŒ'} ${retrieved.bulletLevel}`, 'warning');
            log(`    â€¢ position: ${hasPosition ? 'âœ…' : 'âŒ'} ${retrieved.position}`, 'warning');
            verifyFailCount++;
          }
        }
        
        log(`\nğŸ“ˆ éªŒè¯ç»“æœ:`, verifySuccessCount === samplesToVerify.length ? 'success' : 'warning');
        log(`  â€¢ éªŒè¯æˆåŠŸ: ${verifySuccessCount} / ${samplesToVerify.length}`, 'success');
        if (verifyFailCount > 0) {
          log(`  â€¢ éªŒè¯å¤±è´¥: ${verifyFailCount} / ${samplesToVerify.length}`, 'error');
        }
        
        // éªŒè¯åŒå‘å…³è”
        log(`\nğŸ”— éªŒè¯åŒå‘å…³è”:`, 'info');
        const rootEvents = allCreatedEvents.filter(e => e.level === 0);
        
        for (const rootEvent of rootEvents) {
          const retrieved = await EventService.getEventById(rootEvent.id);
          if (retrieved && retrieved.childEventIds && retrieved.childEventIds.length > 0) {
            log(`  âœ… ${rootEvent.title}: æœ‰ ${retrieved.childEventIds.length} ä¸ªå­äº‹ä»¶`, 'success');
          }
        }
        
        if (verifySuccessCount === samplesToVerify.length) {
          log(`\nâœ… å¤šå±‚çº§ç»“æ„æµ‹è¯•å®Œå…¨é€šè¿‡ï¼`, 'success');
          log(`âœ… UUIDè¿ç§»åœ¨å¤æ‚å±‚çº§ç»“æ„ä¸­å®Œå…¨æ­£å¸¸`, 'success');
        } else {
          log(`\nâš ï¸ éƒ¨åˆ†å­—æ®µéªŒè¯å¤±è´¥ï¼Œè¯·æ£€æŸ¥`, 'warning');
        }
        
      } catch (error) {
        log(`âŒ æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
        console.error('Full error:', error);
      }
    };

    // è‡ªåŠ¨è¿è¡ŒåŸºæœ¬æµ‹è¯•
    log('ğŸš€ UUIDè¿ç§»æµ‹è¯•å·¥å…·å·²å°±ç»ª', 'success');
    log('ç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•...', 'info');
  </script>
</body>
</html>
