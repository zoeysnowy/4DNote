# RAG ç³»ç»Ÿå¼€å‘è¿­ä»£æŒ‡å—

> **ç›®æ ‡**: å»ºç«‹ç³»ç»ŸåŒ–çš„ RAG å¼€å‘ã€æµ‹è¯•ã€ä¼˜åŒ–æµç¨‹  
> **åˆ›å»ºæ—¶é—´**: 2025-12-23

---

## ğŸ”„ å®Œæ•´è¿­ä»£æµç¨‹

### Phase 1: éœ€æ±‚åˆ†æä¸è§„åˆ’ (Orchestrator AI)

**è¾“å…¥**: ç”¨æˆ·éœ€æ±‚æˆ–é—®é¢˜æŠ¥å‘Š

**æ­¥éª¤**:
1. ç†è§£ç”¨æˆ·éœ€æ±‚
2. åˆ†è§£ä¸ºå…·ä½“çš„å­ä»»åŠ¡
3. è¯„ä¼°éš¾åº¦å’Œä¼˜å…ˆçº§
4. åˆ¶å®šæ—¶é—´è®¡åˆ’

**å·¥å…·**:
```bash
# ä½¿ç”¨ GitHub Copilot
@workspace /plan å®ç°æŸ¥è¯¢é‡å†™åŠŸèƒ½ï¼Œæå‡æ—¶é—´æ¨ç†çš„å‡†ç¡®ç‡

# æˆ–ä½¿ç”¨è‡ªå®šä¹‰è„šæœ¬
node scripts/ai-workflow.js --task "å®ç°æŸ¥è¯¢é‡å†™åŠŸèƒ½"
```

**è¾“å‡ºç¤ºä¾‹**:
```json
{
  "tasks": [
    {
      "id": "T001",
      "description": "åˆ†æå½“å‰æ—¶é—´æ¨ç†å¤±è´¥çš„æµ‹è¯•ç”¨ä¾‹",
      "assignTo": "reviewer",
      "priority": "high",
      "estimatedTime": "30min"
    },
    {
      "id": "T002",
      "description": "å®ç°æŸ¥è¯¢é‡å†™ç®—æ³•",
      "assignTo": "developer",
      "priority": "high",
      "estimatedTime": "2h",
      "dependencies": ["T001"]
    },
    {
      "id": "T003",
      "description": "ç¼–å†™å•å…ƒæµ‹è¯•",
      "assignTo": "developer",
      "priority": "medium",
      "estimatedTime": "1h"
    },
    {
      "id": "T004",
      "description": "è¿è¡Œå®Œæ•´æµ‹è¯•é›†å¹¶è¯„ä¼°",
      "assignTo": "reviewer",
      "priority": "high",
      "estimatedTime": "30min",
      "dependencies": ["T002", "T003"]
    }
  ],
  "totalEstimate": "4 hours",
  "risks": [
    "æŸ¥è¯¢é‡å†™å¯èƒ½éœ€è¦ LLM APIï¼Œå¢åŠ æˆæœ¬",
    "æ—¶é—´è§£æé€»è¾‘å¤æ‚ï¼Œéœ€è¦å¤„ç†å¤šç§æ ¼å¼"
  ]
}
```

---

### Phase 2: é—®é¢˜è¯Šæ–­ä¸æµ‹è¯• (Reviewer AI)

**è¾“å…¥**: æµ‹è¯•ç”¨ä¾‹æˆ– Bug æŠ¥å‘Š

**æ­¥éª¤**:
1. è¿è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•
2. åˆ†æå¤±è´¥çš„æµ‹è¯•ç”¨ä¾‹
3. å®šä½é—®é¢˜æ ¹æº
4. æå‡ºæ”¹è¿›å»ºè®®

**å·¥å…·**:
```bash
# è¿è¡Œ RAG æµ‹è¯•
node scripts/test-rag.js

# æŸ¥çœ‹æµ‹è¯•æŠ¥å‘Š
cat test-results/rag-test-latest.md

# ä½¿ç”¨ Copilot åˆ†æ
@workspace åˆ†æ test-results/rag-test-latest.md ä¸­å¤±è´¥çš„æµ‹è¯•ç”¨ä¾‹ï¼Œæ‰¾å‡ºå…±åŒé—®é¢˜
```

**è¯Šæ–­æŠ¥å‘Šç¤ºä¾‹**:
```markdown
# RAG é—®é¢˜è¯Šæ–­æŠ¥å‘Š

**æµ‹è¯•æ—¶é—´**: 2025-12-23 10:30
**å¤±è´¥ç”¨ä¾‹**: 3/10

## å¤±è´¥åˆ†æ

### Test Case: time_001 âŒ

**é—®é¢˜**: "é‚£ä¸Šå‘¨å‘¢ï¼Ÿ" æœªèƒ½æ­£ç¡®è§£æä¸ºæ—¥æœŸèŒƒå›´

**åŸå› **:
1. æŸ¥è¯¢é‡å†™æ¨¡å—ç¼ºå¤±
2. å¯¹è¯å†å²æœªè¢«ä¼ å…¥æ£€ç´¢å‡½æ•°
3. ç›¸å¯¹æ—¶é—´è¯ï¼ˆ"ä¸Šå‘¨"ï¼‰æœªè¢«è§£æ

**å½±å“**: æ‰€æœ‰æ¶‰åŠä¸Šä¸‹æ–‡çš„æ—¶é—´æ¨ç†æŸ¥è¯¢éƒ½ä¼šå¤±è´¥

**å»ºè®®**:
- å®ç°æŸ¥è¯¢é‡å†™æ¨¡å—ï¼ˆä½¿ç”¨ LLM æˆ–è§„åˆ™å¼•æ“ï¼‰
- åœ¨ ChatFlow ä¸­ç»´æŠ¤å¯¹è¯å†å²
- æ·»åŠ æ—¥æœŸè§£æå·¥å…·å‡½æ•°

### Test Case: multihop_001 âŒ

**é—®é¢˜**: å¤šè·³æ¨ç†ä¸å®Œæ•´

**åŸå› **:
1. æ£€ç´¢åªè¿”å›å‰ 5 ä¸ªæ–‡æ¡£ï¼Œä¸¢å¤±å…³é”®ä¿¡æ¯
2. LLM æœªè¢«æŒ‡ç¤ºè¿›è¡Œå¤šæ­¥æ¨ç†
3. ç¼ºå°‘ä¸­é—´æ¨ç†æ­¥éª¤çš„å¯è§†åŒ–

**å»ºè®®**:
- å¢åŠ æ£€ç´¢æ–‡æ¡£æ•°é‡ï¼ˆ5 â†’ 10ï¼‰
- åœ¨ç³»ç»Ÿæç¤ºè¯ä¸­æ·»åŠ  Chain-of-Thought æŒ‡ä»¤
- å®ç° Rerank æ­¥éª¤ï¼Œæå‡æ£€ç´¢ç²¾åº¦

## æ€»ä½“å»ºè®®

**ä¼˜å…ˆçº§ 1**: å®ç°æŸ¥è¯¢é‡å†™ï¼ˆå½±å“ 30% çš„æµ‹è¯•ç”¨ä¾‹ï¼‰
**ä¼˜å…ˆçº§ 2**: é›†æˆ Rerank APIï¼ˆæå‡æ£€ç´¢ç²¾åº¦ 15-20%ï¼‰
**ä¼˜å…ˆçº§ 3**: ä¼˜åŒ–ç³»ç»Ÿæç¤ºè¯ï¼ˆæå‡ç”Ÿæˆè´¨é‡ï¼‰
```

---

### Phase 3: åŠŸèƒ½å®ç° (Developer AI)

**è¾“å…¥**: éœ€æ±‚è§„èŒƒæˆ– Bug è¯Šæ–­æŠ¥å‘Š

**æ­¥éª¤**:
1. è®¾è®¡å®ç°æ–¹æ¡ˆ
2. ç¼–å†™ä»£ç 
3. ç¼–å†™å•å…ƒæµ‹è¯•
4. æœ¬åœ°éªŒè¯

**å·¥å…·**:
```bash
# ä½¿ç”¨ Copilot Inline Chat (æ¨è)
# 1. æ‰“å¼€æ–‡ä»¶: src/services/ragService.ts
# 2. é€‰ä¸­éœ€è¦ä¿®æ”¹çš„å‡½æ•°
# 3. Ctrl+I (Windows) æˆ– Cmd+I (Mac)
# 4. è¾“å…¥: "å®ç°æŸ¥è¯¢é‡å†™åŠŸèƒ½ï¼Œå°†å¯¹è¯å¼æŸ¥è¯¢è½¬æ¢ä¸ºç»“æ„åŒ–æ£€ç´¢æ¡ä»¶"

# æˆ–ä½¿ç”¨ Copilot Chat
@workspace /new åˆ›å»ºä¸€ä¸ªæŸ¥è¯¢é‡å†™æ¨¡å—ï¼Œæ”¯æŒæ—¶é—´æ¨ç†å’Œä¸Šä¸‹æ–‡è§£æ

# æˆ–ä½¿ç”¨è‡ªå®šä¹‰è„šæœ¬
node scripts/ai-workflow.js --task "å®ç°æŸ¥è¯¢é‡å†™åŠŸèƒ½" --role developer
```

**å®ç°ç¤ºä¾‹**:
```typescript
// src/services/queryRewriter.ts

import { OpenAI } from 'openai';

interface ConversationMessage {
  role: 'user' | 'assistant';
  content: string;
}

interface StructuredQuery {
  originalQuery: string;
  rewrittenQuery: string;
  timeRange?: { start: Date; end: Date };
  entities: string[];
  intent: 'search' | 'create' | 'update' | 'delete';
}

/**
 * æŸ¥è¯¢é‡å†™æœåŠ¡
 * å°†å¯¹è¯å¼æŸ¥è¯¢è½¬æ¢ä¸ºç»“æ„åŒ–æ£€ç´¢æ¡ä»¶
 */
export class QueryRewriter {
  private openai: OpenAI;
  
  constructor() {
    this.openai = new OpenAI({
      apiKey: process.env.OPENAI_API_KEY,
    });
  }
  
  /**
   * é‡å†™æŸ¥è¯¢
   */
  async rewrite(
    query: string,
    conversationHistory: ConversationMessage[] = [],
    currentDate: Date = new Date()
  ): Promise<StructuredQuery> {
    const prompt = this.buildPrompt(query, conversationHistory, currentDate);
    
    const response = await this.openai.chat.completions.create({
      model: 'gpt-3.5-turbo',
      messages: [{ role: 'user', content: prompt }],
      temperature: 0.1,
      response_format: { type: 'json_object' },
    });
    
    const result = JSON.parse(response.choices[0].message.content);
    
    return {
      originalQuery: query,
      rewrittenQuery: result.rewrittenQuery,
      timeRange: result.timeRange ? {
        start: new Date(result.timeRange.start),
        end: new Date(result.timeRange.end),
      } : undefined,
      entities: result.entities || [],
      intent: result.intent || 'search',
    };
  }
  
  private buildPrompt(
    query: string,
    history: ConversationMessage[],
    currentDate: Date
  ): string {
    const dateStr = currentDate.toISOString().split('T')[0];
    const historyText = history.map(m => `${m.role}: ${m.content}`).join('\n');
    
    return `
ä½ æ˜¯ä¸€ä¸ªæŸ¥è¯¢é‡å†™ä¸“å®¶ã€‚å°†å¯¹è¯å¼æŸ¥è¯¢è½¬æ¢ä¸ºç»“æ„åŒ–æ£€ç´¢æ¡ä»¶ã€‚

å½“å‰æ—¥æœŸ: ${dateStr}

å¯¹è¯å†å²:
${historyText || '(æ— )'}

ç”¨æˆ·æŸ¥è¯¢: "${query}"

ä»»åŠ¡:
1. è§£æç›¸å¯¹æ—¶é—´è¯ï¼ˆ"ä¸Šå‘¨"ã€"æ˜å¤©"ã€"é‚£æ—¶"ï¼‰ä¸ºå…·ä½“æ—¥æœŸèŒƒå›´
2. è¯†åˆ«å®ä½“ï¼ˆäººåã€é¡¹ç›®åã€æ ‡ç­¾ï¼‰
3. ç†è§£ç”¨æˆ·æ„å›¾ï¼ˆæœç´¢ã€åˆ›å»ºã€æ›´æ–°ã€åˆ é™¤ï¼‰
4. ç”Ÿæˆæ¸…æ™°çš„é‡å†™æŸ¥è¯¢

è¿”å› JSON æ ¼å¼:
{
  "rewrittenQuery": "æŸ¥æ‰¾ 2025-12-16 åˆ° 2025-12-22 çš„æ‰€æœ‰ä¼šè®®å®‰æ’",
  "timeRange": {
    "start": "2025-12-16T00:00:00Z",
    "end": "2025-12-22T23:59:59Z"
  },
  "entities": ["ä¼šè®®"],
  "intent": "search"
}
    `.trim();
  }
}
```

---

### Phase 4: ä»£ç å®¡æŸ¥ (Reviewer AI)

**è¾“å…¥**: å®ç°çš„ä»£ç 

**æ­¥éª¤**:
1. æ£€æŸ¥ä»£ç è´¨é‡ï¼ˆå¯è¯»æ€§ã€æ€§èƒ½ã€å®‰å…¨æ€§ï¼‰
2. éªŒè¯å•å…ƒæµ‹è¯•è¦†ç›–ç‡
3. è¿è¡Œæµ‹è¯•é›†
4. æå‡ºæ”¹è¿›å»ºè®®

**å·¥å…·**:
```bash
# ä½¿ç”¨ Copilot Chat
@workspace /review src/services/queryRewriter.ts

# è¿è¡Œæµ‹è¯•
npm run test
node scripts/test-rag.js

# æ£€æŸ¥è¦†ç›–ç‡
npm run test:coverage
```

**å®¡æŸ¥æŠ¥å‘Šç¤ºä¾‹**:
```markdown
# ä»£ç å®¡æŸ¥æŠ¥å‘Š: queryRewriter.ts

**å®¡æŸ¥æ—¶é—´**: 2025-12-23 14:00
**å®¡æŸ¥äºº**: Reviewer AI

## âœ… ä¼˜ç‚¹

1. **ç±»å‹å®‰å…¨**: å®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰
2. **å¯æµ‹è¯•**: ä¾èµ–æ³¨å…¥ï¼Œæ˜“äº mock
3. **é”™è¯¯å¤„ç†**: try-catch åŒ…è£¹ API è°ƒç”¨

## âš ï¸ é—®é¢˜

### é«˜ä¼˜å…ˆçº§

1. **API å¯†é’¥ç¡¬ç¼–ç **
   - ä½ç½®: Line 24
   - é—®é¢˜: `process.env.OPENAI_API_KEY` å¯èƒ½ä¸º undefined
   - å»ºè®®: æ·»åŠ éªŒè¯ï¼ŒæŠ›å‡ºæ˜ç¡®é”™è¯¯

```typescript
if (!process.env.OPENAI_API_KEY) {
  throw new Error('OPENAI_API_KEY ç¯å¢ƒå˜é‡æœªè®¾ç½®');
}
```

2. **ç¼ºå°‘ç¼“å­˜**
   - é—®é¢˜: ç›¸åŒæŸ¥è¯¢ä¼šé‡å¤è°ƒç”¨ APIï¼ˆæµªè´¹æˆæœ¬ï¼‰
   - å»ºè®®: æ·»åŠ  LRU ç¼“å­˜

```typescript
private cache = new Map<string, StructuredQuery>();

async rewrite(query: string, ...): Promise<StructuredQuery> {
  const cacheKey = `${query}:${JSON.stringify(history)}`;
  if (this.cache.has(cacheKey)) {
    return this.cache.get(cacheKey);
  }
  // ... è°ƒç”¨ API
  this.cache.set(cacheKey, result);
  return result;
}
```

### ä¸­ä¼˜å…ˆçº§

3. **è¶…æ—¶å¤„ç†**
   - é—®é¢˜: API è°ƒç”¨å¯èƒ½è¶…æ—¶
   - å»ºè®®: æ·»åŠ  timeout å‚æ•°

4. **Fallback ç­–ç•¥**
   - é—®é¢˜: API å¤±è´¥æ—¶æ— é™çº§æ–¹æ¡ˆ
   - å»ºè®®: å®ç°åŸºäºè§„åˆ™çš„ fallback

## ğŸ“Š æµ‹è¯•è¦†ç›–ç‡

- **ç›®æ ‡**: > 80%
- **å®é™…**: 65%
- **ç¼ºå¤±**: é”™è¯¯å¤„ç†åˆ†æ”¯ã€è¾¹ç•Œæ¡ä»¶

**å»ºè®®è¡¥å……æµ‹è¯•**:
1. API è°ƒç”¨å¤±è´¥æ—¶çš„è¡Œä¸º
2. ç©ºå¯¹è¯å†å²çš„å¤„ç†
3. ç›¸å¯¹æ—¶é—´è¾¹ç•Œæƒ…å†µï¼ˆ"å»å¹´"ã€"æ˜å¹´"ï¼‰

## ğŸ¯ æ€»ä½“è¯„ä»·

**å¾—åˆ†**: 7.5/10

ä»£ç åŸºæœ¬ç¬¦åˆè¦æ±‚ï¼Œä½†éœ€è¦æ”¹è¿›é”™è¯¯å¤„ç†å’Œæ€§èƒ½ä¼˜åŒ–ã€‚
å»ºè®®ä¿®å¤é«˜ä¼˜å…ˆçº§é—®é¢˜åå†åˆå¹¶åˆ°ä¸»åˆ†æ”¯ã€‚
```

---

### Phase 5: é›†æˆæµ‹è¯•ä¸éªŒè¯ (Reviewer AI)

**è¾“å…¥**: å®Œæˆçš„åŠŸèƒ½æ¨¡å—

**æ­¥éª¤**:
1. è¿è¡Œå®Œæ•´æµ‹è¯•é›†
2. å¯¹æ¯”æ”¹è¿›å‰åçš„æŒ‡æ ‡
3. éªŒè¯æ˜¯å¦è¾¾åˆ°ç›®æ ‡
4. ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š

**å·¥å…·**:
```bash
# è¿è¡Œå®Œæ•´æµ‹è¯•
node scripts/test-rag.js

# å¯¹æ¯”æŠ¥å‘Š
node scripts/compare-test-results.js \
  --before test-results/rag-test-1703300000000.json \
  --after test-results/rag-test-1703310000000.json
```

**éªŒè¯æŠ¥å‘Šç¤ºä¾‹**:
```markdown
# RAG åŠŸèƒ½éªŒè¯æŠ¥å‘Š: æŸ¥è¯¢é‡å†™

**åŠŸèƒ½**: Query Rewriting
**ç‰ˆæœ¬**: v2.18.5
**æµ‹è¯•æ—¶é—´**: 2025-12-23 15:00

## ğŸ“Š æŒ‡æ ‡å¯¹æ¯”

| æŒ‡æ ‡ | æ”¹è¿›å‰ | æ”¹è¿›å | å˜åŒ– | ç›®æ ‡ | çŠ¶æ€ |
|------|--------|--------|------|------|------|
| é€šè¿‡ç‡ | 70% | 90% | +20% â†‘ | > 80% | âœ… |
| Precision@5 | 0.72 | 0.88 | +0.16 â†‘ | > 0.80 | âœ… |
| Recall@5 | 0.65 | 0.82 | +0.17 â†‘ | > 0.70 | âœ… |
| Faithfulness | 8.2 | 9.1 | +0.9 â†‘ | > 8.0 | âœ… |
| Avg Latency | 1.1s | 1.5s | +0.4s â†“ | < 2.0s | âš ï¸ |

## âœ… æ”¹è¿›æ•ˆæœ

### æ—¶é—´æ¨ç†å‡†ç¡®ç‡æå‡

**æ”¹è¿›å‰**:
- "é‚£ä¸Šå‘¨å‘¢ï¼Ÿ" â†’ æ£€ç´¢å¤±è´¥ï¼ˆæœªè§£ææ—¶é—´ï¼‰
- é€šè¿‡ç‡: 30% (3/10)

**æ”¹è¿›å**:
- "é‚£ä¸Šå‘¨å‘¢ï¼Ÿ" â†’ "2025-12-16 åˆ° 2025-12-22" âœ…
- é€šè¿‡ç‡: 90% (9/10)

**æ¡ˆä¾‹**:
```
Q: "é‚£ä¸Šå‘¨å‘¢ï¼Ÿ"
Context: ç”¨æˆ·åˆšé—®è¿‡ "æˆ‘è¿™å‘¨çš„ä¼šè®®å®‰æ’"

æ”¹è¿›å‰: æ£€ç´¢æ‰€æœ‰ä¼šè®®ï¼ˆæ— æ—¶é—´è¿‡æ»¤ï¼‰âŒ
æ”¹è¿›å: æ£€ç´¢ 2025-12-16 ~ 2025-12-22 çš„ä¼šè®® âœ…
```

### å¤šè·³æ¨ç†å®Œæ•´æ€§æå‡

**æ”¹è¿›å‰**:
- "æˆ‘å’Œå¼ ä¸‰è®¨è®ºçš„é¡¹ç›®è¿›å±•ï¼Ÿ" â†’ åªè¿”å›æœ€è¿‘ 1 æ¬¡ä¼šè®®
- å®Œæ•´æ€§å¾—åˆ†: 5/10

**æ”¹è¿›å**:
- é‡å†™ä¸º "æŸ¥æ‰¾æ‰€æœ‰ä¸å¼ ä¸‰ç›¸å…³çš„ä¼šè®®ï¼ŒæŒ‰æ—¶é—´æ’åº"
- æ£€ç´¢åˆ° 3 æ¬¡ä¼šè®®ï¼Œæ±‡æ€»é¡¹ç›®è¿›å±•
- å®Œæ•´æ€§å¾—åˆ†: 9/10

## âš ï¸ é—ç•™é—®é¢˜

1. **å»¶è¿Ÿå¢åŠ **:
   - åŸå› : æ–°å¢ LLM æŸ¥è¯¢é‡å†™æ­¥éª¤ (~400ms)
   - å½±å“: å¹³å‡å»¶è¿Ÿä» 1.1s å¢è‡³ 1.5s
   - ç¼“è§£: å·²æ·»åŠ ç¼“å­˜ï¼Œå‘½ä¸­ç‡ >70% åå»¶è¿Ÿä¼šé™è‡³ 1.2s

2. **API æˆæœ¬**:
   - æ¯æ¬¡æŸ¥è¯¢é‡å†™æ¶ˆè€— ~500 tokens ($0.0005)
   - é¢„ä¼°æœˆæˆæœ¬: 1000 æŸ¥è¯¢/å¤© Ã— 30 å¤© Ã— $0.0005 = $15/æœˆ
   - å¯æ¥å—èŒƒå›´å†…

## ğŸ¯ ç»“è®º

**çŠ¶æ€**: âœ… éªŒè¯é€šè¿‡

æŸ¥è¯¢é‡å†™åŠŸèƒ½æ˜¾è‘—æå‡äº†æ—¶é—´æ¨ç†å’Œå¤šè·³æ¨ç†çš„å‡†ç¡®ç‡ï¼Œæ ¸å¿ƒæŒ‡æ ‡å‡è¾¾åˆ°ç›®æ ‡ã€‚
è™½ç„¶å»¶è¿Ÿç•¥æœ‰å¢åŠ ï¼Œä½†åœ¨å¯æ¥å—èŒƒå›´å†…ï¼Œä¸”å¯é€šè¿‡ç¼“å­˜è¿›ä¸€æ­¥ä¼˜åŒ–ã€‚

**å»ºè®®**:
1. åˆå¹¶åˆ°ä¸»åˆ†æ”¯
2. ç›‘æ§ç”Ÿäº§ç¯å¢ƒçš„ API æˆæœ¬å’Œå»¶è¿Ÿ
3. ä¸‹ä¸€æ­¥ä¼˜åŒ–æ–¹å‘: å®ç° Rerank æå‡æ£€ç´¢ç²¾åº¦
```

---

### Phase 6: æ€»ç»“ä¸è§„åˆ’ (Orchestrator AI)

**è¾“å…¥**: éªŒè¯æŠ¥å‘Š

**æ­¥éª¤**:
1. æ±‡æ€»æ‰€æœ‰ç»“æœ
2. æ›´æ–°æ–‡æ¡£
3. è¯†åˆ«ä¸‹ä¸€æ­¥ä¼˜åŒ–æ–¹å‘
4. åˆ¶å®šæ–°çš„è¿­ä»£è®¡åˆ’

**å·¥å…·**:
```bash
# ä½¿ç”¨ Copilot
@workspace æ ¹æ® test-results/rag-verification-latest.md ç”Ÿæˆé¡¹ç›®æ€»ç»“ï¼ŒåŒ…æ‹¬æ”¹è¿›æ•ˆæœã€é—ç•™é—®é¢˜å’Œä¸‹ä¸€æ­¥è®¡åˆ’
```

**æ€»ç»“æŠ¥å‘Šç¤ºä¾‹**:
```markdown
# RAG ä¼˜åŒ–è¿­ä»£æ€»ç»“

**è¿­ä»£å‘¨æœŸ**: 2025-12-23
**ä¸»é¢˜**: æŸ¥è¯¢é‡å†™åŠŸèƒ½å®ç°
**çŠ¶æ€**: âœ… æˆåŠŸ

## ğŸ“ˆ æœ¬æ¬¡è¿­ä»£æˆæœ

1. **åŠŸèƒ½äº¤ä»˜**: 
   - âœ… å®ç° QueryRewriter æ¨¡å—
   - âœ… æ”¯æŒç›¸å¯¹æ—¶é—´è§£æï¼ˆ"ä¸Šå‘¨"ã€"æ˜å¤©"ï¼‰
   - âœ… æ”¯æŒä¸Šä¸‹æ–‡ç†è§£ï¼ˆå¯¹è¯å†å²ï¼‰

2. **è´¨é‡æå‡**:
   - é€šè¿‡ç‡: 70% â†’ 90%
   - Precision: 0.72 â†’ 0.88
   - Recall: 0.65 â†’ 0.82

3. **æŠ€æœ¯å€ºåŠ¡æ¸…ç†**:
   - æ·»åŠ äº†å•å…ƒæµ‹è¯•ï¼ˆè¦†ç›–ç‡ 75%ï¼‰
   - è¡¥å……äº† API æ–‡æ¡£

## ğŸ¯ ä¸‹ä¸€æ­¥è®¡åˆ’

### ä¼˜å…ˆçº§ 1: é›†æˆ Rerank API (é¢„è®¡ 1 å‘¨)

**ç›®æ ‡**: æå‡æ£€ç´¢ç²¾åº¦ 15-20%

**æ–¹æ¡ˆ**:
- é›†æˆ Jina AI Rerank API
- åœ¨æ£€ç´¢åã€ç”Ÿæˆå‰æ‰§è¡Œ Rerank
- æ·»åŠ æˆæœ¬æ§åˆ¶ï¼ˆä»…ä»˜è´¹ç”¨æˆ·ä½¿ç”¨ï¼‰

**é¢„æœŸæ•ˆæœ**:
- Precision@5: 0.88 â†’ 0.95
- æˆæœ¬: +$0.0002/æŸ¥è¯¢

### ä¼˜å…ˆçº§ 2: ä¼˜åŒ–ç³»ç»Ÿæç¤ºè¯ (é¢„è®¡ 2 å¤©)

**ç›®æ ‡**: å‡å°‘å¹»è§‰ï¼Œæå‡å¿ å®åº¦

**æ–¹æ¡ˆ**:
- åœ¨æç¤ºè¯ä¸­å¼ºè°ƒ "ä»…åŸºäºæ£€ç´¢åˆ°çš„æ–‡æ¡£å›ç­”"
- æ·»åŠ å¼•ç”¨æ ¼å¼è¦æ±‚
- å®ç°æ€ç»´é“¾ (Chain-of-Thought)

**é¢„æœŸæ•ˆæœ**:
- Faithfulness: 9.1 â†’ 9.5

### ä¼˜å…ˆçº§ 3: æ€§èƒ½ä¼˜åŒ– (é¢„è®¡ 3 å¤©)

**ç›®æ ‡**: é™ä½å»¶è¿Ÿè‡³ <1.2s

**æ–¹æ¡ˆ**:
- æŸ¥è¯¢é‡å†™ç¼“å­˜ (LRU, 1000 æ¡)
- å‘é‡æ£€ç´¢å¹¶è¡ŒåŒ–
- å®ç°æµå¼å“åº”ï¼ˆé¦–å­—å»¶è¿Ÿ <500msï¼‰

## ğŸ“š æ–‡æ¡£æ›´æ–°

- [ ] æ›´æ–° RAG_TEST_DATASET.mdï¼ˆæ–°å¢æ—¶é—´æ¨ç†æµ‹è¯•ç”¨ä¾‹ï¼‰
- [ ] æ›´æ–° AI_ChatFlow_PRD.mdï¼ˆè¡¥å……æŸ¥è¯¢é‡å†™è®¾è®¡ï¼‰
- [ ] åˆ›å»º QueryRewriter API æ–‡æ¡£

## ğŸ”„ ä¸‹æ¬¡è¿­ä»£æ—¶é—´

**è®¡åˆ’å¼€å§‹**: 2025-12-24
**ä¸»é¢˜**: Rerank é›†æˆ
**é¢„è®¡å®Œæˆ**: 2025-12-30
```

---

## ğŸ® è°ƒè¯•ä¸åŒ AI è§’è‰²çš„æ–¹æ³•

### æ–¹æ³• 1: VS Code Copilot Chat å¤šçª—å£

```
# Terminal 1: Orchestrator AI
> æ–°å»ºèŠå¤©çª—å£
> è¾“å…¥: @workspace ä½ æ˜¯é¡¹ç›®ç»ç†,å¸®æˆ‘è§„åˆ’RAGä¼˜åŒ–ä»»åŠ¡

# Terminal 2: Reviewer AI  
> æ–°å»ºèŠå¤©çª—å£
> è¾“å…¥: @workspace ä½ æ˜¯QAå·¥ç¨‹å¸ˆ,åˆ†ææµ‹è¯•æŠ¥å‘Š test-results/rag-test-latest.md

# Inline Chat: Developer AI
> åœ¨ä»£ç ç¼–è¾‘å™¨ä¸­ Ctrl+I
> è¾“å…¥: å®ç°æŸ¥è¯¢é‡å†™åŠŸèƒ½
```

### æ–¹æ³• 2: è‡ªå®šä¹‰ CLI å·¥å…·

```bash
# è°ƒç”¨ä¸åŒè§’è‰²
node scripts/ai-workflow.js --role orchestrator --input "ä¼˜åŒ–RAGæ£€ç´¢ç²¾åº¦"
node scripts/ai-workflow.js --role reviewer --input test-results/rag-test-latest.md
node scripts/ai-workflow.js --role developer --input "å®ç°æŸ¥è¯¢é‡å†™"

# å®Œæ•´å·¥ä½œæµ
node scripts/ai-workflow.js --workflow optimize-rag --task "æå‡æ£€ç´¢ç²¾åº¦"
```

### æ–¹æ³• 3: API Playground

åœ¨æµè§ˆå™¨ä¸­æµ‹è¯•ä¸åŒè§’è‰²çš„æç¤ºè¯ï¼š

1. æ‰“å¼€ https://platform.openai.com/playground
2. æµ‹è¯•ä¸åŒçš„ system prompt
3. å¯¹æ¯”è¾“å‡ºè´¨é‡
4. è°ƒä¼˜æ¸©åº¦å‚æ•°ï¼ˆOrchestrator: 0.3, Reviewer: 0.2, Developer: 0.1ï¼‰

### æ–¹æ³• 4: æœ¬åœ°æµ‹è¯•è„šæœ¬

```javascript
// scripts/test-ai-roles.js

const roles = ['orchestrator', 'reviewer', 'developer'];
const testInput = "ä¼˜åŒ– RAG æ£€ç´¢ç²¾åº¦";

for (const role of roles) {
  console.log(`\n===== ${role.toUpperCase()} =====`);
  const response = await callAI(role, testInput);
  console.log(response);
}
```

---

## âœ… å¿«é€Ÿå¼€å§‹æ¸…å•

- [ ] **Step 1**: åˆ›å»ºæµ‹è¯•æ•°æ®é›† (`docs/tests/RAG_TEST_DATASET.md`)
- [ ] **Step 2**: ç¼–å†™æµ‹è¯•è„šæœ¬ (`scripts/test-rag.js`)
- [ ] **Step 3**: è¿è¡ŒåŸºçº¿æµ‹è¯• (`node scripts/test-rag.js`)
- [ ] **Step 4**: åˆ†æå¤±è´¥ç”¨ä¾‹ï¼ˆReviewer AIï¼‰
- [ ] **Step 5**: å®ç°æ”¹è¿›ï¼ˆDeveloper AIï¼‰
- [ ] **Step 6**: é‡æ–°æµ‹è¯•éªŒè¯ï¼ˆReviewer AIï¼‰
- [ ] **Step 7**: æ±‡æ€»è¿­ä»£æˆæœï¼ˆOrchestrator AIï¼‰
- [ ] **Step 8**: è§„åˆ’ä¸‹ä¸€æ¬¡è¿­ä»£ï¼ˆOrchestrator AIï¼‰

---

**ç»´æŠ¤è€…**: GitHub Copilot  
**æœ€åæ›´æ–°**: 2025-12-23
