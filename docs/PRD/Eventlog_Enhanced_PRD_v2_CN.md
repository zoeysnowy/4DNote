# Eventlog Enhanced â€” äº§å“éœ€æ±‚æ–‡æ¡£ v3.0

**äº§å“åç§°ï¼š** 4DNote â€” æ™ºèƒ½è®°å¿†ä¸å™äº‹ç³»ç»Ÿ  
**ç‰ˆæœ¬ï¼š** v3.0ï¼ˆAI-Native å¢å¼ºç‰ˆï¼‰  
**çŠ¶æ€ï¼š** å·²æ‰¹å‡†å¼€å‘  
**æœ€åæ›´æ–°ï¼š** 2026-01-08

**æ¶æ„å¯¹é½**ï¼šä¸¥æ ¼éµå¾ª [EVENT_FIELD_CONTRACT_SSOT_ARCHITECTURE.md](../architecture/EVENT_FIELD_CONTRACT_SSOT_ARCHITECTURE.md) Â§ 0.4 Signal å­—æ®µå¥‘çº¦

---

## 0. æ‰§è¡Œæ‘˜è¦

**äº§å“æ„¿æ™¯**  
å°†ç¢ç‰‡åŒ–çš„æ—¥å¸¸äº¤äº’ï¼ˆæ€è€ƒã€ä¼šè®®ã€AI å¯¹è¯ã€ç½‘é¡µå‰ªè—ï¼‰è½¬åŒ–ä¸ºç»“æ„åŒ–ã€å¯å›é¡¾çš„å™äº‹è®°å¿†ï¼Œç”¨æˆ·æŠ•å…¥æœ€å°‘ç²¾åŠ›ã€‚

**æ ¸å¿ƒä»·å€¼ä¸»å¼ **  
- **å¯¹äºå¿™ç¢Œçš„ä¸“ä¸šäººå£«**ï¼šé€šè¿‡è‡ªåŠ¨ç”Ÿæˆçš„æ—¶é—´éª¨æ¶å™äº‹ï¼Œè·å¾—"ä»Šå¤©æˆ‘åšäº†ä»€ä¹ˆ"çš„å®‰å¿ƒæ„Ÿ
- **å¯¹äºçŸ¥è¯†å·¥ä½œè€…**ï¼šé€šè¿‡æ™ºèƒ½æ”¶è·æ•è·å’ŒåŸºäºè¯æ®çš„å›é¡¾ï¼Œæç‚¼"ä»Šå¤©æˆ‘ç†è§£äº†ä»€ä¹ˆ"
- **å¯¹äº AI æ·±åº¦ç”¨æˆ·**ï¼šé€šè¿‡è‡ªåŠ¨ç»“ç®—æœºåˆ¶ï¼Œå°†é•¿æ—¶é—´ AI åä½œä¼šè¯è½¬åŒ–ä¸ºæ¸…æ™°ã€å¯å¤ç”¨çš„æ”¶è·
- **å¯¹äºä¼šè®®å‚ä¸è€…**ï¼šç”¨æ™ºèƒ½å®šå¸§å¿«ç…§æ•è·è§†è§‰è¯æ®ï¼Œè€Œéä¾µå…¥æ€§çš„å…¨ç¨‹å½•å±
- **å¯¹äºéŸ³é¢‘ç¬”è®°ç”¨æˆ·**ï¼šé€šè¿‡ RECNote é”šç‚¹å°†éŸ³é¢‘ä¸æ–‡å­—ç¬”è®°åŒæ­¥ï¼Œå®ç°è½»æ¾çš„å›æ”¾å¯¼èˆª

**è®¾è®¡å“²å­¦**  
- **åŸºäºæ¥æºçš„ä¿¡å·ä¼˜äºè¯­ä¹‰çŒœæµ‹**ï¼šç”¨æˆ·è¡Œä¸ºï¼ˆé«˜äº®ã€æ‰‹åŠ¨æ ‡è®°ã€ç–‘é—®ï¼‰é©±åŠ¨ä¼˜å…ˆçº§æ’åº
- **å¤åˆ©å¼å›é¡¾**ï¼šæ¯æ—¥ â†’ æ¯å‘¨ â†’ æ¯æœˆå™äº‹é€šè¿‡è¯æ®ç§¯ç´¯ç›¸äº’æ„å»º
- **æœ¬åœ°ä¼˜å…ˆçš„éšç§ä¿æŠ¤**ï¼šéŸ³é¢‘å’Œæˆªå›¾é»˜è®¤å­˜å‚¨åœ¨è®¾å¤‡ä¸Šï¼›äº‘åŒæ­¥å¯é€‰
- **é›¶ç„¦è™‘å½’æ¡£**ï¼šæ‰€æœ‰äº¤äº’è‡ªåŠ¨æ•è·ä¸ºæ½œåœ¨è¯æ®ï¼Œå¯éšæ—¶è¿‡æ»¤/æ£€ç´¢

---

## 0.A æ ¸å¿ƒæ¶æ„å†³ç­–ï¼ˆSSOT å¯¹é½ï¼‰

> **æœ¬èŠ‚ç›®çš„**ï¼šæ˜ç¡® Eventlog Enhanced çš„æ ¸å¿ƒæ¶æ„çº¦æŸï¼Œç¡®ä¿æ‰€æœ‰åŠŸèƒ½å®æ–½éµå¾ª SSOTã€‚

### 0.A.1 Format vs Signal æ¶æ„è¾¹ç•Œ

| ç»´åº¦ | Formatï¼ˆæ ¼å¼ï¼‰ | Signalï¼ˆä¿¡å·ï¼‰ |
|------|---------------|---------------|
| **å®šä½** | Presentation Layerï¼ˆè¡¨ç°å±‚ï¼‰ | Semantic/Domain Layerï¼ˆè¯­ä¹‰å±‚ï¼‰ |
| **å­˜å‚¨** | `EventLog.slateJson`ï¼ˆSlate JSONï¼‰ | `signals` è¡¨ï¼ˆç‹¬ç«‹å­˜å‚¨ï¼‰ |
| **ç¤ºä¾‹** | `{ text: "é‡ç‚¹", bold: true, backgroundColor: "#FFFF00" }` | `{ type: 'highlight', content: "é‡ç‚¹", eventId: 'xxx' }` |
| **æŸ¥è¯¢** | éœ€è§£æå®Œæ•´ JSON | ç›´æ¥ SQL/ç´¢å¼•æŸ¥è¯¢ |
| **åŒæ­¥** | âœ… åŒæ­¥åˆ° Outlookï¼ˆ`EventLog.html` åŒ…å«æ ·å¼ï¼‰ | âŒ æœ¬åœ°ä¸“å±ï¼Œä¸åŒæ­¥ |
| **Owner** | UI å±‚ + EventServiceï¼ˆåºåˆ—åŒ–ï¼‰ | SignalServiceï¼ˆCRUD + ä¸€è‡´æ€§ï¼‰ |
| **AI å¯ç”¨æ€§** | âŒ éœ€è¦è§£æ JSONï¼Œæ•ˆç‡ä½ | âœ… ç›´æ¥æŸ¥è¯¢èšåˆï¼Œæ”¯æŒ RAG |

**å…³é”®çº¦æŸ**ï¼š
1. âŒ **Event ä¸å¾—å­˜å‚¨ Signal ç»†èŠ‚**ï¼ˆ`isHighlight`/`signalCount` ç­‰ç¦æ­¢ï¼‰
2. âœ… **å…è®¸ Derived Store/Index**ï¼ˆå¯é‡å»ºã€ç‹¬ç«‹è¡¨ï¼›ä¸å¾—å†™å› Event å­—æ®µï¼‰
3. âŒ **SignalService ä¸å¾—ä¿®æ”¹** `EventLog.slateJson`
4. âœ… **EventService å¯åªè¯»** `slateJson` æå–æ ¼å¼ä¿¡æ¯ï¼ˆç”¨äº AI è¾…åŠ©è¯†åˆ«ï¼‰

### 0.A.2 Session åˆ†å±‚æ¶æ„ï¼ˆAttention/Dwell vs User Eventï¼‰

**é—®é¢˜**ï¼šEventlog Enhanced é‡Œçš„â€œtimerâ€ä¸»è¦æŒ‡ **é¡µé¢åœç•™/ä¸“æ³¨çª—å£ï¼ˆdwell/attentionï¼‰è®¡æ—¶**ï¼Œå®ƒæ˜¯åå°ç»Ÿè®¡å­—æ®µï¼Œç”¨äºé‡è¦æ€§è¯„åˆ†ä¸æ—¥æŠ¥/æ—¥è®°ç”Ÿæˆï¼›ä¸åº”è¢«å»ºæ¨¡ä¸ºå¯åŒæ­¥çš„ Behavior(Timeblock)ï¼Œä¹Ÿä¸åº”åˆ›å»ºé¢å¤– Event ä»¥å…æ±¡æŸ“æ ‘ç»“æ„ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
- **dwell/attention è®¡æ—¶åªäº§ç”Ÿæœ¬åœ°æ´¾ç”Ÿæ•°æ®**ï¼ˆä¾‹å¦‚ `Signal.behaviorMeta.totalDwellTime`ã€`focus_time` ä¿¡å·ã€æˆ–ç‹¬ç«‹çš„ `event_attention_stats` Derived Storeï¼‰ï¼Œä¸åˆ›å»ºæ–°çš„ Eventã€‚
- Plan/Library ç­‰è§†å›¾åªæ¶ˆè´¹ `events`ï¼Œå¯é€šè¿‡ **facets + view configuration** åšæ˜¾ç¤ºç­–ç•¥ï¼ˆä½†ä¸ dwell/attention timer æ— å¼ºç»‘å®šï¼‰ã€‚

```typescript
// Facets æ˜¯ Derived Indexï¼ˆå¯é‡å»ºï¼‰ï¼Œä¸æ˜¯ Event å­—æ®µ
type EventFacet = 'inbox' | 'archived' | 'system' | 'hidden';

interface EventFacetsIndex {
  getFacets(eventId: string): Set<EventFacet>;
}

interface EventViewConfig {
  excludeFacets?: EventFacet[];
}

const planView: EventViewConfig = {
  excludeFacets: ['system', 'hidden'],
};

EventTreeAPI.buildTree(events, {
  view: planView,
  facetsIndex,
});
```

> è¯´æ˜ï¼šè¿™é‡Œçš„ **Attention** æŒ‡â€œç”¨æˆ·æ³¨æ„åŠ›/åœç•™ï¼ˆdwellï¼‰â€çš„äº§å“è¯­ä¹‰ï¼Œä¸æ˜¯ Transformer æ¨¡å‹é‡Œçš„ attention æœºåˆ¶ã€‚

**dwell/attention Timer â†’ AttentionSession æµç¨‹ï¼ˆæœ¬åœ°ã€åå°ï¼‰**ï¼š
```typescript
// 1. Start tracking â†’ æ‰“å¼€ä¸€æ¬¡æ³¨æ„åŠ›ä¼šè¯ï¼ˆä»…æœ¬åœ°ï¼‰
const attentionSessionId = await AttentionTracker.start({
  eventId: userEventId,
  startTime: formatTimeForStorage(new Date()),
});

// 2. å†™ç¬”è®° â†’ ä»å†™å…¥è¯¥ Event çš„ EventLog
const timestampNode = {
  type: 'timestamp',
  time: formatTimeForStorage(new Date()),
  children: [/* paragraphs */]
};

// 3. Stop tracking â†’ å…³é—­ä¼šè¯å¹¶è§¦å‘ Session Briefï¼ˆtarget = attentionSessionIdï¼‰
await AttentionTracker.stop(attentionSessionId, {
  endTime: formatTimeForStorage(new Date()),
});
await SessionBriefService.generateForAttentionSession(attentionSessionId);
```

### 0.A.3 Artifact æ¶æ„ï¼ˆæ•´ç†äº§ç‰©ï¼‰

**é—®é¢˜**ï¼šSession Brief / Daily Review ç­‰ AI ç”Ÿæˆå†…å®¹å­˜å“ªé‡Œï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**ï¼šå¼•å…¥ç‹¬ç«‹çš„ `Artifact` å®ä½“

```typescript

```typescript
interface Artifact {
  id: string;                     // artifact_${nanoid(21)}
  scope: 'session' | 'event' | 'daily' | 'weekly' | 'monthly' | 'quarterly' | 'yearly';
  
  /**
   * ç›®æ ‡å¯¹è±¡ ID
   * æ ¼å¼: å–å†³äº scope
   * ç”¨é€”: æ ‡è¯† Artifact ç”Ÿæˆçš„ç›®æ ‡å¯¹è±¡
   * ç¤ºä¾‹:
   *   - scope='session' â†’ targetId = attentionSessionId (å¦‚ "attentionSession_abc123")
   *   - scope='daily' â†’ targetId = æ—¥æœŸå­—ç¬¦ä¸² (å¦‚ "2026-01-08")
   *   - scope='weekly' â†’ targetId = å‘¨æ ‡è¯† (å¦‚ "2026-W02")
   *   - scope='monthly' â†’ targetId = æœˆæ ‡è¯† (å¦‚ "2026-01")
   *   - scope='event' â†’ targetId = eventId (å¦‚ "event_xyz789")
   */
  targetId: string;
  
  type: 'brief' | 'rolling_summary' | 'action_items' | 'qa' | 'outline';
  contentJson: {                  // ç»“æ„åŒ–å†…å®¹ï¼ˆå›ºå®š schemaï¼‰
    tldr?: string[];
    key_points?: Array<{ id: string; text: string; confidence: number }>;
    decisions?: Array<{ id: string; text: string; confidence: number }>;
    action_items?: Array<{ id: string; text: string; owner?: string; due?: string }>;
    open_questions?: Array<{ id: string; text: string }>;
  };
  createdAt: string;              // YYYY-MM-DD HH:mm:ss
  updatedAt: string;
  modelInfo?: {                   // AI æ¨¡å‹ä¿¡æ¯
    model: string;
    version: string;
    promptHash: string;
  };
  status: 'draft' | 'accepted' | 'edited';
}
```

**Owner**ï¼š`ArtifactService`ï¼ˆå¾…å®æ–½ï¼‰

**å­˜å‚¨**ï¼š`artifacts` è¡¨ï¼ˆIndexedDBï¼‰

**ä¸ EventNode çš„å…³ç³»**ï¼š
- `Artifact.contentJson` ä¸­çš„å¼•ç”¨ç”¨ `claimId`ï¼ˆå†…éƒ¨ç¨³å®š IDï¼‰
- `EvidenceLink` è¡¨å…³è”åˆ° `EventNode.nodeId` æˆ– `timestampId`

### 0.A.4 EvidenceLink æ¶æ„ï¼ˆè¯æ®é“¾ï¼‰

**ç”¨é€”**ï¼šæ¯æ¡ AI ç”Ÿæˆçš„ç»“è®ºå¿…é¡»å¸¦è¯æ®ï¼Œå¯ç‚¹å‡»å›è·³

```typescript
interface EvidenceLink {
  id: string;
  targetArtifactId: string;       // å…³è”çš„ Artifact
  claimId: string;                // Artifact å†…æŸæ¡ç»“è®ºçš„ ID
  sourceType: 'eventlog_timestamp' | 'transcript_chunk' | 'signal';
  sourceRef: {
    // timestamp: { eventId, timestampId }
    // transcript: { attentionSessionId, chunkId, tStart, tEnd }
    // signal: { signalId }
    [key: string]: any;
  };
  quote?: string;                 // å¼•ç”¨çš„åŸæ–‡ç‰‡æ®µ
  confidence: number;             // ç½®ä¿¡åº¦ (0-1)
}
```

**ç¡¬è§„åˆ™**ï¼š
- âŒ **æ— è¯æ®ä¸è¾“å‡º**ï¼ˆæˆ–é™çº§ä¸º "Needs review"ï¼‰
- âœ… æ¯æ¡ claim è‡³å°‘ 1 æ¡ EvidenceLinkï¼ˆæ¨è 1-3 æ¡ï¼‰

### 0.A.5 Summary ç”Ÿæˆç­–ç•¥ï¼ˆroots vs sproutï¼‰

**ç³»ç»Ÿä¸»åŠ¨ç”Ÿæˆ**ï¼ˆrootsï¼‰ï¼š
```typescript
type RootsSummary = 
  | 'daily'      // æ¯æ—¥å™äº‹ï¼ˆæ™š 9 ç‚¹æˆ–æ‰‹åŠ¨ï¼‰
  | 'weekly'     // æ¯å‘¨ç»¼åˆï¼ˆå‘¨æ—¥æ™šï¼‰
  | 'monthly'    // æ¯æœˆå›é¡¾ï¼ˆæœˆæœ«ï¼‰
  | 'quarterly'  // å­£åº¦æ€»ç»“ï¼ˆå­£æœ«ï¼‰
  | 'yearly';    // å¹´åº¦å›é¡¾ï¼ˆå¹´æœ«ï¼‰

// è‡ªåŠ¨è§¦å‘ + å¤åˆ©å¼èšåˆ
daily â†’ weekly â†’ monthly â†’ quarterly â†’ yearly
```

**ç”¨æˆ·æ‰‹åŠ¨è§¦å‘**ï¼ˆsproutï¼‰ï¼š
```typescript
type SproutSummary = 
  | 'ai_chat';    // AI å¯¹è¯æ€»ç»“ï¼ˆæŒ‰éœ€ç”Ÿæˆï¼Œä¸å‚ä¸è‡ªåŠ¨èšåˆï¼‰

// ç‹¬ç«‹å­˜åœ¨ï¼Œä¸å‚ä¸ roots çš„å¤åˆ©å¼èšåˆ
```

### 0.A.6 SignalEmbedding æ¶æ„ï¼ˆRAG å‘é‡ç´¢å¼•ï¼‰

**é—®é¢˜**ï¼šembedding ä½œä¸º signals è¡¨å­—æ®µè¿‡é‡ï¼Œä¸”æ¨¡å‹åå†™æ­»

**è§£å†³æ–¹æ¡ˆ**ï¼šembedding æ‹†åˆ°ç‹¬ç«‹è¡¨ + æ¨¡å‹ç‰ˆæœ¬æŠ½è±¡åŒ–

```typescript
interface SignalEmbedding {
  signalId: string;              // ä¸»é”®ï¼Œå¤–é”® â†’ signals.id
  modelVersion: EmbeddingModelVersion; // æŠ½è±¡ç‰ˆæœ¬ï¼ˆéšè—ä¾›åº”å•†ç»†èŠ‚ï¼‰
  embedding: Float32Array;       // å‘é‡æ•°æ® (1536/3072 ç»´)
  dimension: number;
  generatedAt: string;
  status: 'valid' | 'stale' | 'pending';
  computeTimeMs?: number;
}

type EmbeddingModelVersion = 
  | 'v1'        // å†…éƒ¨ä»£å·ï¼ˆéšè— OpenAI/Cohere/æœ¬åœ°æ¨¡å‹ï¼‰
  | 'v2' | 'v3' | 'legacy';

// å®é™…æ˜ å°„ï¼ˆå®ç°å±‚ï¼Œä¸å†™å…¥ PRDï¼‰
const MODEL_IMPL = {
  'v1': { provider: 'openai', model: 'text-embedding-3-small', dim: 1536 },
  'v2': { provider: 'openai', model: 'text-embedding-3-large', dim: 3072 },
};
```

**Owner**ï¼š`RAGIndexService`ï¼ˆPhase 4 å®æ–½ï¼‰

**å­˜å‚¨**ï¼š`signal_embeddings` è¡¨ï¼ˆIndexedDBï¼‰

**ä¼˜åŠ¿**ï¼š
- âœ… æ ¸å¿ƒ signals è¡¨è½»é‡ï¼ˆ~1KB/æ¡ vs ~7KB/æ¡ï¼‰
- âœ… æ•´è¡¨å¯åˆ é™¤é‡å»ºï¼Œä¸å½±å“ Signal æœ¬èº«
- âœ… æ¨¡å‹å‡çº§æ—¶å¯å¹¶å­˜å¤šç‰ˆæœ¬ï¼ˆA/B æµ‹è¯•ï¼‰
- âœ… ä¾›åº”å•†æ— å…³ï¼ˆå¯éšæ—¶æ›¿æ¢ OpenAI â†’ æœ¬åœ°æ¨¡å‹ï¼‰

**çŠ¶æ€è½¬æ¢**ï¼š
- Signal åˆ›å»º â†’ å¼‚æ­¥ç”Ÿæˆ embedding (`status=pending`)
- Signal.content æ›´æ–° â†’ æ ‡è®° `status=stale`ï¼Œå¼‚æ­¥é‡å»º
- Signal åˆ é™¤ â†’ çº§è”åˆ é™¤ embedding

### 0.A.7 è¡Œä¸ºæ•°æ®å­˜å‚¨ç­–ç•¥

**behaviorMeta å­˜å‚¨å†…å®¹**ï¼ˆSSOT ç¡®è®¤ï¼‰ï¼š

âœ… **å¿…é¡»å­˜å‚¨**ï¼ˆç”¨äº AI ç”Ÿæˆ Daily Reviewï¼‰ï¼š
```typescript
behaviorMeta: {
  // æ–‡æœ¬å†…å®¹ï¼ˆRAG æ£€ç´¢ + AI æ€»ç»“ï¼‰
  selectedText: string;       // ç”¨æˆ·é€‰ä¸­çš„æ–‡å­—
  nodeSummary: string;        // Node summary as chunk
  articleSummary: string;     // Article summary
  
  // èšåˆç»Ÿè®¡ï¼ˆåªå­˜æ€»é‡ï¼‰
  actionCount: number;
  totalDwellTime: number;     // æ¯«ç§’
}
```

âŒ **ç¦æ­¢å­˜å‚¨**ï¼ˆé¿å…æ•°æ®è†¨èƒ€ï¼‰ï¼š
```typescript
// ä¸å­˜å‚¨åŸå§‹äº‹ä»¶æµ
mouseMovements: MouseEvent[];  // âŒ
scrollEvents: ScrollEvent[];   // âŒ
```

**ä¾‹å¤–**ï¼ˆFocus Windowï¼Œå¯é€‰ï¼‰ï¼š
- ä¼šè®®é‡ç‚¹æ—¶æ®µå¯å­˜å‚¨è¯¦ç»†æµåˆ° `session_details` è¡¨ï¼ˆç‹¬ç«‹äº signalsï¼‰

---

## 1. äº§å“èƒŒæ™¯ä¸ç”¨æˆ·é—®é¢˜

### 1.1 ç›®æ ‡ç”¨æˆ·

**æ ¸å¿ƒäººç¾¤**
1. **çŸ¥è¯†å·¥ä½œè€…**ï¼ˆç ”ç©¶è€…ã€å·¥ç¨‹å¸ˆã€åˆ†æå¸ˆï¼‰
   - é‡åº¦ç¬”è®°ç”¨æˆ·ï¼Œå¸¸å›°æƒ‘"é‚£ä¸ªæƒ³æ³•æˆ‘åœ¨å“ªå„¿è§è¿‡ï¼Ÿ"
   - ä¸ AI æ·±åº¦å¯¹è¯äº§ç”Ÿå¤§é‡æ´è§ï¼Œä½†æ·¹æ²¡åœ¨èŠå¤©è®°å½•ä¸­
   
2. **ä¼šè®®å¯†é›†å‹ä¸“ä¸šäººå£«**ï¼ˆç®¡ç†è€…ã€å’¨è¯¢å¸ˆï¼‰
   - éœ€è¦ä¼šè®®çºªè¦ä½†åŒæ¶æ‰‹åŠ¨è®°å½•
   - å¯¹å…¨ç¨‹å½•å±æœ‰éšç§é¡¾è™‘
   
3. **åæ€å‹å­¦ä¹ è€…**ï¼ˆå­¦ç”Ÿã€è‡ªæˆ‘æå‡çˆ±å¥½è€…ï¼‰
   - å¸Œæœ›å›é¡¾"è¿™å‘¨ä»€ä¹ˆå¼•èµ·äº†æˆ‘çš„å…±é¸£"
   - éš¾ä»¥ä¿æŒæ—¥è®°ä¹ æƒ¯çš„è¿ç»­æ€§

### 1.2 ç”¨æˆ·ç—›ç‚¹

**P1ï¼šç¢ç‰‡åŒ–ä¸ä¸¢å¤±**ï¼ˆç¢ç¢å¿µç»´æŠ¤æˆæœ¬é«˜ï¼‰
- ç¬”è®°åˆ†æ•£åœ¨å„ç§å·¥å…·ä¸­ï¼ˆèŠå¤©è®°å½•ã€æ–‡æ¡£ã€ä¾¿ç­¾ï¼‰
- æ²¡æœ‰è‡ªåŠ¨æ•´åˆæœºåˆ¶ â†’ æ‰‹åŠ¨å¤åˆ¶ç²˜è´´è´Ÿæ‹…
- é‡è¦æƒ³æ³•æ·¹æ²¡åœ¨å™ªéŸ³ä¸­

**P2ï¼šæƒ…æ„Ÿè¯­å¢ƒä¸å¯æ£€ç´¢**ï¼ˆæƒ…ç»ª/æŒ£æ‰ä¸å¯æœç´¢ï¼‰
- "æˆ‘è®°å¾—ä¸Šå‘¨äºŒå¯¹æŸäº‹å¾ˆå…´å¥‹" â†’ æ— æ³•æœç´¢
- å…³é”®æŒ£æ‰/çªç ´åœ¨æ²¡æœ‰åˆ»æ„è®°å½•æ—¶ä¸¢å¤±

**P3ï¼šAI å¯¹è¯æ²‰æ·€å›°éš¾**ï¼ˆAI å¯¹è¯æ²‰æ·€éš¾ï¼‰
- é•¿æ—¶é—´ AI åä½œä¼šè¯äº§ç”Ÿä»·å€¼ä½†ç¼ºä¹ç»“æ„åŒ–è¾“å‡º
- æ´è§ä»…ä»¥èŠå¤©å†å²å½¢å¼å­˜åœ¨ï¼Œæ— æ³•æˆä¸ºå¯å¤ç”¨çš„çŸ¥è¯†å¡ç‰‡

**P4ï¼šä¼šè®®è¯æ®è¿‡è½½**ï¼ˆä¼šè®®è¯æ®æˆæœ¬é«˜ï¼‰
- å…¨ç¨‹å½•å± = å­˜å‚¨è†¨èƒ€ + éšç§æ‹…å¿§
- æ‰‹åŠ¨æˆªå›¾æ—¶æœºæŠŠæ¡å›°éš¾ï¼Œé”™è¿‡å…³é”®æ—¶åˆ»
- éŸ³é¢‘-ç¬”è®°åŒæ­¥éœ€è¦æ‰‹åŠ¨æ‰“æ—¶é—´æˆ³

### 1.3 å¸‚åœºæœºä¼š

**å¸‚åœºç©ºç™½**
- Granolaï¼šä¼šè®®ç¬”è®°å‡ºè‰²ä½†ç¼ºä¹æ—¥å¸¸å™äº‹è¿ç»­æ€§
- Reflect/Memï¼šé€‚åˆæ‰‹åŠ¨è¾“å…¥ï¼Œè‡ªåŠ¨è¯æ®æ•è·èƒ½åŠ›å¼±
- Notion/Obsidianï¼šåŠŸèƒ½å¼ºå¤§ä½†éœ€è¦å‰æœŸæ‰‹åŠ¨ç»„ç»‡

**æˆ‘ä»¬çš„å·®å¼‚åŒ–ä¼˜åŠ¿**ï¼šè‡ªåŠ¨è¯æ®æ”¶é›† + æ™ºèƒ½å›é¡¾åˆæˆ + éšç§ä¼˜å…ˆè®¾è®¡

---

## 2. æ ¸å¿ƒæ¦‚å¿µä¸æœ¯è¯­

### 2.1 ç»“æ„åŸè¯­

**Note** (æ–‡æ¡£)  
ä»£è¡¨ä¸€å¤©ã€ä¸€ä¸ªé¡¹ç›®æˆ–ä¸€ä¸ªä¸»é¢˜çš„é¡¶å±‚å®¹å™¨ã€‚åŒ…å«å¤šä¸ª Paragraphã€‚

**Paragraph** (æ®µè½)  
å—çº§å†…å®¹å•å…ƒã€‚å¯ä»¥æ˜¯ï¼š
- Text bodyï¼ˆæ€è€ƒã€è®°å½•ï¼‰
- Headingï¼ˆæ ‡é¢˜ï¼‰
- AI Answerï¼ˆQ&A ç»“æœï¼‰
- Summary Cardï¼ˆå¤šå¡é›†æˆæ€»ç»“ï¼‰
- Web Clipï¼ˆå¸¦æ¥æºçš„å¼•ç”¨ï¼‰

**Anchor** (é”šç‚¹)  
å¯¹å…¶ä»– Paragraph/Card çš„å†…è”å¼•ç”¨ï¼Œå®ç°åŒå‘é“¾æ¥ã€‚

**Card** (å¡ç‰‡)  
å„ç§å†…å®¹ç±»å‹çš„ç»Ÿä¸€æŠ½è±¡ï¼ˆAnswerã€Summaryã€Clipã€Resonanceï¼‰ã€‚æ‰€æœ‰å¡ç‰‡ä»¥ç‰¹æ®Š Paragraph å½¢å¼å­˜å‚¨ï¼Œå¸¦ `meta.card_type`ã€‚

### 2.2 è¯æ®ä¸è®°å¿†ç³»ç»Ÿ

**EventLog** (äº‹ä»¶æ—¥å¿—)  
æ‰€æœ‰ç”¨æˆ·äº¤äº’çš„ä¸å¯å˜æ—¥å¿—ï¼Œå¸¦æ—¶é—´æˆ³å…ƒæ•°æ®ï¼š
- `ASK_AI`ï¼ˆæé—® AIï¼‰ã€`ANSWER_RECEIVED`ï¼ˆæ”¶åˆ°å›ç­”ï¼‰
- `CARD_EXPANDED`ï¼ˆå±•å¼€å¡ç‰‡ï¼‰ã€`CARD_COLLAPSED`ï¼ˆæŠ˜å å¡ç‰‡ï¼‰
- `HIGHLIGHT_ADDED`ï¼ˆæ·»åŠ é«˜äº®ï¼‰ã€`TAG_CHANGED`ï¼ˆæ ‡ç­¾å˜æ›´ï¼‰
- `SESSION_STARTED`ï¼ˆä¼šè¯å¼€å§‹ï¼‰ã€`SESSION_ENDED`ï¼ˆä¼šè¯ç»“æŸï¼‰

**Signal** (é‡ç‚¹ä¿¡å·)  
**ç‹¬ç«‹çš„è¯­ä¹‰å±‚å®ä½“**ï¼Œä¸ Event é€šè¿‡ `eventId` æ¾è€¦åˆã€‚ç”¨æˆ·ä¸»åŠ¨æ ‡è®°æˆ–ç³»ç»Ÿæ•è·çš„é‡è¦æ€§æŒ‡ç¤ºã€‚

**æ¶æ„å®šä½**ï¼š
- **å­˜å‚¨**ï¼šç‹¬ç«‹ `signals` è¡¨ï¼ˆIndexedDB/SQLiteï¼‰ï¼Œ**ä¸å­˜å‚¨åœ¨ Event ä¸­**
- **Owner**ï¼š`SignalService`ï¼ˆå”¯ä¸€å†™å…¥è€…ï¼ŒCRUD + å»é‡ + ä¸€è‡´æ€§ï¼‰
- **åŒæ­¥**ï¼šâŒ æœ¬åœ°ä¸“å±ï¼Œä¸åŒæ­¥åˆ° Outlook/To Do
- **RAG**ï¼šâœ… æ”¯æŒ embedding å‘é‡æ£€ç´¢ï¼ˆPhase 4ï¼Œç‹¬ç«‹è¡¨ `signal_embeddings`ï¼‰
- **å¤‡ä»½**ï¼šâœ… éš Event æ•°æ®ä¸€èµ·å¯¼å‡ºï¼ˆGDPR åˆè§„ï¼‰

è¯¦è§ï¼š[EVENT_FIELD_CONTRACT_SSOT_ARCHITECTURE.md Â§ 0.4](../architecture/EVENT_FIELD_CONTRACT_SSOT_ARCHITECTURE.md#04-signal-å­—æ®µå¥‘çº¦å®Œæ•´-schema)

---

### 2.2.1 Signal Schema å­—æ®µå¥‘çº¦

```typescript
/**
 * Signal å®ä½“ï¼ˆç‹¬ç«‹å­˜å‚¨ï¼Œæœ¬åœ°ä¸“å±ï¼‰
 * Owner: SignalServiceï¼ˆå”¯ä¸€å†™å…¥è€…ï¼‰
 * å­˜å‚¨: signals è¡¨ï¼ˆIndexedDB/SQLiteï¼‰
 * åŒæ­¥: âŒ ä¸åŒæ­¥åˆ°å¤–éƒ¨ç³»ç»Ÿï¼ˆOutlook/To Doï¼‰
 */
interface Signal {
  // ===== æ ¸å¿ƒå­—æ®µï¼ˆå¿…å¡«ï¼‰ =====
  
  /**
   * Signal å”¯ä¸€æ ‡è¯†ç¬¦
   * æ ¼å¼: signal_${nanoid(21)}
   * ç”¨é€”: ä¸»é”®ï¼Œå…³è” EvidenceLinkã€SignalEmbedding ç­‰æ´¾ç”Ÿæ•°æ®
   */
  id: string;
  
  /**
   * å…³è”çš„ Event ID
   * æ ¼å¼: event_${nanoid(21)}
   * çº¦æŸ: å¤–é”® â†’ events.idï¼ˆå¼ºåˆ¶ï¼Œçº§è”åˆ é™¤ï¼‰
   * ç”¨é€”: Signal å¿…é¡»é™„ç€åœ¨æŸä¸ª Event ä¸Šï¼ŒEvent åˆ é™¤æ—¶çº§è”åˆ é™¤æ‰€æœ‰å…³è” Signal
   */
  eventId: string;
  
  /**
   * Signal ç±»å‹
   * æšä¸¾: SignalTypeï¼ˆè§ä¸‹æ–‡ï¼‰
   * ç”¨é€”: åŒºåˆ†è¯­ä¹‰æ ‡è®°ã€ç”¨æˆ·è¡Œä¸ºã€æ—¶é—´åœç•™ã€AI æ¨æ–­ç­‰ä¸åŒä¿¡å·ç±»å‹
   */
  type: SignalType;
  
  /**
   * æ ‡è®°çš„æ–‡æœ¬å†…å®¹
   * çº¦æŸ: â‰¤500 å­—ç¬¦
   * ç”¨é€”: å­˜å‚¨ç”¨æˆ·æ ‡è®°çš„æ–‡æœ¬ç‰‡æ®µæˆ– Signal çš„æ ¸å¿ƒå†…å®¹
   * ç¤ºä¾‹: 
   *   - type='highlight': "è¿™æ˜¯é‡ç‚¹å†…å®¹"
   *   - type='user_copy': ç”¨æˆ·å¤åˆ¶çš„æ–‡æœ¬
   *   - type='ai_highlight_suggested': AI å»ºè®®é«˜äº®çš„æ–‡æœ¬
   */
  content: string;
  
  /**
   * åˆ›å»ºæ—¶é—´
   * æ ¼å¼: YYYY-MM-DD HH:mm:ssï¼ˆæœ¬åœ°æ—¶é—´ï¼‰
   * ç”¨é€”: Signal åˆ›å»ºæ—¶é—´æˆ³ï¼Œç”¨äºæ—¶é—´æ’åºã€Focus Window èšç±»
   */
  timestamp: string;
  
  /**
   * åˆ›å»ºè€…ç±»å‹
   * æšä¸¾: 'user' | 'ai' | 'system'
   * ç”¨é€”: 
   *   - 'user': ç”¨æˆ·æ‰‹åŠ¨æ ‡è®°ï¼ˆé«˜äº®ã€é—®é¢˜ã€å¾…åŠï¼‰
   *   - 'ai': AI è‡ªåŠ¨æ¨æ–­ï¼ˆéœ€ç”¨æˆ·ç¡®è®¤ï¼‰
   *   - 'system': ç³»ç»Ÿè‡ªåŠ¨æ•è·ï¼ˆå¤åˆ¶ã€ç¼–è¾‘ã€åœç•™æ—¶é•¿ï¼‰
   */
  createdBy: 'user' | 'ai' | 'system';
  
  /**
   * Signal çŠ¶æ€
   * æšä¸¾: SignalStatusï¼ˆè§ä¸‹æ–‡ï¼‰
   * ç”¨é€”: è¿½è¸ª Signal ç”Ÿå‘½å‘¨æœŸï¼ˆæ´»è·ƒ/ç¡®è®¤/æ‹’ç»/è¿‡æœŸï¼‰
   * è½¬æ¢: è§ SSOT Â§ 0.4.1 çŠ¶æ€è½¬æ¢è§„åˆ™
   */
  status: SignalStatus;
  
  // ===== å®šä½ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰ =====
  
  /**
   * Slate èŠ‚ç‚¹è·¯å¾„
   * æ ¼å¼: number[] - å¦‚ [0, 1, 2] è¡¨ç¤ºç¬¬ 1 ä¸ªæ®µè½çš„ç¬¬ 2 ä¸ªå­èŠ‚ç‚¹çš„ç¬¬ 3 ä¸ªå­èŠ‚ç‚¹
   * ç”¨é€”: å®šä½ Signal åœ¨ EventLog.slateJson ä¸­çš„ç²¾ç¡®ä½ç½®ï¼Œæ”¯æŒè·³è½¬å’Œé«˜äº®
   */
  slateNodePath?: number[];
  
  /**
   * æ–‡æœ¬èŒƒå›´
   * æ ¼å¼: { start: number; end: number }
   * ç”¨é€”: æ ‡è®° Signal åœ¨æ®µè½æ–‡æœ¬ä¸­çš„èµ·æ­¢ä½ç½®ï¼ˆå­—ç¬¦ç´¢å¼•ï¼‰ï¼Œç”¨äºç²¾ç¡®é«˜äº®
   */
  textRange?: {
    start: number;
    end: number;
  };
  
  // ===== è¡Œä¸ºå…ƒæ•°æ®ï¼ˆèšåˆæ•°æ®ï¼Œä¸å­˜åŸå§‹æµï¼‰ =====
  
  /**
   * è¡Œä¸ºç»Ÿè®¡ä¸ä¸Šä¸‹æ–‡å…ƒæ•°æ®
   * çº¦æŸ: åªå­˜èšåˆç»Ÿè®¡ + AI æ‰€éœ€æ–‡æœ¬ï¼Œä¸å­˜åŸå§‹äº‹ä»¶æµ
   */
  behaviorMeta?: {
    // ----- ç»Ÿè®¡èšåˆï¼ˆåªå­˜æ€»é‡ï¼Œä¸å­˜æ˜ç»†ï¼‰ -----
    
    /**
     * æ“ä½œæ¬¡æ•°
     * ç”¨é€”: ç»Ÿè®¡è¯¥ Signal å…³è”å†…å®¹è¢«æ“ä½œçš„æ¬¡æ•°ï¼ˆå¤åˆ¶ã€ç¼–è¾‘ã€å¼•ç”¨ç­‰ï¼‰
     * ç¤ºä¾‹: æŸæ®µæ–‡å­—è¢«å¤åˆ¶ 3 æ¬¡ â†’ actionCount = 3
     */
    actionCount?: number;
    
    /**
     * ç´¯è®¡åœç•™æ—¶é•¿
     * å•ä½: æ¯«ç§’
     * ç”¨é€”: è®°å½•ç”¨æˆ·åœ¨è¯¥ Signal å…³è”å†…å®¹ä¸Šçš„æ€»åœç•™æ—¶é—´
     * ç¤ºä¾‹: ç”¨æˆ·åœ¨æŸæ®µè½åœç•™ 5 åˆ†é’Ÿ â†’ totalDwellTime = 300000
     */
    totalDwellTime?: number;
    
    // ----- AI ç”Ÿæˆæ‰€éœ€çš„æ–‡æœ¬å†…å®¹ï¼ˆå¿…é¡»å­˜å‚¨ï¼‰ -----
    
    /**
     * é€‰ä¸­çš„æ–‡å­—å†…å®¹
     * ç”¨é€”: ç”¨æˆ·é€‰ä¸­çš„æ–‡æœ¬ç‰‡æ®µï¼Œç”¨äº Daily Review AI ç”Ÿæˆæ—¶æä¾›ä¸Šä¸‹æ–‡
     * ç¤ºä¾‹: ç”¨æˆ·é€‰ä¸­"é‡è¦å‘ç°"å¹¶æ ‡è®°ä¸ºé«˜äº® â†’ selectedText = "é‡è¦å‘ç°"
     */
    selectedText?: string;
    
    /**
     * Node summary as chunk
     * ç”¨é€”: èŠ‚ç‚¹çº§åˆ«çš„æ‘˜è¦æ–‡æœ¬ï¼Œä½œä¸º RAG æ£€ç´¢çš„ chunk
     * ç¤ºä¾‹: æŸä¸ªæ®µè½çš„ AI æ‘˜è¦
     */
    nodeSummary?: string;
    
    /**
     * Article summary
     * ç”¨é€”: æ–‡ç« çº§åˆ«çš„æ‘˜è¦æ–‡æœ¬
     * ç¤ºä¾‹: æ•´ç¯‡ç¬”è®°çš„ AI æ‘˜è¦
     */
    articleSummary?: string;
    
    // ----- ä¸Šä¸‹æ–‡å…³è” -----
    
    /**
     * å…³è”çš„ AI å¯¹è¯ ID
     * ç”¨é€”: å°† Signal ä¸æŸæ¬¡ AI å¯¹è¯å…³è”ï¼ˆå¦‚ç”¨æˆ·åœ¨å¯¹è¯ä¸­æåˆ°çš„é‡ç‚¹ï¼‰
     */
    relatedConversationId?: string;
    
    /**
     * å…³è”çš„æ³¨æ„åŠ›ä¼šè¯ ID
     * æ ¼å¼: attentionSession_${nanoid(21)}
     * ç”¨é€”: å°† Signal ä¸æŸæ¬¡ä¸“æ³¨ä¼šè¯å…³è”ï¼ˆFocus Windowï¼‰
     */
    relatedAttentionSessionId?: string;
    
    /**
     * Signal æ¥æº
     * æšä¸¾: 'format' | 'behavior' | 'ai_suggestion'
     * ç”¨é€”: 
     *   - 'format': ä» EventLog.slateJson æ ¼å¼æå–ï¼ˆå¦‚é»„è‰²é«˜äº®ï¼‰
     *   - 'behavior': ä»ç”¨æˆ·è¡Œä¸ºç»Ÿè®¡æå–ï¼ˆå¦‚é«˜é¢‘å¤åˆ¶ï¼‰
     *   - 'ai_suggestion': AI æ¨æ–­å»ºè®®
     */
    extractedFrom?: 'format' | 'behavior' | 'ai_suggestion';
  };
  
  // ===== AI æ¨æ–­ä¸“ç”¨å­—æ®µï¼ˆcreatedBy='ai' æ—¶æœ‰æ•ˆï¼‰ =====
  
  /**
   * ç½®ä¿¡åº¦
   * èŒƒå›´: 0-1
   * ç”¨é€”: AI æ¨æ–­ Signal æ—¶çš„ç½®ä¿¡åº¦åˆ†æ•°ï¼Œç”¨äºè¿‡æ»¤ä½è´¨é‡æ¨æ–­
   * ç¤ºä¾‹: confidence=0.85 è¡¨ç¤º AI 85% ç¡®ä¿¡è¿™æ˜¯ä¸€ä¸ªé‡ç‚¹
   */
  confidence?: number;
}

/**
 * Signal ç±»å‹æšä¸¾
 */
type SignalType = 
  // ===== è¯­ä¹‰æ ‡è®°ï¼ˆç”¨æˆ·æ˜¾å¼æ ‡æ³¨ï¼‰ =====
  | 'highlight'      // â­ é‡ç‚¹
  | 'question'       // â“ ç–‘é—®/Open Loop
  | 'action_item'    // âœ… è¡ŒåŠ¨é¡¹
  | 'objection'      // ğŸ§Š åå¯¹/é£é™©
  | 'advantage'      // ğŸ‘ ä¼˜åŠ¿
  | 'disadvantage'   // ğŸ‘ åŠ£åŠ¿
  | 'brilliant'      // ğŸ’¡ ç²¾å½©æ´å¯Ÿ
  | 'confirm'        // âœ”ï¸ ç¡®è®¤
  
  // ===== ç”¨æˆ·æ“ä½œè¡Œä¸ºï¼ˆè‡ªåŠ¨æ•è·ï¼‰ =====
  | 'user_question'  // ç”¨æˆ·æé—® AI
  | 'user_copy'      // ç”¨æˆ·å¤åˆ¶å†…å®¹
  | 'ai_insert'      // AI æ’å…¥å†…å®¹
  | 'user_edit'      // ç”¨æˆ·ç¼–è¾‘å†…å®¹
  | 'user_star'      // ç”¨æˆ·æ˜Ÿæ ‡æ®µè½
  
  // ===== æ—¶é—´åœç•™è¡Œä¸º =====
  | 'dwell_time_event'      // Event çº§åˆ«åœç•™
  | 'dwell_time_paragraph'  // Paragraph çº§åˆ«åœç•™
  | 'focus_time'            // Focus Window å†…çš„é‡ç‚¹æ—¶æ®µ
  
  // ===== é”®ç›˜/é¼ æ ‡è¡Œä¸ºï¼ˆå¯é€‰æ‰©å±•ï¼‰ =====
  | 'typing_rhythm'    // æ‰“å­—èŠ‚å¥å¼‚å¸¸ï¼ˆé•¿åœé¡¿ = æ€è€ƒï¼‰
  | 'delete_rewrite'   // åˆ é™¤é‡å†™ï¼ˆä¿®æ”¹æ¬¡æ•°å¤š = é‡è¦ï¼‰
  | 'mouse_hover'      // é¼ æ ‡æ‚¬åœ
  | 'scroll_behavior'  // æ»šåŠ¨è¡Œä¸º
  
  // ===== AI æ¨æ–­ï¼ˆå¾…ç¡®è®¤ï¼‰ =====
  | 'ai_highlight_suggested'  // AI å»ºè®®çš„é‡ç‚¹
  | 'ai_question_detected';   // AI æ£€æµ‹çš„ç–‘é—®

/**
 * SignalStatus / çŠ¶æ€è½¬æ¢è§„åˆ™ä»¥ SSOT ä¸ºå‡†ï¼š
 * - docs/architecture/EVENT_FIELD_CONTRACT_SSOT_ARCHITECTURE.mdï¼ˆÂ§0.4.1ï¼‰
 */
```
```

**AttentionSession** (æ³¨æ„åŠ›ä¼šè¯)
**åŸå§‹è®¡æ—¶è®°å½•**ï¼Œè¿½è¸ªç”¨æˆ·åœ¨æŸä¸ª Event ä¸Šçš„å·¥ä½œæ—¶æ®µï¼š

**å®šä½**ï¼š
- **ä¸æ˜¯æ€»ç»“**ï¼šåªè®°å½•å¼€å§‹/ç»“æŸæ—¶é—´ã€æ¥æºç±»å‹
- **ä¸æ˜¯ Event**ï¼šç‹¬ç«‹å®ä½“ï¼Œä¸æ±¡æŸ“ Event æ ‘ç»“æ„
- **ä¸æ˜¯ Behavior/Timeblock**ï¼šä¸æ˜¯ç”¨æˆ·å¯è§çš„è®¡åˆ’/æ—¶é—´å—ï¼Œæ˜¯åå°ç»Ÿè®¡æ•°æ®

**ç”¨é€”**ï¼š
- ğŸ“Š ç»Ÿè®¡ç”¨æˆ·åœ¨æŸä¸ª Event ä¸Šçš„ä¸“æ³¨æ—¶é•¿ï¼ˆdwell timeï¼‰
- ğŸ¯ è¯†åˆ« Focus Windowï¼ˆé«˜å¯†åº¦äº¤äº’æ—¶æ®µï¼‰
- ğŸ”— ä½œä¸ºæ—¶é—´çª—å£ï¼Œèšåˆè¯¥æ—¶æ®µå†…çš„ Signalï¼ˆé«˜äº®/å¤åˆ¶/ç¼–è¾‘ï¼‰
- ğŸ“ è§¦å‘ AI ç”Ÿæˆ Session Briefï¼ˆArtifactï¼‰
- ğŸ™ï¸ å¯é€‰å…³è”éŸ³é¢‘/è½¬å†™/å¿«ç…§ï¼ˆæœ¬åœ°å­˜å‚¨ï¼‰

**æ•°æ®æµ**ï¼š
```
AttentionSession (åŸå§‹è®¡æ—¶)
    â†“ æ—¶é—´çª— [14:00-15:00]
    â†“ èšåˆè¿™æ®µæ—¶é—´å†…çš„...
Signal (ç”¨æˆ·æ ‡è®°) + EventLog (ç¬”è®°å†…å®¹) + éŸ³é¢‘è½¬å†™
    â†“ å–‚ç»™ AI
Session Brief (Artifact) â† AI ç”Ÿæˆçš„æ€»ç»“æ–‡å­—
```

**AttentionSession æ¶æ„çº¦æŸ**ï¼š
```typescript
/**
 * AttentionSessionï¼ˆæ³¨æ„åŠ›ä¼šè¯ï¼‰
 * Owner: AttentionTrackerï¼ˆæœ¬åœ°åå°æœåŠ¡ï¼‰
 * å­˜å‚¨: attention_sessions è¡¨ï¼ˆIndexedDBï¼Œæœ¬åœ°ä¸“å±ï¼‰
 * åŒæ­¥: âŒ ä¸åŒæ­¥åˆ°å¤–éƒ¨ç³»ç»Ÿ
 * 
 * ç”¨é€”: è¿½è¸ªç”¨æˆ·åœ¨æŸä¸ª Event ä¸Šçš„å·¥ä½œæ—¶æ®µï¼ˆç±»ä¼¼ Toggl/RescueTimeï¼‰
 */
interface AttentionSession {
  // ===== æ ¸å¿ƒå­—æ®µ =====
  id: string;                     // attentionSession_${nanoid(21)}
  eventId: string;                // å¿…é¡»æŒ‚åœ¨ä¸€ä¸ª event ä¸‹
  source: 'focus_window'          // Focus Windowï¼ˆé«˜å¯†åº¦äº¤äº’ï¼‰
        | 'background_dwell'      // åå°åœç•™ï¼ˆæ ‡ç­¾é¡µæ‰“å¼€ä½†æœªæ´»è·ƒï¼‰
        | 'manual';               // ç”¨æˆ·æ‰‹åŠ¨å¯åŠ¨ï¼ˆå¦‚å½•éŸ³ï¼‰
  
  // ===== æ—¶é—´è®°å½•ï¼ˆåŸå§‹æ•°æ®ï¼‰ =====
  startTime: string;              // YYYY-MM-DD HH:mm:ssï¼ˆæœ¬åœ°å­˜å‚¨æ ¼å¼ï¼‰
  endTime?: string;               // YYYY-MM-DD HH:mm:ssï¼ˆç»“æŸåå¡«å…¥ï¼‰
  
  // ===== ä¼šè¯å¢å¼ºï¼ˆå¯é€‰ï¼Œç”¨äºä¼šè®®åœºæ™¯ï¼‰ =====
  meta?: {
    // å‚ä¼šäººå‘˜ï¼ˆæ‰‹åŠ¨è¾“å…¥æˆ– AI è¯†åˆ«ï¼‰
    attendees?: Array<{
      id?: string;
      name: string;
      aliases?: string[];
      role?: string;
    }>;
    
    // è¯´è¯äººæ˜ å°„ï¼ˆéŸ³é¢‘è½¬å†™æ—¶ä½¿ç”¨ï¼‰
    speakerMap?: Record<string, {
      attendeeName?: string;
      confidence: number;
    }>;
  };
}
```

**TakeawayCandidate** (å€™é€‰æ”¶è·)  
ä»äº¤äº’ä¸­æå–çš„å¾®è§‚ç»“è®ºï¼š
- ä» AI å›ç­”ã€æ‘˜è¦ã€ä¼šè¯å…³é”®æ—¶åˆ»è‡ªåŠ¨ç”Ÿæˆ
- ç”¨æˆ·æ‰‹åŠ¨æ ‡è®°çš„é«˜äº®
- é€šè¿‡å¤åˆ©å¼å›é¡¾èšåˆï¼šæ¯æ—¥ â†’ æ¯å‘¨ â†’ æ¯æœˆ â†’ å­£åº¦ â†’ å¹´åº¦

**Artifact** (æ•´ç†äº§ç‰©)  
AI ç”Ÿæˆçš„ç»“æ„åŒ–æ‘˜è¦/æŠ¥å‘Šï¼Œæ”¯æŒ**å¤šç²’åº¦å¤åˆ©å¼èšåˆ**ï¼š

**æ ¸å¿ƒæ¦‚å¿µ**ï¼š
- **é€šç”¨å®¹å™¨**ï¼šæ‰€æœ‰ AI ç”Ÿæˆçš„æ–‡å­—å†…å®¹ï¼ˆSession Brief / Daily Narrative / Weekly Summary ç­‰ï¼‰
- **å¤šç²’åº¦**ï¼šä» 30 åˆ†é’Ÿä¼šè¯ â†’ æ—¥ â†’ å‘¨ â†’ æœˆ â†’ å¹´ï¼Œå±‚å±‚èšåˆ
- **å¯è¿½æº¯**ï¼šæ¯æ¡ç»“è®ºé€šè¿‡ EvidenceLink å›æº¯åˆ°åŸå§‹ Signal/EventLog

**scope ä¸ AI è¾“å…¥æ˜ å°„**ï¼š

| scope | targetId ç¤ºä¾‹ | AI æ¶ˆè´¹çš„è¾“å…¥ | è¾“å‡ºç¤ºä¾‹ |
|-------|-------------|-------------|----------|
| `session` | `attentionSession_abc` | è¯¥ session æ—¶é—´çª—å†…çš„ Signal + EventLog + éŸ³é¢‘è½¬å†™ | "30åˆ†é’Ÿä¼šè®®ï¼šç¡®å®šäº† GraphQL æ–¹æ¡ˆ" |
| `daily` | `2026-01-09` | **å½“å¤©æ‰€æœ‰ AttentionSession** + Signal + Event | "ä»Šå¤©ä¸“æ³¨äº Q1 è§„åˆ’ï¼ˆ3hï¼‰ï¼Œ2æ¬¡ä¼šè®®" |
| `weekly` | `2026-W02` | **æœ¬å‘¨æ‰€æœ‰ daily Artifact**ï¼ˆå¤åˆ©å¼ï¼‰ | "æœ¬å‘¨ä¸»çº¿ï¼šQ1 è§„åˆ’ï¼Œ3æ¡é‡è¦å†³ç­–" |
| `monthly` | `2026-01` | **æœ¬æœˆæ‰€æœ‰ weekly Artifact** | "1æœˆä¸»é¢˜ï¼šæ¶æ„å†³ç­–ï¼Œå®Œæˆ GraphQL è¿ç§»" |
| `yearly` | `2026` | **æœ¬å¹´æ‰€æœ‰ monthly Artifact** | "2026å¹´åº¦å›é¡¾ï¼šäº§å“é‡æ„ï¼Œå›¢é˜Ÿæˆé•¿" |

```typescript
interface Artifact {
  id: string;
  scope: 'session' | 'daily' | 'weekly' | 'monthly' | 'quarterly' | 'yearly';
  targetId: string;              // è§ä¸Šè¡¨ï¼ˆattentionSessionId / æ—¥æœŸå­—ç¬¦ä¸²ï¼‰
  type: 'brief' | 'rolling_summary' | 'action_items';
  contentJson: {
    tldr?: string[];
    key_points?: Array<{ id: string; text: string; confidence: number }>;
    decisions?: Array<{ id: string; text: string }>;
    action_items?: Array<{ id: string; text: string; owner?: string }>;
    open_questions?: Array<{ id: string; text: string }>;
  };
  createdAt: string;
  updatedAt: string;
  status: 'draft' | 'accepted' | 'edited';
}
```

**EvidenceLink** (è¯æ®é“¾)  
å…³è” Artifact çš„ç»“è®ºåˆ°æºæ•°æ®ï¼š
```typescript
interface EvidenceLink {
  id: string;
  targetArtifactId: string;
  claimId: string;               // Artifact å†…ç»“è®ºçš„ ID
  sourceType: 'eventlog_timestamp' | 'transcript_chunk' | 'signal';
  sourceRef: any;                // å…·ä½“å¼•ç”¨
  quote?: string;
  confidence: number;
}
```

### 2.3 å›é¡¾ä¸åˆæˆè¾“å‡º

**Daily Narrative** (æ¯æ—¥å™äº‹)  
ä»è¯æ®ç”Ÿæˆçš„ç»“æ„åŒ–å›é¡¾è¾“å‡ºï¼š
1. **å™äº‹æ‘˜è¦**ï¼šæ—¶é—´éª¨æ¶æ¦‚è§ˆï¼ˆä¸Šåˆ/ä¸‹åˆ/æ™šä¸Šï¼‰
2. **æ ¸å¿ƒæ”¶è·**ï¼š3-7 æ¡å…³é”®å­¦ä¹ ï¼Œå¸¦è¯æ®é“¾æ¥
3. **å¼€æ”¾å¾ªç¯**ï¼šæœªè§£ç­”çš„é—®é¢˜
4. **è¡ŒåŠ¨é¡¹**ï¼šæ ‡è®°çš„ä»»åŠ¡
5. **å…±é¸£**ï¼šè·¨ç¬”è®°è¿æ¥ï¼ˆå¯é€‰ï¼‰

**Focus Window** (é‡ç‚¹çª—å£)  
Signal å‘¨å›´çš„æ—¶é—´èŒƒå›´ï¼ˆå¦‚ [t-20s, t+60s]ï¼‰ï¼Œæ ‡è®°ä¸ºéœ€è¯¦ç»†å¤„ç†ï¼š
- æ›´é«˜çš„ ASR è½¬å†™ç²¾åº¦
- æ›´ç»†ç²’åº¦çš„åˆ†æ®µ
- ä¸ºå…³é”®æ—¶åˆ»ä¿ç•™é€å­—å¼•ç”¨

**Holographic Map** (å…¨æ¯ç›®å½•)  
è‡ªåŠ¨ç”Ÿæˆçš„å¯è¿‡æ»¤å¤§çº²ï¼Œå±•ç¤ºç¬”è®°ç»“æ„ï¼š
- åŸºäº Signal çš„é«˜äº®ï¼ˆâ­/â“/âœ…ï¼‰
- å¯æŠ˜å å±‚çº§
- ç‚¹å‡»è·³è½¬å¯¼èˆª

---

## 3. ç”¨æˆ·ä½“éªŒè®¾è®¡

### 3.1 æ ¸å¿ƒç”¨æˆ·æµç¨‹

#### æµç¨‹ Aï¼šæ—¥å¸¸çŸ¥è¯†æ•è·ï¼ˆçŸ¥è¯†å·¥ä½œè€…åœºæ™¯ï¼‰

**ä¸Šåˆï¼šåˆ›å»ºç¬”è®°**
1. ç”¨æˆ·åˆ›å»ºç¬”è®° "2025-01-23 Project Alpha ç ”ç©¶"
2. è¾“å…¥åˆæ­¥æƒ³æ³• â†’ è‡ªåŠ¨è®°å½• `INSERT_TEXT` äº‹ä»¶
3. é—® AI "X çš„æœ€ä½³å®è·µæ˜¯ä»€ä¹ˆï¼Ÿ" â†’ è®°å½• `ASK_AI`
4. AI è¯¦ç»†å›å¤ â†’ ç³»ç»Ÿç”Ÿæˆï¼š
   - Answer Cardï¼ˆå¸¦ `card_type: ai_answer` çš„æ®µè½ï¼‰
   - TakeawayCandidateï¼š"X çš„æœ€ä½³å®è·µæ˜¯ Y"ï¼ˆè‡ªåŠ¨æå–ï¼‰
5. ç”¨æˆ·æ ‡è®° AI å›ç­”ä¸ºé«˜äº®ï¼ˆâ­ï¼‰â†’ æ¯æ—¥å›é¡¾æƒé‡æå‡

**ä¸‹åˆï¼šå¤šæºæ•´åˆ**
1. ç”¨æˆ·é€‰æ‹© 3 ä¸ªç°æœ‰å¡ç‰‡ï¼ˆæ¥è‡ªä¸åŒç¬”è®°ï¼‰
2. ç‚¹å‡»"ä¸€èµ·æ€»ç»“" â†’ è®°å½• `MULTI_SELECT_SUMMARIZE`
3. ç³»ç»Ÿç”Ÿæˆ Summary Cardï¼ŒåŒ…å«ï¼š
   - æ•´åˆçš„ç»¼è¿°
   - 3-5 ä¸ª TakeawayCandidateï¼ˆæ¯ä¸ªå…³é”®ç‚¹ä¸€æ¡ï¼‰
   - æŒ‡å‘æ‰€æœ‰æº card ID çš„ `evidence_refs`

**æ™šé—´ï¼šè‡ªåŠ¨æ¯æ—¥å›é¡¾**
1. ç³»ç»Ÿè§¦å‘æ¯æ—¥å™äº‹ç”Ÿæˆï¼ˆæ™š 9 ç‚¹æˆ–æ‰‹åŠ¨ï¼‰
2. è¯»å–è¯æ®ï¼š
   - æ—¶é—´çº¿ï¼šä¼šè¯ã€Signal æ—¶é—´æˆ³
   - äº¤äº’ï¼šAsk AIã€å¡ç‰‡åˆ‡æ¢ã€é«˜äº®
   - äº§å‡ºï¼šAnswer å¡ç‰‡ã€Summary å¡ç‰‡
3. è¾“å‡ºæ¯æ—¥å™äº‹ï¼š
   - "ä»Šå¤©ä½ ä¸“æ³¨äº Project Alphaï¼ˆ3hï¼‰ï¼Œè¿›è¡Œäº† 2 æ¬¡å…³é”® AI è®¨è®º"
   - å‰ 5 æ¡æ”¶è·ï¼ˆå¯ç‚¹å‡»åˆ°æºå¡ç‰‡ï¼‰
   - 2 ä¸ªå¼€æ”¾å¾ªç¯ï¼ˆæœªè§£ç­”çš„é—®é¢˜ï¼‰
4. ç”¨æˆ· <3 åˆ†é’Ÿå†…å®¡é˜…ï¼Œæ ‡è®°æ»¡æ„ â†’ å½’æ¡£åˆ°çŸ¥è¯†åº“

#### æµç¨‹ Bï¼šå¸¦æ™ºèƒ½è¯æ®æ•è·çš„ä¼šè®®ï¼ˆä¼šè®®åœºæ™¯ï¼‰

**ä¼šå‰**
1. ç”¨æˆ·åœ¨æ—¥ç¨‹äº‹ä»¶ä¸­ç‚¹å‡»"å¼€å§‹ä¼šè®®ä¼šè¯"
2. ç³»ç»Ÿè¯·æ±‚æƒé™ï¼š
   - å±å¹•æ•è·ï¼ˆç”¨äºæ™ºèƒ½å®šå¸§å¿«ç…§ï¼Œ**ä¸æ˜¯å®Œæ•´è§†é¢‘**ï¼‰
   - éº¦å…‹é£ï¼ˆéŸ³é¢‘**ä»…æœ¬åœ°ä¿å­˜**ï¼‰
3. å¼€å§‹ç›‘æ§ï¼š
   - å±å¹•å†…å®¹å˜åŒ– â†’ é¡µé¢/å¹»ç¯ç‰‡åˆ‡æ¢æ—¶è‡ªåŠ¨æˆªå›¾
   - éŸ³é¢‘å½•åˆ¶ â†’ æœ¬åœ°æ–‡ä»¶ï¼Œå¸¦æ—¶é—´æˆ³å¯¹é½

**ä¼šè®®ä¸­**
1. **å¹»ç¯ç‰‡å‡ºç°**ï¼šç³»ç»Ÿæ£€æµ‹åœºæ™¯å˜åŒ– â†’ æ•è·æˆªå›¾
2. **å¹»ç¯ç‰‡åŠ¨ç”»**ï¼šç³»ç»Ÿä¿æŒå€™é€‰æ§½ï¼Œä»…ä¿å­˜ä¿¡æ¯æœ€å…¨çš„æœ€ç»ˆå¸§
3. **ç”¨æˆ·è®°ç¬”è®°**ï¼šè¾“å…¥"å†³å®šï¼šè¿ç§»åˆ°æ–° API" â†’ è‡ªåŠ¨è®°å½•å¸¦éŸ³é¢‘åç§»
4. **ç”¨æˆ·æŒ‰ä¸‹é«˜äº®çƒ­é”®**ï¼ˆ`Ctrl+Shift+H`ï¼‰ï¼šåˆ›å»º `HIGHLIGHT` Signal
   - æ ‡è®°å½“å‰éŸ³é¢‘æ—¶é—´æˆ³
   - æ ‡è®°å½“å‰æˆªå›¾ ID
   - æ‰“å¼€ Focus Window [t-20s, t+60s] è¿›è¡Œè¯¦ç»†è½¬å†™
5. **æ£€æµ‹åˆ°è¯­éŸ³æç¤º**ï¼šç”¨æˆ·è¯´"é‡ç‚¹" â†’ æ•ˆæœåŒçƒ­é”®

**ä¼šå**
1. ç³»ç»Ÿå¯¹ä¿å­˜çš„æˆªå›¾è¿è¡Œ OCRï¼ˆèŠ‚æµã€æŒ‰éœ€ï¼‰
2. ç”Ÿæˆä¼šè®®è¦ç‚¹ç¬”è®°ï¼š
   ```
   - å†³å®šï¼šè¿ç§»åˆ°æ–° API [ref: image 20250123143012]
   - é£é™©ï¼šå‘åå…¼å®¹æ€§é—®é¢˜ [ref: image 20250123143145]
   - è¡ŒåŠ¨ï¼š@John å‡†å¤‡è¿ç§»æ¸…å• [ref: image 20250123143230]
   ```
3. ç”¨æˆ·ç‚¹å‡» `[ref: image ...]` â†’ æ‰“å¼€æˆªå›¾ + å®šä½éŸ³é¢‘åˆ°è¯¥æ—¶é—´æˆ³
4. è¦ç‚¹ç¬”è®°è‡ªåŠ¨æ·»åŠ ä¸º TakeawayCandidateï¼Œä¾›æ¯æ—¥èšåˆ

#### æµç¨‹ Cï¼šå¸¦ RECNote åŒæ­¥çš„è¯­éŸ³å¤‡å¿˜ï¼ˆè¯­éŸ³è®°å½•åœºæ™¯ï¼‰

**åœºæ™¯**ï¼šè¾¹èµ°è¾¹å½•åˆ¶æƒ³æ³•

1. ç”¨æˆ·æ‰“å¼€ç¬”è®°ï¼Œé€šè¿‡ RECNote å¼€å§‹å½•éŸ³
2. æŒç»­è¯´è¯ï¼Œå¶å°”è¾“å…¥å…³é”®è¯
3. æ¯ä¸ªè¾“å…¥çš„æ®µè½åœ¨å…ƒæ•°æ®ä¸­è·å¾— `audioAnchor`ï¼š
   ```typescript
   meta: {
     audioAnchor: {
       recordingId: "rec_20250123_1430",
       offsetMs: 125000  // å½•éŸ³ 2 åˆ† 5 ç§’å¤„
     }
   }
   ```
4. ç¨åå›é¡¾ï¼šç‚¹å‡»æ®µè½ â†’ éŸ³é¢‘æ’­æ”¾å™¨å®šä½åˆ° `offsetMs` å¹¶æ’­æ”¾
5. éŸ³é¢‘ä»¥ **16kHz å•å£°é“ Opus @ 24kbps** æœ¬åœ°å­˜å‚¨ â†’ çº¦ 12MB/å°æ—¶
6. æ¡Œé¢åº”ç”¨åœ¨ç©ºé—²æ—¶è‡ªåŠ¨è¿è¡Œæœ¬åœ° Whisper â†’ ç”Ÿæˆ FTS ç´¢å¼•
7. ç”¨æˆ·æœç´¢"åŸå‹åé¦ˆ" â†’ æ‰¾åˆ°éŸ³é¢‘ç‰‡æ®µ + å…³è”æ®µè½

### 3.2 UI ç»„ä»¶è§„èŒƒ

#### 3.2.1 å…¨æ¯ç›®å½•ï¼ˆHolographic Mapï¼‰

**ä½ç½®**ï¼šå³ä¾§è¾¹æ ï¼ˆå¯æŠ˜å ï¼‰

**è§†è§‰è®¾è®¡**
```
ğŸ“„ æ¯æ—¥ç ”ç©¶æ—¥å¿— 2025-01-23

â”œâ”€ ğŸ”¹ ä¸Šåˆå›é¡¾
â”‚   â”œâ”€ â­ API è®¾è®¡çš„å…³é”®æ´å¯Ÿ
â”‚   â””â”€ â“ å¦‚ä½•å¤„ç†è¾¹ç•Œæƒ…å†µï¼Ÿ
â”œâ”€ ğŸ”¹ ä¼šè®®ç¬”è®°
â”‚   â”œâ”€ å†³å®šï¼šä½¿ç”¨ GraphQL
â”‚   â”œâ”€ âœ… @Alice: å‘¨äº”å‰èµ·è‰ schema
â”‚   â””â”€ ğŸ§Š æ‹…å¿§ï¼šå›¢é˜Ÿä¸Šæ‰‹æˆæœ¬
â””â”€ ğŸ”¹ æ™šé—´æ€»ç»“
    â””â”€ æ”¶é›†äº† 3 æ¡æ”¶è·
```

**äº¤äº’**
- ç‚¹å‡»ä»»æ„è¡Œ â†’ æ»šåŠ¨åˆ°æ®µè½ + çŸ­æš‚é«˜äº®
- è¿‡æ»¤æŒ‰é’®ï¼š[â­ é«˜äº®] [â“ ç–‘é—®] [âœ… è¡ŒåŠ¨é¡¹] [å…¨éƒ¨]
- ç¼–è¾‘æ—¶è‡ªåŠ¨æ›´æ–°ï¼ˆé˜²æŠ– 500msï¼‰
- æŠ˜å /å±•å¼€ç« èŠ‚

#### 3.2.2 æ¯æ—¥å™äº‹é¢æ¿ï¼ˆDaily Narrative Panelï¼‰

**è§¦å‘**ï¼šæ‰‹åŠ¨è°ƒç”¨æˆ–å®šæ—¶ï¼ˆæ¯å¤©æ™š 9 ç‚¹ï¼‰

**å¸ƒå±€**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ¯æ—¥å™äº‹ â€” 2025-01-23                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                  â”‚
â”‚ ğŸ“– å™äº‹æ‘˜è¦                                      â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚ ä¸Šåˆï¼šä¸“æ³¨äº Project Alpha ç ”ç©¶ï¼ˆ2.5hï¼‰ã€‚        â”‚
â”‚ ä¸ AI å°± API æ¶æ„æ¨¡å¼è¿›è¡Œäº†å¯Œæœ‰æˆæ•ˆçš„è®¨è®ºã€‚      â”‚
â”‚                                                  â”‚
â”‚ ä¸‹åˆï¼šå›¢é˜Ÿä¼šè®®ï¼ˆ1hï¼‰ï¼Œæ•²å®š Q1 è·¯çº¿å›¾ã€‚           â”‚
â”‚ è½»åº¦ä»£ç å®¡æŸ¥ä¼šè¯ã€‚                               â”‚
â”‚                                                  â”‚
â”‚ ğŸ¯ æ ¸å¿ƒæ”¶è·ï¼ˆ5 æ¡ï¼‰                              â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚ 1. REST vs GraphQL åœ¨æˆ‘ä»¬åœºæ™¯ä¸‹çš„æƒè¡¡           â”‚
â”‚    [ğŸ“ è§ï¼šAI å›ç­”å¡ç‰‡ #abc123]                  â”‚
â”‚                                                  â”‚
â”‚ 2. å›¢é˜Ÿå…±è¯†ï¼šä¼˜å…ˆå®ç°ç”¨æˆ·è®¤è¯åŠŸèƒ½                â”‚
â”‚    [ğŸ“ è§ï¼šä¼šè®®æ€»ç»“ #def456]                     â”‚
â”‚ ...                                              â”‚
â”‚                                                  â”‚
â”‚ â“ å¼€æ”¾å¾ªç¯ï¼ˆ2 ä¸ªï¼‰                              â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚ â€¢ å¦‚ä½•è¿ç§»ç°æœ‰ REST å®¢æˆ·ç«¯ï¼Ÿ                     â”‚
â”‚ â€¢ éœ€è¦ GraphQL æ€§èƒ½åŸºå‡†æµ‹è¯•                      â”‚
â”‚                                                  â”‚
â”‚ âœ… è¡ŒåŠ¨é¡¹ï¼ˆ3 ä¸ªï¼‰                                â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚ â€¢ @æˆ‘ï¼šå‘¨å››å‰èµ·è‰ API è¿ç§»è®¡åˆ’                   â”‚
â”‚ â€¢ @Aliceï¼šæ­å»º GraphQL å¼€å‘ç¯å¢ƒ                  â”‚
â”‚ â€¢ @å›¢é˜Ÿï¼šå®¡æŸ¥å®‰å…¨æ£€æŸ¥æ¸…å•                        â”‚
â”‚                                                  â”‚
â”‚ ğŸ”— å…±é¸£ï¼ˆå¯é€‰ï¼‰                                  â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚ å…³è”åˆ°ï¼š"API è®¾è®¡åŸåˆ™"ç¬”è®°ï¼ˆ3 ä¸ªæœˆå‰ï¼‰           â”‚
â”‚                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
[å½’æ¡£å¹¶æ ‡è®°å®Œæˆ]  [é‡æ–°ç”Ÿæˆ]  [å¯¼å‡º]
```

**äº¤äº’**
- æ‰€æœ‰ `[ğŸ“ è§ï¼š...]` é“¾æ¥åœ¨ä¸Šä¸‹æ–‡ä¸­æ‰“å¼€æºå¡ç‰‡
- è¡ŒåŠ¨é¡¹å¯ä¸€é”®å¯¼å‡ºåˆ°ä»»åŠ¡ç®¡ç†å™¨ï¼ˆæœªæ¥ï¼‰
- å¦‚æœç”¨æˆ·ç¼–è¾‘äº†æºç¬”è®°ï¼Œé‡æ–°ç”Ÿæˆæ—¶ä½¿ç”¨æ›´æ–°çš„æƒé‡/è¿‡æ»¤å™¨

#### 3.2.3 æ–‡æ¡£å…¨æ¯ç¼©ç•¥å›¾ï¼ˆCanvas Minimapï¼‰

**ä½ç½®**ï¼šå·¦ä¾§è¾¹æ ï¼ˆå›ºå®šï¼Œå¯æœ€å°åŒ–ï¼‰

**è®¾è®¡ç›®æ ‡**
æä¾›å…¨æ–‡æ¡£çš„è§†è§‰é¸Ÿç°ï¼Œå¿«é€Ÿå¯¼èˆªå’Œ Signal ä½ç½®å¯è§†åŒ–ï¼Œä¸å³ä¾§ Holographic Map å½¢æˆäº’è¡¥ã€‚

**è§†è§‰è®¾è®¡**
```
â”Œâ”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Mâ”‚ ç¬”è®°å†…å®¹                         â”‚ Holographic â”‚
â”‚iâ”‚                                 â”‚ Mapï¼ˆæ ‘å½¢ï¼‰   â”‚
â”‚nâ”‚ æ®µè½ 1 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ              â”‚              â”‚
â”‚iâ”‚                                 â”‚ â”œâ”€ ä¸Šåˆå›é¡¾   â”‚
â”‚mâ”‚ Event å¡ç‰‡ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ              â”‚ â”‚  â”œâ”€ â­æ´å¯Ÿ â”‚
â”‚aâ”‚                             â“  â”‚ â”‚  â””â”€ â“é—®é¢˜ â”‚
â”‚pâ”‚ æ®µè½ 2 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ              â”‚ â”œâ”€ ä¼šè®®ç¬”è®°   â”‚
â”‚ â”‚                                 â”‚ â”‚  â”œâ”€ å†³å®š    â”‚
â”‚â”‚ AI Answer â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ            â”‚ â”‚  â”œâ”€ âœ…è¡ŒåŠ¨  â”‚
â”‚ â”‚                         ğŸ¤–      â”‚ â”‚  â””â”€ ğŸ§Šæ‹…å¿§ â”‚
â”‚ â”‚ æ®µè½ 3 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ              â”‚ â””â”€ æ™šé—´æ€»ç»“   â”‚
â”‚ â”‚                                 â”‚              â”‚
â”‚ â”‚ Thinking â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ            â”‚              â”‚
â”‚ â”‚                         ğŸ’­      â”‚              â”‚
â”‚ â”‚ â–“â–“â–“â–“â–“â–“â–“â–“â–“ (å½“å‰è§†çª—)            â”‚              â”‚
â””â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†‘ è§†è§‰ç¼©ç•¥                        â†‘ ç»“æ„å¤§çº²
```

**æ ¸å¿ƒåŠŸèƒ½**

1. **å†…å®¹å—æ¸²æŸ“**
   - æ™®é€šæ®µè½ï¼šæ·±ç°è‰²çŸ©å½¢å—ï¼ˆ`#3e3e3e`ï¼‰
   - Event å¡ç‰‡ï¼šä¸­ç°è‰²çŸ©å½¢å—ï¼ˆ`#5e5e5e`ï¼‰
   - AI Answerï¼šç»¿è‰²çŸ©å½¢å—ï¼ˆ`#4caf50`ï¼‰
   - Summary Cardï¼šè“è‰²çŸ©å½¢å—ï¼ˆ`#2196f3`ï¼‰
   - Web Clipï¼šæ©™è‰²çŸ©å½¢å—ï¼ˆ`#ff9800`ï¼‰

2. **Signal å¯è§†åŒ–**
   - â­ `HIGHLIGHT`ï¼šé‡‘è‰²åœ†ç‚¹ï¼Œå³ä¾§è¾¹ç¼˜
   - â“ `QUESTION`ï¼šçº¢è‰²åœ†ç‚¹
   - âœ… `ACTION_ITEM`ï¼šç´«è‰²åœ†ç‚¹
   - ğŸ§Š `OBJECTION`ï¼šå†°è“è‰²åœ†ç‚¹
   - ğŸ’­ æ€è€ƒ/å¤‡æ³¨ï¼šå¤©è“è‰²åœ†ç‚¹

3. **Focus Window é«˜äº®**ï¼ˆä¼šè¯å½•åˆ¶æ—¶ï¼‰
   - åŠé€æ˜é‡‘è‰²èƒŒæ™¯ï¼ˆ`rgba(255, 215, 0, 0.2)`ï¼‰
   - å·¦ä¾§ 3px é‡‘è‰²è¾¹æ¡†å¼ºè°ƒ
   - å®æ—¶æ›´æ–°ï¼šç”¨æˆ·æ·»åŠ  Signal æ—¶ç«‹å³æ˜¾ç¤º

4. **å½“å‰è§†çª—æŒ‡ç¤º**
   - åŠé€æ˜è“è‰²çŸ©å½¢æ¡†ï¼ˆ`rgba(0, 122, 204, 0.3)`ï¼‰
   - 2px è“è‰²è¾¹æ¡†ï¼ˆ`#007acc`ï¼‰
   - è·Ÿéšä¸»å†…å®¹æ»šåŠ¨å®æ—¶æ›´æ–°

5. **Takeaway å¯†åº¦çƒ­åŠ›å›¾**ï¼ˆå¯é€‰ï¼‰
   - ä¸€æ®µæ—¶é—´å†…å¤šä¸ª Takeaway â†’ æ¸å˜ç»¿è‰²çƒ­åŒº
   - å¯†åº¦è¶Šé«˜é¢œè‰²è¶Šäº®ï¼š`rgba(76, 175, 80, ${alpha})`

**äº¤äº’è¡Œä¸º**

```typescript
// ç‚¹å‡»è·³è½¬
onClick: (e: MouseEvent) => {
  const clickY = e.offsetY;
  const scale = canvas.height / container.scrollHeight;
  container.scrollTop = clickY / scale - container.clientHeight / 2;
};

// æ‹–åŠ¨æ»šåŠ¨
onMouseDown: (e: MouseEvent) => {
  isDragging = true;
  updateScrollFromMouse(e);
};

// Hover æç¤º
onMouseMove: (e: MouseEvent) => {
  const hoveredBlock = getBlockAtPosition(e.offsetY);
  if (hoveredBlock) {
    showTooltip({
      type: hoveredBlock.type,
      preview: hoveredBlock.textPreview,
      signals: hoveredBlock.signals,
    });
  }
};
```

**æŠ€æœ¯å®ç°è¦ç‚¹**

1. **Canvas åˆ†å±‚æ¸²æŸ“**ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰
```typescript
// é™æ€å±‚ï¼šæ®µè½/å¡ç‰‡å—ï¼ˆç¼“å­˜ï¼‰
const staticLayer = document.createElement('canvas');
function renderStaticLayer() {
  const ctx = staticLayer.getContext('2d')!;
  paragraphs.forEach(p => {
    const y = p.offsetTop * scale;
    const height = Math.max(2, p.offsetHeight * scale);
    ctx.fillStyle = getBlockColor(p.type);
    ctx.fillRect(0, y, canvas.width - 15, height);
  });
}

// åŠ¨æ€å±‚ï¼šSignalã€è§†çª—ã€Focus Windowï¼ˆæ¯å¸§é‡ç»˜ï¼‰
function renderDynamicLayer() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.drawImage(staticLayer, 0, 0); // å¤åˆ¶é™æ€å±‚
  
  drawFocusWindows(ctx, focusWindows);
  drawSignals(ctx, signals);
  drawViewport(ctx, viewport);
}
```

2. **å“åº”å¼æ›´æ–°ç­–ç•¥**
```typescript
const updateMinimap = debounce(() => {
  renderStaticLayer(); // å†…å®¹å˜åŒ–æ—¶é‡å»ºé™æ€å±‚
  renderDynamicLayer();
}, 100);

// ç›‘å¬å†…å®¹å˜åŒ–
const observer = new MutationObserver(updateMinimap);
observer.observe(container, { 
  childList: true, 
  subtree: true, 
  attributes: true,
  attributeFilter: ['class'] // å¡ç‰‡å±•å¼€/æŠ˜å 
});

// ç›‘å¬æ»šåŠ¨ï¼ˆé«˜é¢‘ï¼‰
container.addEventListener('scroll', () => {
  renderDynamicLayer(); // ä»…é‡ç»˜åŠ¨æ€å±‚
}, { passive: true });
```

3. **Signal æ•°æ®ç»“æ„æ˜ å°„**
```typescript
interface MinimapSignal {
  position: number;      // offsetTop
  type: SignalType;
  color: string;
  icon: string;         // emoji æˆ– SVG path
  timestamp?: number;   // ç”¨äº Focus Window å…³è”
}

function collectSignals(container: HTMLElement): MinimapSignal[] {
  const signals: MinimapSignal[] = [];
  
  container.querySelectorAll('[data-signal-type]').forEach(el => {
    const type = el.getAttribute('data-signal-type') as SignalType;
    signals.push({
      position: (el as HTMLElement).offsetTop,
      type,
      color: SIGNAL_COLORS[type],
      icon: SIGNAL_ICONS[type],
      timestamp: Number(el.getAttribute('data-timestamp')),
    });
  });
  
  return signals;
}
```

4. **Focus Window ç»˜åˆ¶**
```typescript
function drawFocusWindows(
  ctx: CanvasRenderingContext2D,
  windows: FocusWindow[],
  scale: number
) {
  windows.forEach(window => {
    const startY = window.startMs * scale;
    const endY = window.endMs * scale;
    
    // èƒŒæ™¯é«˜äº®
    ctx.fillStyle = 'rgba(255, 215, 0, 0.2)';
    ctx.fillRect(0, startY, canvas.width, endY - startY);
    
    // å·¦ä¾§å¼ºè°ƒæ¡
    ctx.strokeStyle = '#ffd700';
    ctx.lineWidth = 3;
    ctx.beginPath();
    ctx.moveTo(0, startY);
    ctx.lineTo(0, endY);
    ctx.stroke();
    
    // çª—å£è¾¹æ¡†
    ctx.strokeStyle = 'rgba(255, 215, 0, 0.5)';
    ctx.lineWidth = 1;
    ctx.strokeRect(0, startY, canvas.width, endY - startY);
  });
}
```

**ä¸ Holographic Map çš„ååŒ**

| ç‰¹æ€§ | Canvas Minimapï¼ˆå·¦ï¼‰ | Holographic Mapï¼ˆå³ï¼‰ |
|------|---------------------|----------------------|
| **è§†å›¾ç±»å‹** | è§†è§‰é¸Ÿç° | é€»è¾‘ç»“æ„ |
| **å¯¼èˆªæ–¹å¼** | æ‹–åŠ¨/ç‚¹å‡»å®šä½ | ç‚¹å‡»æ ‘èŠ‚ç‚¹è·³è½¬ |
| **ä¿¡æ¯å¯†åº¦** | å…¨æ–‡æ¡£å‹ç¼©è§†å›¾ | å±•å¼€/æŠ˜å åˆ†çº§ |
| **Signal å±•ç¤º** | ä½ç½®å¯è§†åŒ–ï¼ˆå›¾æ ‡ï¼‰ | è¿‡æ»¤åˆ—è¡¨ï¼ˆå›¾æ ‡+æ–‡å­—ï¼‰ |
| **é€‚ç”¨åœºæ™¯** | å¿«é€Ÿæµè§ˆã€ä½ç½®æ„ŸçŸ¥ | ç²¾ç¡®å¯¼èˆªã€ç­›é€‰æŸ¥æ‰¾ |
| **æ•°æ®æº** | å…±äº« DocumentStructure | å…±äº« DocumentStructure |

**æ€§èƒ½ç›®æ ‡**
- åˆå§‹æ¸²æŸ“ï¼š<100msï¼ˆ1000 æ®µè½ï¼‰
- æ»šåŠ¨æ›´æ–°ï¼š60fpsï¼ˆä»…åŠ¨æ€å±‚é‡ç»˜ï¼‰
- å†…å®¹å˜åŒ–å“åº”ï¼š<200msï¼ˆå«é˜²æŠ–ï¼‰
- å†…å­˜å ç”¨ï¼š<10MBï¼ˆåŒ…å«ç¦»å± Canvasï¼‰

#### 3.2.4 é‡ç‚¹çª—å£æŒ‡ç¤ºå™¨ï¼ˆGranola é£æ ¼ï¼‰

**ä¼šè¯å½•åˆ¶ä¸­**
```
ğŸ™ï¸ å½•åˆ¶ä¸­ï¼š00:12:34

æ—¶é—´çº¿ï¼š
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘
 â†‘                    â†‘
å…³é”®æ—¶åˆ» 1         å…³é”®æ—¶åˆ» 2
ï¼ˆç”¨æˆ·é«˜äº®ï¼‰
```

**ä¼šè¯åæ‘˜è¦æ¨¡æ¿**
```
ä¼šè®®æ‘˜è¦ï¼šQ1 è§„åˆ’
æ—¶é•¿ï¼š45 åˆ†é’Ÿ | 3 ä¸ªå…³é”®æ—¶åˆ» | 8 å¼ æˆªå›¾

ğŸ“Œ å…³é”®æ—¶åˆ»
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. [00:03:12 - 00:04:30] å†³å®šï¼šé‡‡ç”¨ GraphQL
   "æˆ‘ä»¬ä¸€è‡´è®¤ä¸ºçµæ´»æ€§èƒœè¿‡å­¦ä¹ æ›²çº¿"
   [ğŸ–¼ï¸ æˆªå›¾] [ğŸ”Š éŸ³é¢‘]

2. [00:15:44 - 00:17:10] é£é™©ï¼šå›¢é˜Ÿäº§èƒ½æ‹…å¿§
   "Alice æå‡ºäº†å…³äºå½“å‰å†²åˆºè´Ÿè½½çš„åˆç†è§‚ç‚¹"
   [ğŸ–¼ï¸ æˆªå›¾] [ğŸ”Š éŸ³é¢‘]

ğŸ“ æ”¯æŒæ€§ç¬”è®°
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- ç®€çŸ­ä»‹ç»å’Œå›¢é˜Ÿæ›´æ–°ï¼ˆ00:00-00:03ï¼‰
- è¡Œæ”¿åå‹¤è®¨è®ºï¼ˆ00:25-00:30ï¼‰
```

---

## 3.A AI ç”Ÿæˆç®¡é“ï¼ˆæ ¸å¿ƒç®—æ³•ï¼‰

> **æœ¬èŠ‚ç›®çš„**ï¼šå®šä¹‰é‡è¦æ€§è¯„åˆ†ã€Signal èšåˆã€å™äº‹ç”Ÿæˆçš„æ ¸å¿ƒç®—æ³•ï¼Œæ”¯æ’‘ Daily Review / Session Brief ç­‰åŠŸèƒ½ã€‚

### 3.A.1 é‡è¦æ€§è¯„åˆ†ç®—æ³•ï¼ˆå¤šç»´åº¦æ¨¡å‹ï¼‰

**è®¾è®¡ç›®æ ‡**ï¼šä»æµ·é‡äº¤äº’ä¸­è¯†åˆ«çœŸæ­£é‡è¦çš„äº‹ä»¶å’Œå†…å®¹ï¼Œé¿å…"å™ªå£°æ·¹æ²¡ä¿¡å·"ã€‚

**è¯„åˆ†ç»´åº¦**ï¼š

```mermaid
graph LR
    A[Event/Signal é‡è¦æ€§è¯„åˆ†] --> B[æ˜¾å¼äº¤äº’<br/>Explicit]
    A --> C[éšå¼æ³¨æ„åŠ›<br/>Implicit]
    A --> D[AI æ¨æ–­<br/>AI-Inferred]
    A --> E[æ—¶é—´è¡°å‡<br/>Temporal]
    A --> F[ä¸Šä¸‹æ–‡æƒé‡<br/>Contextual]
    
    B --> B1[æ‰‹åŠ¨æ ‡è®°: +10~15]
    B --> B2[AI å¯¹è¯: +5~8]
    B --> B3[ç¼–è¾‘æ¬¡æ•°: +1~5]
    
    C --> C1[æ´»è·ƒåœç•™: +3~10]
    C --> C2[è¿”å›æ¬¡æ•°: +2~6]
    C --> C3[æ»šåŠ¨æ·±åº¦: +1~3]
    
    D --> D1[AI å»ºè®® Signal: +4~8]
    D --> D2[å¤šå¡æ‘˜è¦: +6]
    D --> D3[Focus Window: +8]
    
    E --> E1[2 å°æ—¶å†…: +3]
    E --> E2[æŒ‡æ•°è¡°å‡<br/>halfLife=7å¤©]
    
    F --> F1[ç›¸å…³äº‹ä»¶ç°‡: +2~5]
    F --> F2[ä¸´è¿‘ Deadline: +5]
    F --> F3[è·¨ç¬”è®°å¼•ç”¨: +2/æ¬¡]
```

**å®Œæ•´è¯„åˆ†ç®—æ³•å®ç°**ï¼š

```typescript
/**
 * è®¡ç®— Event æˆ– Signal çš„é‡è¦æ€§è¯„åˆ†
 */
interface ImportanceInput {
  eventId: string;
  signals: Signal[];              // å…³è”çš„ Signal
  behaviorData?: {
    totalViewTime: number;        // æ€»åœç•™æ—¶é•¿ï¼ˆmsï¼‰
    activeViewTime: number;       // æ´»è·ƒåœç•™æ—¶é•¿
    revisitCount: number;         // è¿”å›æ¬¡æ•°
    scrollDepth: number;          // æ»šåŠ¨æ·±åº¦ (0-1)
    editCount: number;            // ç¼–è¾‘æ¬¡æ•°
    aiChatRounds: number;         // AI å¯¹è¯è½®æ¬¡
  };
  contextData?: {
    relatedEventIds: string[];    // ç›¸å…³äº‹ä»¶ç°‡
    referenceCount: number;       // è¢«å¼•ç”¨æ¬¡æ•°
    isDeepWorkHour: boolean;      // æ˜¯å¦åœ¨æ·±åº¦å·¥ä½œæ—¶æ®µ
    daysUntilDeadline?: number;   // è·ç¦»æˆªæ­¢æ—¥æœŸå¤©æ•°
  };
  timestamp: string;              // äº‹ä»¶/Signal åˆ›å»ºæ—¶é—´
}

interface WeightConfig {
  // æ˜¾å¼äº¤äº’æƒé‡
  manualHighlight: number;        // 10
  manualQuestion: number;         // 12
  manualAction: number;           // 15
  aiChatRound: number;            // 5
  editCount: number;              // æ¯æ¬¡ 1ï¼Œæœ€å¤š 5
  
  // éšå¼æ³¨æ„åŠ›æƒé‡
  activeMinute: number;           // æ¯åˆ†é’Ÿ 3ï¼Œæœ€å¤š 10
  revisit: number;                // æ¯æ¬¡ 2ï¼Œæœ€å¤š 6
  scrollDepthFull: number;        // æ»šåŠ¨åˆ°åº• 3
  
  // AI æ¨æ–­æƒé‡
  aiSuggested: number;            // 4-8ï¼ˆæŒ‰ confidenceï¼‰
  multiCardSummary: number;       // 6
  focusWindowMoment: number;      // 8
  
  // æ—¶é—´ç›¸å…³æƒé‡
  recencyBoost: number;           // 2 å°æ—¶å†… +3
  temporalDecayHalfLife: number;  // 7 å¤©
  
  // ä¸Šä¸‹æ–‡æƒé‡
  relatedCluster: number;         // æ¯ä¸ªç›¸å…³äº‹ä»¶ +1
  reference: number;              // æ¯æ¬¡å¼•ç”¨ +2
  nearDeadline: number;           // <3 å¤© +5
}

const DEFAULT_WEIGHTS: WeightConfig = {
  manualHighlight: 10,
  manualQuestion: 12,
  manualAction: 15,
  aiChatRound: 5,
  editCount: 1,
  activeMinute: 3,
  revisit: 2,
  scrollDepthFull: 3,
  aiSuggested: 6,
  multiCardSummary: 6,
  focusWindowMoment: 8,
  recencyBoost: 3,
  temporalDecayHalfLife: 7,
  relatedCluster: 1,
  reference: 2,
  nearDeadline: 5
};

function calculateImportance(
  input: ImportanceInput,
  config: WeightConfig = DEFAULT_WEIGHTS
): number {
  let score = 0;
  
  // 1. æ˜¾å¼äº¤äº’è¯„åˆ†ï¼ˆSignal é©±åŠ¨ï¼‰
  for (const signal of input.signals) {
    switch (signal.type) {
      case 'highlight':
        score += config.manualHighlight;
        break;
      case 'question':
        score += config.manualQuestion;
        break;
      case 'action_item':
        score += config.manualAction;
        break;
      case 'user_question':
        score += config.aiChatRound;
        break;
      // ... å…¶ä»– Signal ç±»å‹
    }
    
    // AI æ¨æ–­ Signal çš„ç½®ä¿¡åº¦åŠ æƒ
    if (signal.createdBy === 'ai' && signal.confidence) {
      score += config.aiSuggested * signal.confidence;
    }
  }
  
  // 2. éšå¼æ³¨æ„åŠ›è¯„åˆ†ï¼ˆè¡Œä¸ºæ•°æ®é©±åŠ¨ï¼‰
  if (input.behaviorData) {
    const { activeViewTime, revisitCount, scrollDepth, editCount, aiChatRounds } = input.behaviorData;
    
    // æ´»è·ƒåœç•™æ—¶é•¿
    const activeMinutes = Math.floor(activeViewTime / 60000);
    score += Math.min(activeMinutes * config.activeMinute, 10);
    
    // è¿”å›æ¬¡æ•°
    score += Math.min(revisitCount * config.revisit, 6);
    
    // æ»šåŠ¨æ·±åº¦
    if (scrollDepth > 0.8) {
      score += config.scrollDepthFull;
    }
    
    // ç¼–è¾‘æ¬¡æ•°
    score += Math.min(editCount * config.editCount, 5);
    
    // AI å¯¹è¯è½®æ¬¡
    score += Math.min(aiChatRounds * config.aiChatRound, 20);
  }
  
  // 3. ä¸Šä¸‹æ–‡æƒé‡
  if (input.contextData) {
    const { relatedEventIds, referenceCount, isDeepWorkHour, daysUntilDeadline } = input.contextData;
    
    // ç›¸å…³äº‹ä»¶ç°‡
    score += relatedEventIds.length * config.relatedCluster;
    
    // å¼•ç”¨æ¬¡æ•°
    score += referenceCount * config.reference;
    
    // æ·±åº¦å·¥ä½œæ—¶æ®µé¢å¤–åŠ æƒ
    if (isDeepWorkHour) {
      score *= 1.2;
    }
    
    // ä¸´è¿‘ Deadline
    if (daysUntilDeadline !== undefined && daysUntilDeadline <= 3) {
      score += config.nearDeadline;
    }
  }
  
  // 4. æ—¶é—´è¡°å‡
  const ageMs = Date.now() - new Date(input.timestamp).getTime();
  const ageDays = ageMs / (1000 * 60 * 60 * 24);
  
  // æ—¶æ•ˆæ€§æå‡ï¼ˆ2 å°æ—¶å†…ï¼‰
  if (ageMs < 2 * 60 * 60 * 1000) {
    score += config.recencyBoost;
  }
  
  // æŒ‡æ•°è¡°å‡
  score = temporalDecay(score, ageDays, config.temporalDecayHalfLife);
  
  return score;
}

/**
 * æ—¶é—´è¡°å‡å‡½æ•°ï¼ˆæŒ‡æ•°è¡°å‡ï¼‰
 */
function temporalDecay(
  score: number,
  daysSinceInteraction: number,
  halfLife: number = 7
): number {
  return score * Math.pow(0.5, daysSinceInteraction / halfLife);
}
```

**åˆ†å±‚è¿‡æ»¤ç­–ç•¥**ï¼š

```typescript
/**
 * å¤šé˜¶æ®µè¿‡æ»¤ï¼Œå¹³è¡¡"å…¨é¢"ä¸"æ— å™ªå£°"
 */
function filterImportantEvents(
  allEvents: Event[],
  signals: Map<string, Signal[]>,
  behaviorData: Map<string, any>,
  options: {
    minScore: number;          // æœ€ä½åˆ†æ•°é˜ˆå€¼ï¼ˆé»˜è®¤ 5ï¼‰
    maxResults: number;        // æœ€å¤šè¿”å›æ•°é‡ï¼ˆé»˜è®¤ 20ï¼‰
    maxPerCategory: number;    // æ¯ç±»æœ€å¤šæ•°é‡ï¼ˆé»˜è®¤ 5ï¼‰
    diversityBoost: boolean;   // æ˜¯å¦å¯ç”¨å¤šæ ·æ€§çº¦æŸ
  }
): Event[] {
  // ç¬¬ 1 å±‚ï¼šåŸºç¡€è¿‡æ»¤ï¼ˆå»é™¤æ˜æ˜¾çš„å™ªå£°ï¼‰
  const candidates = allEvents.filter(event => {
    const eventSignals = signals.get(event.id) || [];
    const behavior = behaviorData.get(event.id);
    
    const score = calculateImportance({
      eventId: event.id,
      signals: eventSignals,
      behaviorData: behavior,
      timestamp: event.createdAt
    });
    
    return score >= options.minScore;
  });
  
  // ç¬¬ 2 å±‚ï¼šè¯„åˆ†æ’åº
  const scored = candidates.map(event => ({
    event,
    score: calculateImportance({
      eventId: event.id,
      signals: signals.get(event.id) || [],
      behaviorData: behaviorData.get(event.id),
      timestamp: event.createdAt
    })
  })).sort((a, b) => b.score - a.score);
  
  // ç¬¬ 3 å±‚ï¼šå¤šæ ·æ€§çº¦æŸï¼ˆé¿å…åŒä¸€ç±»å‹äº‹ä»¶å æ»¡ï¼‰
  if (options.diversityBoost) {
    const diversified = ensureDiversity(scored, {
      maxPerCategory: options.maxPerCategory,
      maxPerProject: options.maxPerCategory
    });
    return diversified.slice(0, options.maxResults).map(item => item.event);
  }
  
  // ç¬¬ 4 å±‚ï¼šTop N é€‰æ‹©
  return scored.slice(0, options.maxResults).map(item => item.event);
}

/**
 * ç¡®ä¿å¤šæ ·æ€§ï¼ˆé¿å…åŒä¸€ç±»å‹äº‹ä»¶è¿‡å¤šï¼‰
 */
function ensureDiversity(
  scoredEvents: Array<{ event: Event; score: number }>,
  options: { maxPerCategory: number; maxPerProject: number }
): Array<{ event: Event; score: number }> {
  const result: Array<{ event: Event; score: number }> = [];
  const categoryCount = new Map<string, number>();
  const projectCount = new Map<string, number>();
  
  for (const item of scoredEvents) {
    const category = item.event.tags?.[0] || 'uncategorized';
    const project = item.event.parentId || 'standalone';
    
    const catCount = categoryCount.get(category) || 0;
    const projCount = projectCount.get(project) || 0;
    
    if (catCount < options.maxPerCategory && projCount < options.maxPerProject) {
      result.push(item);
      categoryCount.set(category, catCount + 1);
      projectCount.set(project, projCount + 1);
    }
    
    if (result.length >= scoredEvents.length) break;
  }
  
  return result;
}
```

### 3.A.2 Session Brief ç”Ÿæˆç®¡é“ï¼ˆGranola é£æ ¼ï¼‰

**è®¾è®¡ç›®æ ‡**ï¼šæ¯æ¬¡ Session ç»“æŸè‡ªåŠ¨ç”Ÿæˆç»“æ„åŒ–ã€å¯è¿½æº¯ã€å¯æ‰§è¡Œçš„ç¬”è®°ä¸è¡ŒåŠ¨é¡¹ã€‚

**æ ¸å¿ƒåŸåˆ™**ï¼š
1. **å›ºå®š schema**ï¼ˆUI ä¸è¾“å‡ºå¯¹é½ï¼‰
2. **å…ˆæŠ½å–å†ç»¼åˆ**ï¼ˆextract â†’ synthesizeï¼Œæé«˜å¯é æ€§ï¼‰
3. **è¯æ®é“¾**ï¼ˆæ¯æ¡ç»“è®ºå¿…é¡»å¸¦ 1-3 æ¡ EvidenceLinkï¼‰
4. **ä¸Šä¸‹æ–‡å«ç”Ÿ**ï¼ˆåªå–‚"æœ¬ session"ï¼‰
5. **å¯æ‰§è¡Œé—­ç¯**ï¼ˆè¡ŒåŠ¨é¡¹ä¸€é”®è½åœ°ï¼‰

**Pipeline æµç¨‹**ï¼š

```typescript
/**
 * Phase 0: æ„å»º AttentionSession ä¸Šä¸‹æ–‡å—ï¼ˆä¸¥æ ¼é™å®šè¾“å…¥èŒƒå›´ï¼‰
 */
interface ContextBlock {
  kind: 'note' | 'transcript' | 'signal';
  id: string;
  ts: number;
  tsEnd?: number;
  text: string;
  ref: {
    eventId?: string;
    timestampId?: string;
    attentionSessionId?: string;
    chunkId?: string;
    signalId?: string;
  };
};

async function buildSessionContextBlocks(attentionSessionId: string): Promise<ContextBlock[]> {
  const blocks: ContextBlock[] = [];
  
  // 0. è¯»å–ä¼šè¯å…ƒæ•°æ®
  const session = await AttentionSessionService.get(attentionSessionId);
  const parentEvent = await EventService.getEvent(session.eventId);
  const eventlog = parentEvent.eventlog;
  
  if (eventlog) {
    const slateJson = JSON.parse(eventlog.slateJson);
    for (const node of slateJson) {
      // 1. Notesï¼šç­›é€‰æ—¶é—´çª—å†…çš„ timestamp nodes
      if (node.type === 'timestamp') {
        const t = parseTimeFromStorage(node.time);
        const start = parseTimeFromStorage(session.startTime);
        const end = parseTimeFromStorage(session.endTime || formatTimeForStorage(new Date()));
        if (t < start || t > end) continue;
        for (const para of node.children) {
          blocks.push({
            kind: 'note',
            id: `note_${node.timestampId}_${para.id}`,
            ts: t,
            text: extractPlainText(para),
            ref: {
              eventId: parentEvent.id,
              timestampId: node.timestampId
            }
          });
        }
      }
    }
  }
  
  // 2. Transcriptï¼šç­›é€‰ transcript.attentionSessionId === attentionSessionIdï¼ˆæˆ–æ—¶é—´çª—å†…ï¼‰
  const transcripts = await TranscriptService.getByAttentionSession(attentionSessionId);
  for (const chunk of transcripts) {
    blocks.push({
      kind: 'transcript',
      id: `transcript_${chunk.id}`,
      ts: chunk.tsStart,
      tsEnd: chunk.tsEnd,
      text: chunk.text,
      ref: {
        attentionSessionId,
        chunkId: chunk.id
      }
    });
  }
  
  // 3. Signalsï¼šæ—¶é—´çª—å†…èšåˆ
  const signals = await SignalService.getSignalsInTimeRange(
    session.startTime,
    session.endTime || formatTimeForStorage(new Date()),
    { types: ['highlight', 'question', 'action_item'] }
  );
  for (const signal of signals) {
    blocks.push({
      kind: 'signal',
      id: signal.id,
      ts: parseTimeFromStorage(signal.createdAt),
      text: signal.content,
      ref: {
        signalId: signal.id
      }
    });
  }
  
  return blocks.sort((a, b) => a.ts - b.ts);
}

/**
 * Phase 1: Extractï¼ˆé«˜å¬å›æŠ½å–å€™é€‰ï¼‰
 */
interface ExtractedClaim {
  type: 'action' | 'decision' | 'question' | 'key_point';
  text: string;
  sourceRefs: string[];  // ContextBlock.id åˆ—è¡¨
  confidence: number;
}

async function extractClaims(
  contextBlocks: ContextBlock[]
): Promise<ExtractedClaim[]> {
  // è°ƒç”¨ AI æ¨¡å‹ï¼ˆprompt ç¤ºä¾‹è§ä¸‹æ–‡ï¼‰
  const prompt = `
ä½ æ˜¯ä¼šè®®çºªè¦åŠ©æ‰‹ã€‚è¯·ä»ä»¥ä¸‹ä¸Šä¸‹æ–‡ä¸­æŠ½å–æ‰€æœ‰å¯èƒ½çš„è¡ŒåŠ¨é¡¹ã€å†³å®šã€ç–‘é—®å’Œå…³é”®ç‚¹ã€‚
è¦æ±‚ï¼š
1. é«˜å¬å›ç‡ï¼ˆå®å¯å¤šæŠ½å–ï¼Œåç»­å»é‡ï¼‰
2. æ¯æ¡å¿…é¡»å¸¦ sourceRefsï¼ˆå¼•ç”¨åŸæ–‡ IDï¼‰
3. ç»™å‡ºç½®ä¿¡åº¦ (0-1)

ä¸Šä¸‹æ–‡ï¼š
${contextBlocks.map(b => `[${b.id}] ${b.text}`).join('\n')}

è¾“å‡º JSON æ ¼å¼ï¼š
[
  {
    "type": "action",
    "text": "å¼ ä¸‰è´Ÿè´£å‘¨äº”å‰å®Œæˆ API æ–‡æ¡£",
    "sourceRefs": ["note_xxx_yyy", "transcript_zzz"],
    "confidence": 0.85
  },
  ...
]
  `.trim();
  
  const response = await AIService.call(prompt);
  return JSON.parse(response);
}

/**
 * Phase 2: Synthesizeï¼ˆé«˜ç²¾åº¦å»é‡å½’å¹¶ï¼‰
 */
interface SynthesizedClaim {
  id: string;              // ç¨³å®š IDï¼ˆkp_xxx / dc_xxx / ai_xxx / q_xxxï¼‰
  type: 'key_point' | 'decision' | 'action_item' | 'open_question';
  text: string;
  owner?: string;          // action_item ä¸“ç”¨
  due?: string;
  priority?: 'high' | 'medium' | 'low';
  confidence: number;
  evidenceRefs: string[];  // æœ€ç»ˆé€‰æ‹©çš„ 1-3 ä¸ª sourceRefs
}

async function synthesizeClaims(
  extracted: ExtractedClaim[]
): Promise<SynthesizedClaim[]> {
  const prompt = `
ä½ æ˜¯ä¼šè®®çºªè¦åŠ©æ‰‹ï¼ˆç»¼åˆé˜¶æ®µï¼‰ã€‚è¯·å¯¹ä»¥ä¸‹å€™é€‰è¿›è¡Œå»é‡ã€å½’å¹¶ã€è¡¥é½å­—æ®µã€‚

è¦æ±‚ï¼š
1. å»é‡ï¼šåˆå¹¶è¯­ä¹‰ç›¸ä¼¼çš„æ¡ç›®
2. è¡¥é½ï¼šå°½é‡å¡«å†™ owner/due/priorityï¼ˆä»ä¸Šä¸‹æ–‡æ¨æ–­ï¼‰
3. è¯æ®ï¼šæ¯æ¡é€‰æ‹© 1-3 ä¸ªæœ€å¼ºçš„ sourceRefs
4. ç”Ÿæˆç¨³å®š IDï¼ˆkp_001, dc_001, ai_001, q_001ï¼‰

å€™é€‰ï¼š
${JSON.stringify(extracted, null, 2)}

è¾“å‡º JSON æ ¼å¼ï¼š
[
  {
    "id": "ai_001",
    "type": "action_item",
    "text": "å¼ ä¸‰è´Ÿè´£å‘¨äº”å‰å®Œæˆ API æ–‡æ¡£",
    "owner": "å¼ ä¸‰",
    "due": "2026-01-10",
    "priority": "high",
    "confidence": 0.9,
    "evidenceRefs": ["note_xxx", "transcript_yyy"]
  },
  ...
]
  `.trim();
  
  const response = await AIService.call(prompt);
  return JSON.parse(response);
}

/**
 * Phase 3: ç”Ÿæˆæœ€ç»ˆ Session Brief
 */
async function generateSessionBrief(attentionSessionId: string): Promise<Artifact> {
  // 1. æ„å»ºä¸Šä¸‹æ–‡
  const contextBlocks = await buildSessionContextBlocks(attentionSessionId);
  
  // 2. Extract
  const extracted = await extractClaims(contextBlocks);
  
  // 3. Synthesize
  const synthesized = await synthesizeClaims(extracted);
  
  // 4. æŒ‰ç±»å‹åˆ†ç»„
  const keyPoints = synthesized.filter(c => c.type === 'key_point');
  const decisions = synthesized.filter(c => c.type === 'decision');
  const actionItems = synthesized.filter(c => c.type === 'action_item');
  const openQuestions = synthesized.filter(c => c.type === 'open_question');
  
  // 5. ç”Ÿæˆ TL;DRï¼ˆå¯é€‰ï¼Œå•ç‹¬è°ƒç”¨ AIï¼‰
  const tldr = await generateTLDR(contextBlocks);
  
  // 6. åˆ›å»º Artifact
  const artifact = await ArtifactService.create({
    scope: 'session',
    targetId: attentionSessionId,
    type: 'brief',
    contentJson: {
      tldr,
      key_points: keyPoints,
      decisions,
      action_items: actionItems,
      open_questions: openQuestions
    },
    status: 'draft'
  });
  
  // 7. åˆ›å»º EvidenceLink
  for (const claim of synthesized) {
    for (const ref of claim.evidenceRefs) {
      const block = contextBlocks.find(b => b.id === ref);
      if (block) {
        await EvidenceLinkService.create({
          targetArtifactId: artifact.id,
          claimId: claim.id,
          sourceType: block.kind === 'note' ? 'eventlog_timestamp' : 
                     block.kind === 'transcript' ? 'transcript_chunk' : 'signal',
          sourceRef: block.ref,
          quote: block.text.substring(0, 200),
          confidence: claim.confidence
        });
      }
    }
  }
  
  return artifact;
}
```

### 3.A.3 Daily Narrative ç”Ÿæˆç®¡é“

**è®¾è®¡ç›®æ ‡**ï¼šç”Ÿæˆ"åƒç”¨æˆ·è‡ªå·±å†™çš„æ—¥è®°"ï¼Œè€Œéå†°å†·çš„æ•°æ®æŠ¥å‘Šã€‚

**æ ¸å¿ƒåŸåˆ™**ï¼š
1. **ç¬¬ä¸€äººç§°å™äº‹**ï¼ˆ"æˆ‘"è€Œé"ä½ "ï¼‰
2. **æƒ…æ„Ÿè¡¨è¾¾**ï¼ˆé€‚å½“åŠ å…¥ä¸»è§‚æ„Ÿå—ï¼‰
3. **çŸ¥è¯†æ²‰æ·€**ï¼ˆä¸åªè®°å½•è¡Œä¸ºï¼Œè¿˜è®°å½•æ”¶è·ï¼‰
4. **è‡ªç„¶æµç•…**ï¼ˆé¿å…æœºæ¢°åˆ—ä¸¾æ•°æ®ï¼‰
5. **å¯ç¼–è¾‘æ€§**ï¼ˆç”¨æˆ·å¯ä¿®æ”¹ AI ç”Ÿæˆå†…å®¹ï¼‰

**ç”Ÿæˆæµç¨‹**ï¼š

```typescript
async function generateDailyNarrative(date: string): Promise<Artifact> {
  // 1. æ”¶é›†å½“å¤©æ‰€æœ‰è¯æ®
  const evidence = await collectDailyEvidence(date);
  
  // 2. ç­›é€‰é‡è¦äº‹ä»¶ï¼ˆåŸºäºè¯„åˆ†ç®—æ³•ï¼‰
  const importantEvents = filterImportantEvents(
    evidence.events,
    evidence.signals,
    evidence.behaviorData,
    {
      minScore: 5,
      maxResults: 20,
      maxPerCategory: 5,
      diversityBoost: true
    }
  );
  
  // 3. æå–ç”¨æˆ·é«˜äº®å†…å®¹
  const highlights = await extractUserHighlights(importantEvents);
  
  // 4. ç”Ÿæˆå™äº‹æ‘˜è¦ï¼ˆè°ƒç”¨ AIï¼‰
  const narrative = await generateNarrativeText({
    date,
    events: importantEvents,
    highlights,
    sessions: evidence.sessions,
    takeaways: evidence.takeaways
  });
  
  // 5. åˆ›å»º Artifact
  return ArtifactService.create({
    scope: 'daily',
    targetId: date,
    type: 'rolling_summary',
    contentJson: {
      tldr: narrative.summary,
      key_points: narrative.learnings,
      open_questions: narrative.openLoops,
      action_items: narrative.actionItems
    },
    status: 'draft'
  });
}

/**
 * Prompt æ¨¡æ¿ï¼ˆç¬¬ä¸€äººç§° + æƒ…æ„Ÿè¡¨è¾¾ï¼‰
 */
function generateNarrativePrompt(data: any): string {
  return `
ä½ æ˜¯ç”¨æˆ·çš„ä¸ªäººæ—¥è®°åŠ©æ‰‹ã€‚è¯·æ ¹æ®ä»¥ä¸‹ç»“æ„åŒ–æ•°æ®ï¼Œç”Ÿæˆä¸€ç¯‡**ç¬¬ä¸€äººç§°ã€è‡ªç„¶æµç•…**çš„æ—¥è®°ã€‚

## è¦æ±‚ï¼š
1. **ä½¿ç”¨ç¬¬ä¸€äººç§°**ï¼ˆ"æˆ‘"è€Œé"ä½ "ï¼‰
2. **è‡ªç„¶çš„è¯­è¨€**ï¼ˆä¸è¦åƒæ•°æ®æŠ¥å‘Šï¼Œè¦åƒäººåœ¨å†™æ—¥è®°ï¼‰
3. **èå…¥å­¦ä¹ æ”¶è·**ï¼ˆç”¨æˆ·é«˜äº®çš„å†…å®¹ã€ä» AI å¯¹è¯ä¸­å­¦åˆ°çš„çŸ¥è¯†ï¼‰
4. **é€‚å½“çš„æƒ…æ„Ÿè¡¨è¾¾**ï¼ˆ"æ„Ÿè§‰æœ‰ç‚¹å¤æ‚"ã€"è¿›å±•é¡ºåˆ©"ç­‰ï¼‰
5. **æœ‰åæ€**ï¼ˆ"çœ‹æ¥éœ€è¦è°ƒæ•´è®¡åˆ’"ã€"å¯ä»¥å€Ÿé‰´è¿™ä¸ªæ€è·¯"ï¼‰

## æ•°æ®ï¼š
### ä¸»çº¿ä»»åŠ¡ï¼š
- é¡¹ç›®ï¼š${data.mainProject?.title}
- æŠ•å…¥æ—¶é—´ï¼š${formatTime(data.mainProject?.activeTime)}
- ä¸»è¦è¡ŒåŠ¨ï¼š${data.mainProject?.actions.join('ã€')}

### å­¦ä¹ æ”¶è·ï¼ˆç”¨æˆ·é«˜äº®çš„å†…å®¹ï¼‰ï¼š
${data.learnings.map(l => `- ${l.text}`).join('\n')}

### ä¼šè®®è®°å½•ï¼š
${data.meetings.map(m => `
- ${m.title}ï¼ˆ${formatTime(m.timestamp)}ï¼‰
- æ‘˜è¦ï¼š${m.summary}
- å…³é”®æ”¶è·ï¼š${m.keyTakeaways.join('ï¼›')}
`).join('\n')}

---

è¯·ç”Ÿæˆä¸€ç¯‡ 200-300 å­—çš„æ—¥è®°ï¼ŒåŒ…å«ï¼š
1. å¼€å¤´æ®µè½ï¼šä»Šå¤©ä¸»è¦åšäº†ä»€ä¹ˆ + å­¦åˆ°äº†ä»€ä¹ˆ
2. åç»­æ®µè½ï¼šä¼šè®®/åä½œäº‹é¡¹ï¼ˆå¦‚æœæœ‰ï¼‰
3. ç»“å°¾éƒ¨åˆ†ï¼šå¾…åŠäº‹é¡¹ + æ˜å¤©é‡ç‚¹

æ³¨æ„ï¼š
- ä¸è¦è¯´"ä»Šå¤©ä½ ..."ï¼Œè¦è¯´"ä»Šå¤©æˆ‘..."
- ä¸è¦æœºæ¢°åˆ—ä¸¾æ•°æ®ï¼ˆå¦‚"ä¸ AI è¿›è¡Œäº† 12 è½®å¯¹è¯"ï¼‰ï¼Œè€Œæ˜¯è¯´"æ·±å…¥ç ”ç©¶äº†..."
- é€‚å½“åŠ å…¥ä¸»è§‚æ„Ÿå—ï¼ˆå¦‚"æ„Ÿè§‰æµç¨‹æ¯”æƒ³è±¡ä¸­å¤æ‚"ï¼‰
- å¦‚æœç”¨æˆ·é«˜äº®äº†æŸäº›å†…å®¹ï¼Œè¦è‡ªç„¶åœ°èå…¥æ­£æ–‡ï¼ˆè€Œéå•ç‹¬åˆ—ä¸¾ï¼‰
  `.trim();
}
```

---

## 4. è¯¦ç»†åŠŸèƒ½éœ€æ±‚

### 4.1 è¯æ®æ”¶é›†ç³»ç»Ÿ

**FR-Evidence-1ï¼šEventLog æ•è·**  
ç³»ç»Ÿ**å¿…é¡»**è®°å½•æ‰€æœ‰ç”¨æˆ·äº¤äº’çš„ä¸å¯å˜ã€å¸¦æ—¶é—´æˆ³çš„äº‹ä»¶ï¼š
- å¿…éœ€å­—æ®µï¼š`event_id`ã€`user_id`ã€`timestamp`ã€`event_type`ã€`metadata`
- æœ€ä½æ•è·äº‹ä»¶ï¼š`ASK_AI`ã€`ANSWER_RECEIVED`ã€`CARD_EXPANDED`ã€`HIGHLIGHT_ADDED`ã€`TAG_CHANGED`ã€`SESSION_STARTED`ã€`SESSION_ENDED`
- æ—¥å¿—å­˜å‚¨ï¼šä»…è¿½åŠ ï¼ŒæŒ‰ `timestamp` å’Œ `event_type` ç´¢å¼•

**FR-Evidence-2ï¼šSignal è®°å½•**  
ç³»ç»Ÿ**å¿…é¡»**æ”¯æŒç”¨æˆ·å‘èµ·çš„ Signalï¼š
- çƒ­é”®æ”¯æŒï¼ˆå…¨å±€å¿«æ·é”®ï¼Œå¯è‡ªå®šä¹‰ï¼‰
- è¯­éŸ³æç¤ºè¯æ£€æµ‹ï¼ˆå…³é”®è¯è§¦å‘ï¼š"é‡ç‚¹"ã€"é—®é¢˜"ã€"å¾…åŠ"ï¼‰
- UI æŒ‰é’®è®¿é—®ï¼ˆå½•åˆ¶é¢æ¿ï¼‰
- å­˜å‚¨ï¼šé“¾æ¥åˆ° `note_id`ã€`paragraph_id`ã€`audio_offset_ms`ã€`image_id`ï¼ˆå¦‚é€‚ç”¨ï¼‰

**FR-Evidence-3ï¼šæ—¶é—´çº¿è¯æ®**  
ç³»ç»Ÿ**åº”è¯¥**æ•´åˆæ—¥å†äº‹ä»¶ï¼ˆå¯é€‰ï¼‰å’Œä¼šè¯æ—¶é—´èŒƒå›´ä½œä¸ºè¯æ®è¾“å…¥ã€‚

### 4.2 æ™ºèƒ½è½¬å†™ä¸å¿«ç…§

**FR-Audio-1ï¼šRECNote é›†æˆ**  
ç³»ç»Ÿ**å¿…é¡»**é€šè¿‡ RECNote è§„èŒƒå®ç°éŸ³é¢‘-ç¬”è®°åŒæ­¥ï¼š
- éŸ³é¢‘æ ¼å¼ï¼š**16kHz å•å£°é“ Opus @ 24kbps**ï¼ˆç›®æ ‡ <12MB/å°æ—¶ï¼‰
- é”šç‚¹å­˜å‚¨ï¼šæ®µè½å…ƒæ•°æ®ä¸­çš„ `audioAnchor { recordingId, offsetMs }`
- å›æ”¾ï¼šç‚¹å‡»æ®µè½ â†’ éŸ³é¢‘å®šä½åˆ° `offsetMs` å¹¶æ’­æ”¾
- æœ¬åœ°å¤„ç†ï¼šç©ºé—²æ—¶ Whisper è½¬å†™ â†’ FTS5 ç´¢å¼•
- éšç§ï¼šéŸ³é¢‘æ–‡ä»¶é»˜è®¤æœ¬åœ°å­˜å‚¨ï¼Œäº‘åŒæ­¥å¯é€‰

**FR-Audio-2ï¼šFocus Window å¤„ç†**  
å¯¹äº Focus Window å†…çš„éŸ³é¢‘ç‰‡æ®µï¼ˆSignal Â± æ—¶é—´å¢é‡ï¼‰ï¼š
- æ›´é«˜è½¬å†™è´¨é‡ï¼ˆä¿ç•™é€å­—è®°å½•ï¼‰
- æ›´ç»†åˆ†æ®µï¼ˆå¥å­çº§ï¼‰
- Focus Window å¤–ï¼šæ¿€è¿›å‹ç¼©ï¼ˆ1-2 å¥æ‘˜è¦ï¼‰

**FR-Snapshot-1ï¼šæ™ºèƒ½å¸§æ•è·**  
åœ¨å±å¹•å½•åˆ¶ä¼šè¯æœŸé—´ï¼Œç³»ç»Ÿ**å¿…é¡»**ï¼š
- æ£€æµ‹åœºæ™¯å˜åŒ–ï¼ˆé˜ˆå€¼ï¼š>5% åƒç´ å·®å¼‚ä¸ºå°å˜åŒ–ï¼Œ>20% ä¸ºåœºæ™¯è¾¹ç•Œï¼‰
- å®ç°å€™é€‰æ§½æœºåˆ¶ï¼šæ¯ä¸ªåœºæ™¯ä»…ä¿å­˜ä¿¡æ¯æœ€ä¸°å¯Œçš„å¸§
- **ä¸**ä¿å­˜å®Œæ•´è§†é¢‘æ–‡ä»¶ï¼ˆä»…ç¦»æ•£æˆªå›¾ï¼‰
- ç”Ÿæˆå¸¦å…ƒæ•°æ®çš„æˆªå›¾ï¼š`image_id`ã€`scene_id`ã€`created_at_ms`ã€`hash_32x32`ã€`similarity_to_prev`

**FR-Snapshot-2ï¼šOCR é›†æˆ**  
ç³»ç»Ÿ**åº”è¯¥**å¯¹ä¿å­˜çš„æˆªå›¾è¿è¡Œ OCRï¼š
- æ‰§è¡Œï¼šèŠ‚æµ/æŒ‰éœ€ï¼Œé¿å…é˜»å¡ UI
- è¾“å‡ºï¼š`ocr_text` + `ocr_confidence` å­˜å‚¨åœ¨å›¾åƒä¸­
- ç”¨é€”ï¼šå¯æœç´¢ï¼ŒåŒ…å«åœ¨ä¼šè®®ç¬”è®°ç”Ÿæˆä¸­

**FR-Snapshot-3ï¼šè¯æ®é“¾æ¥**  
æ¯ä¸ª Highlight/Signal **å¿…é¡»**è®°å½•å½“å‰/æœ€è¿‘æˆªå›¾çš„ `image_id`ï¼Œä»¥ä¾¿åœ¨ç”Ÿæˆçš„ç¬”è®°ä¸­æä¾›å¯ç‚¹å‡»å¼•ç”¨ã€‚

### 4.3 æ”¶è·ç»“ç®—å±‚

**FR-Takeaway-1ï¼šè‡ªåŠ¨å€™é€‰ç”Ÿæˆ**  
ç³»ç»Ÿ**å¿…é¡»**åœ¨ä»¥ä¸‹æƒ…å†µä¸‹è‡ªåŠ¨ç”Ÿæˆ TakeawayCandidateï¼š
- `AI_ANSWERED`ï¼šä»å›ç­”æ‘˜è¦ç”Ÿæˆ 1 ä¸ªå€™é€‰
- `SUMMARY_GENERATED`ï¼šä»å…³é”®ç‚¹ç”Ÿæˆ 3-5 ä¸ªå€™é€‰
- `SESSION_ENDED`ï¼šä»å…³é”®æ—¶åˆ»ï¼ˆfocus windowï¼‰ç”Ÿæˆ N ä¸ªå€™é€‰

**FR-Takeaway-2ï¼šæ‰‹åŠ¨æ ‡è®°**  
ç”¨æˆ·**å¿…é¡»**èƒ½å¤Ÿæ‰‹åŠ¨æ ‡è®°ä»»ä½•æ®µè½/å¡ç‰‡ä¸º Takeawayï¼š
- UIï¼šæ˜Ÿæ ‡/ä¹¦ç­¾å›¾æ ‡æˆ–å³é”®èœå•
- åˆ›å»º `source_type: manual` å€™é€‰ï¼Œæƒé‡æœ€é«˜

**FR-Takeaway-3ï¼šå€™é€‰ Schema**  
TakeawayCandidate å­˜å‚¨**å¿…é¡»**åŒ…å«ï¼š
```typescript
{
  takeaway_id: string;
  user_id: string;
  date: string; // YYYY-MM-DD
  source_type: 'card' | 'session' | 'web_clip' | 'manual';
  source_id: string;
  created_at: timestamp;
  text: string; // â‰¤200 å­—ç¬¦
  topic?: string;
  embedding?: Float32Array; // å¯é€‰ï¼Œç”¨äºèšç±»
  weight: number;
  evidence_refs: Array<{type: string, id: string}>;
  status: 'active' | 'archived' | 'rejected';
}
```

**FR-Takeaway-4ï¼šæƒé‡è®¡ç®—**  
æƒé‡å…¬å¼ï¼š`manual_signal + system_signal + behavior_signal + recency_signal`

| Signal ç±»å‹ | æƒé‡åˆ†é‡ | MVP åŒ…å« |
|-------------|----------|----------|
| æ‰‹åŠ¨ HIGHLIGHT | +10 | âœ… æ˜¯ |
| æ‰‹åŠ¨ ACTION_ITEM | +15 | âœ… æ˜¯ |
| æ‰‹åŠ¨ QUESTION | +12 | âœ… æ˜¯ |
| æ¥è‡ª Focus Window å…³é”®æ—¶åˆ» | +8 | âœ… æ˜¯ |
| æ¥è‡ªå¤šå¡æ‘˜è¦ | +6 | âœ… æ˜¯ |
| å¡ç‰‡å±•å¼€æ¬¡æ•° | æ¯æ¬¡ +1ï¼ˆæœ€å¤š +5ï¼‰ | âš ï¸ å¯é€‰ |
| å¼•ç”¨æ¬¡æ•° | æ¯æ¬¡ +2 | âš ï¸ å¯é€‰ |
| æ—¶æ•ˆæ€§æå‡ | æœ€è¿‘ 2h å†… +3 | âŒ MVP å |

### 4.4 æ¯æ—¥/æ¯å‘¨/æ¯æœˆå›é¡¾ç”Ÿæˆ

**FR-Review-1ï¼šæ¯æ—¥å™äº‹ç”Ÿæˆ**  
ç³»ç»Ÿ**å¿…é¡»**æ”¯æŒæŒ‰éœ€æˆ–å®šæ—¶çš„æ¯æ—¥å™äº‹ç”Ÿæˆï¼š
- è¾“å…¥ï¼šç›®æ ‡æ—¥æœŸçš„æ‰€æœ‰è¯æ®ï¼ˆæ—¶é—´çº¿ã€äº¤äº’ã€äº§å‡ºï¼‰
- è¾“å‡ºç« èŠ‚ï¼š
  1. **å™äº‹æ‘˜è¦**ï¼š2-4 æ®µï¼ŒæŒ‰æ—¶é—´åˆ†æ®µï¼ˆä¸Šåˆ/ä¸‹åˆ/æ™šä¸Šæˆ–åŸºäºä¼šè¯ï¼‰
  2. **æ ¸å¿ƒæ”¶è·**ï¼š3-7 é¡¹ï¼ŒæŒ‰æƒé‡æ’åºï¼Œæ¯é¡¹å¸¦å¯ç‚¹å‡»çš„ `evidence_refs`
  3. **å¼€æ”¾å¾ªç¯**ï¼šæå–çš„ç–‘é—® + AI æ£€æµ‹çš„æœªè§£å†³é¡¹
  4. **è¡ŒåŠ¨é¡¹**ï¼šä» `ACTION_ITEM` Signal æå– + æ‘˜è¦è§£æ
  5. **å…±é¸£**ï¼ˆå¯é€‰ï¼‰ï¼šé€šè¿‡åµŒå…¥ç›¸ä¼¼åº¦çš„è·¨ç¬”è®°è¿æ¥

**FR-Review-2ï¼šæ¯å‘¨/æ¯æœˆç»¼åˆ**  
ç³»ç»Ÿ**åº”è¯¥**æ”¯æŒå¤åˆ©å¼å›é¡¾ï¼š
- æ¯å‘¨ï¼šèšåˆè¿‡å» 7 å¤©çš„æ¯æ—¥å™äº‹ â†’ å…ƒç»¼åˆ
- æ¯æœˆï¼šèšåˆæ¯å‘¨æ‘˜è¦ â†’ ä¸»é¢˜è¶‹åŠ¿
- æ‰€æœ‰å›é¡¾ä¿æŒå‘åŸå­æºçš„åå‘ `evidence_refs`

**FR-Review-3ï¼šé‡æ–°ç”Ÿæˆæ”¯æŒ**  
ç”¨æˆ·**å¿…é¡»**èƒ½å¤Ÿåœ¨ä»¥ä¸‹æƒ…å†µåé‡æ–°ç”Ÿæˆä»»ä½•å›é¡¾ï¼š
- ç¼–è¾‘æºç¬”è®°
- æ›´æ”¹ Signal æ ‡ç­¾
- è°ƒæ•´è¿‡æ»¤å™¨ï¼ˆä¾‹å¦‚æ’é™¤æŸäº›ä¸»é¢˜ï¼‰

### 4.5 å…¨æ¯ç›®å½•ä¸è§†è§‰ç¼©ç•¥å›¾

#### 4.5.1 Holographic Mapï¼ˆå³ä¾§æ ‘å½¢å¤§çº²ï¼‰

**FR-Map-1ï¼šè‡ªåŠ¨ç”Ÿæˆ**  
ç³»ç»Ÿ**å¿…é¡»**ä»ç¬”è®°ç»“æ„è‡ªåŠ¨ç”Ÿæˆå¤§çº²ï¼š
- å±‚çº§ï¼šH1/H2/H3 â†’ åµŒå¥—åˆ—è¡¨
- Signal è£…é¥°ï¼šæ ¹æ®æ®µè½ Signal ä¸ºè¡Œæ·»åŠ  â­/â“/âœ… å›¾æ ‡å‰ç¼€
- æ›´æ–°è§¦å‘ï¼šä»»ä½•ç¬”è®°ç¼–è¾‘åé˜²æŠ–ï¼ˆ500ms å»¶è¿Ÿï¼‰

**FR-Map-2ï¼šè¿‡æ»¤**  
ç”¨æˆ·**å¿…é¡»**èƒ½å¤ŸæŒ‰ Signal ç±»å‹è¿‡æ»¤å¤§çº²ï¼š
- æŒ‰é’®ï¼š[â­ é«˜äº®] [â“ ç–‘é—®] [âœ… è¡ŒåŠ¨é¡¹] [å…¨éƒ¨]
- è¿‡æ»¤è§†å›¾éšè—ä¸åŒ¹é…é¡¹ï¼Œæ˜¾ç¤ºç¥–å…ˆä»¥ä¿æŒä¸Šä¸‹æ–‡

**FR-Map-3ï¼šå¯¼èˆª**  
ç‚¹å‡»ä»»ä½•å¤§çº²é¡¹ â†’ æ»šåŠ¨åˆ°æ®µè½ + çŸ­æš‚é«˜äº®åŠ¨ç”»ï¼ˆ500msï¼‰

#### 4.5.2 Canvas Minimapï¼ˆå·¦ä¾§è§†è§‰ç¼©ç•¥å›¾ï¼‰

**FR-Minimap-1ï¼šå†…å®¹æ˜ å°„**  
ç³»ç»Ÿ**å¿…é¡»**åœ¨ Canvas ä¸Šæ¸²æŸ“å…¨æ–‡æ¡£ç¼©ç•¥å›¾ï¼š
- æ®µè½/å¡ç‰‡æ˜ å°„ä¸ºçŸ©å½¢å—ï¼Œé¢œè‰²åŒºåˆ†ç±»å‹ï¼ˆæ®µè½/AI Answer/Summary/Event/Clipï¼‰
- é«˜åº¦æŒ‰æ¯”ä¾‹ç¼©æ”¾ï¼š`blockHeight = Math.max(2, originalHeight * scale)`
- å®½åº¦å›ºå®šï¼š100pxï¼ˆSignal å›¾æ ‡åŒºé¢„ç•™ 15pxï¼‰

**FR-Minimap-2ï¼šSignal å¯è§†åŒ–**  
ç³»ç»Ÿ**å¿…é¡»**åœ¨å¯¹åº”ä½ç½®æ¸²æŸ“ Signal å›¾æ ‡ï¼š
- ä½ç½®ï¼šSignal æ‰€åœ¨æ®µè½çš„ `offsetTop * scale`
- å›¾æ ‡ï¼šåœ†ç‚¹ï¼ˆåŠå¾„ 3pxï¼‰æˆ– emojiï¼ˆ10px å­—ä½“ï¼‰
- é¢œè‰²æ˜ å°„ï¼š
  - `HIGHLIGHT` â†’ é‡‘è‰² `#ffd700`
  - `QUESTION` â†’ çº¢è‰² `#f44336`
  - `ACTION_ITEM` â†’ ç´«è‰² `#9c27b0`
  - `OBJECTION` â†’ å†°è“ `#00bcd4`

**FR-Minimap-3ï¼šå®æ—¶æ›´æ–°**  
ç³»ç»Ÿ**å¿…é¡»**å“åº”å†…å®¹å˜åŒ–å’Œæ»šåŠ¨ï¼š
- å†…å®¹å˜åŒ–ï¼ˆå¢åˆ æ®µè½ã€å¡ç‰‡å±•å¼€/æŠ˜å ï¼‰ï¼šé˜²æŠ– 100ms åé‡ç»˜é™æ€å±‚
- æ»šåŠ¨äº‹ä»¶ï¼šç«‹å³é‡ç»˜åŠ¨æ€å±‚ï¼ˆè§†çª—æŒ‡ç¤ºå™¨ï¼‰ï¼Œç›®æ ‡ 60fps
- ç›‘å¬æœºåˆ¶ï¼š`MutationObserver` + `scroll` äº‹ä»¶ç›‘å¬å™¨

**FR-Minimap-4ï¼šäº¤äº’å¯¼èˆª**  
ç”¨æˆ·**å¿…é¡»**èƒ½å¤Ÿé€šè¿‡ Minimap å¿«é€Ÿå¯¼èˆªï¼š
- ç‚¹å‡»ï¼šè·³è½¬åˆ°å¯¹åº”ä½ç½®ï¼ˆç‚¹å‡» Y åæ ‡ / scale â†’ scrollTopï¼‰
- æ‹–åŠ¨ï¼šæŒ‰ä½é¼ æ ‡æ‹–åŠ¨è§†çª—æ»‘å—å®ç°è¿ç»­æ»šåŠ¨
- Hoverï¼šæ˜¾ç¤ºæ‚¬æµ®æç¤ºï¼ˆæ®µè½ç±»å‹ã€Signal åˆ—è¡¨ã€æ–‡å­—é¢„è§ˆå‰ 50 å­—ç¬¦ï¼‰

**FR-Minimap-5ï¼šFocus Window é›†æˆ**  
åœ¨ä¼šè¯å½•åˆ¶æœŸé—´ï¼Œç³»ç»Ÿ**åº”è¯¥**åœ¨ Minimap ä¸Šé«˜äº® Focus Windowï¼š
- åŠé€æ˜é‡‘è‰²èƒŒæ™¯è¦†ç›–çª—å£æ—¶é—´èŒƒå›´
- å·¦ä¾§ 3px é‡‘è‰²è¾¹æ¡†å¼ºè°ƒ
- å®æ—¶æ›´æ–°ï¼šç”¨æˆ·æ·»åŠ  HIGHLIGHT Signal æ—¶ç«‹å³æ˜¾ç¤ºæ–°çª—å£

**FR-Minimap-6ï¼šæ€§èƒ½ä¼˜åŒ–**  
ç³»ç»Ÿ**å¿…é¡»**é‡‡ç”¨åˆ†å±‚æ¸²æŸ“ç­–ç•¥ï¼š
- é™æ€å±‚ï¼ˆç¦»å± Canvasï¼‰ï¼šç¼“å­˜æ®µè½/å¡ç‰‡çŸ©å½¢å—ï¼Œä»…åœ¨å†…å®¹å˜åŒ–æ—¶é‡ç»˜
- åŠ¨æ€å±‚ï¼ˆä¸» Canvasï¼‰ï¼šæ¯å¸§ç»˜åˆ¶ Signalã€è§†çª—ã€Focus Window
- è™šæ‹Ÿæ¸²æŸ“ï¼ˆå¯é€‰ï¼‰ï¼šå¤§æ–‡æ¡£ï¼ˆ>2000 æ®µè½ï¼‰æ—¶ä»…æ¸²æŸ“å¯è§åŒºåŸŸ Â±1 å±å†…å®¹

**FR-Minimap-7ï¼šæ•°æ®å…±äº«**  
ç³»ç»Ÿ**å¿…é¡»**ä¸ Holographic Map å…±äº«æ•°æ®æºï¼š
```typescript
interface DocumentStructure {
  paragraphs: Array<{
    id: string;
    type: 'text' | 'heading' | 'card';
    cardType?: 'ai_answer' | 'summary' | 'event' | 'clip';
    offsetTop: number;
    offsetHeight: number;
    signals: Signal[];
  }>;
  signals: Signal[];
  focusWindows?: FocusWindow[];
}
```

### 4.6 å…±é¸£ï¼ˆè·¨ç¬”è®°è¿æ¥ï¼‰

**FR-Resonance-1ï¼šæŸ¥è¯¢æœºåˆ¶**  
ç³»ç»Ÿ**å¿…é¡»**æ”¯æŒå…±é¸£æŸ¥è¯¢ï¼š
- è¾“å…¥ï¼šé€‰å®šæ–‡æœ¬/æ®µè½åµŒå…¥
- æœç´¢ï¼šè·¨æ‰€æœ‰ç¬”è®°ï¼ˆæ’é™¤å½“å‰ï¼‰çš„å‘é‡ç›¸ä¼¼åº¦
- é˜ˆå€¼ï¼šå¯é…ç½®ç›¸ä¼¼åº¦åˆ†æ•°ï¼ˆé»˜è®¤ 0.75ï¼‰
- è¾“å‡ºï¼šç›¸å…³æ®µè½çš„æ’åºåˆ—è¡¨ï¼Œå¸¦é¢„è§ˆç‰‡æ®µ

**FR-Resonance-2ï¼šå…±é¸£å¡ç‰‡**  
ç”¨æˆ·å¯ä»¥å°†å…±é¸£ç»“æœä¿å­˜ä¸ºå¡ç‰‡ï¼š
- å¡ç‰‡ç±»å‹ï¼š`resonance`
- å­˜å‚¨ï¼šæŸ¥è¯¢æº + åŒ¹é…ç»“æœ + ç›¸ä¼¼åº¦åˆ†æ•°
- åŒå‘é“¾æ¥ï¼šæºå’Œç›®æ ‡æ®µè½éƒ½è·å¾—åå‘é“¾æ¥

**FR-Resonance-3ï¼šå›é¡¾é›†æˆ**  
æ¯æ—¥/æ¯å‘¨å™äº‹**åº”è¯¥**åŒ…å«å…±é¸£ç« èŠ‚ï¼Œæ˜¾ç¤ºï¼š
- "ä»Šå¤©çš„æƒ³æ³•ä¸ [3 ä¸ªæœˆå‰çš„ç¬”è®° X] ç›¸å…³"
- é€šè¿‡é«˜äºé˜ˆå€¼çš„æœ€é«˜ç›¸ä¼¼åº¦åŒ¹é…è‡ªåŠ¨æ£€æµ‹

---

## 5. æŠ€æœ¯æ¶æ„

### 5.1 æ•°æ®æ¨¡å‹

#### EventLog Schemaï¼ˆä¸å¯å˜ï¼‰
```sql
CREATE TABLE event_log (
  event_id TEXT PRIMARY KEY,
  user_id TEXT NOT NULL,
  timestamp INTEGER NOT NULL,  -- Unix æ¯«ç§’
  event_type TEXT NOT NULL,    -- 'ASK_AI', 'HIGHLIGHT_ADDED' ç­‰
  note_id TEXT,
  paragraph_id TEXT,
  session_id TEXT,
  metadata JSON,               -- çµæ´»çš„äº‹ä»¶ç‰¹å®šæ•°æ®
  
  INDEX idx_timestamp (timestamp),
  INDEX idx_event_type (event_type),
  INDEX idx_user_date (user_id, date(timestamp/1000, 'unixepoch'))
);
```

#### Signals Schema

Signals çš„å­—æ®µå¥‘çº¦ä¸å­˜å‚¨ç»†èŠ‚ä»¥ SSOT ä¸ºå‡†ï¼š
- docs/architecture/EVENT_FIELD_CONTRACT_SSOT_ARCHITECTURE.mdï¼ˆÂ§0.4ï¼š`signals` / `signal_embeddings`ï¼‰
- docs/architecture/SIGNAL_ARCHITECTURE_PROPOSAL.mdï¼ˆSignal / AttentionSession é¢†åŸŸè¯­ä¹‰ä¸ç¤ºä¾‹ï¼‰

#### TakeawayCandidate Schema
```sql
CREATE TABLE takeaway_candidates (
  takeaway_id TEXT PRIMARY KEY,
  user_id TEXT NOT NULL,
  date TEXT NOT NULL,          -- YYYY-MM-DD
  source_type TEXT NOT NULL,   -- 'card', 'session', 'manual'
  source_id TEXT NOT NULL,
  created_at INTEGER NOT NULL,
  text TEXT NOT NULL,          -- æœ€å¤š 200 å­—ç¬¦
  topic TEXT,
  embedding BLOB,              -- åºåˆ—åŒ–çš„ Float32Array
  weight REAL NOT NULL,
  evidence_refs JSON NOT NULL, -- [{type, id}, ...]
  status TEXT DEFAULT 'active',
  
  INDEX idx_user_date (user_id, date),
  INDEX idx_weight (weight DESC)
);
```

#### Session Schemaï¼ˆéŸ³é¢‘/ä¼šè®®ï¼‰
```sql
CREATE TABLE sessions (
  session_id TEXT PRIMARY KEY,
  user_id TEXT NOT NULL,
  note_id TEXT,
  session_type TEXT,           -- 'meeting', 'voice_memo', 'study'
  started_at INTEGER NOT NULL,
  ended_at INTEGER,
  duration_ms INTEGER,
  audio_file_path TEXT,        -- æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿè·¯å¾„
  audio_remote_url TEXT,       -- R2/S3 URLï¼ˆå¯é€‰ï¼‰
  metadata JSON,
  
  INDEX idx_user_sessions (user_id, started_at)
);
```

#### Imageï¼ˆå¿«ç…§ï¼‰Schema
```sql
CREATE TABLE images (
  image_id TEXT PRIMARY KEY,   -- åŸºäºæ—¶é—´æˆ³ï¼šYYYYMMDDHHmmssSSS
  session_id TEXT NOT NULL,
  created_at_ms INTEGER NOT NULL,
  scene_id TEXT NOT NULL,
  hash_32x32 TEXT,
  similarity_to_prev REAL,
  sharpness REAL,
  density REAL,
  blob_uri TEXT NOT NULL,      -- IndexedDB æˆ–æ–‡ä»¶ç³»ç»Ÿå¼•ç”¨
  thumb_uri TEXT,
  ocr_text TEXT,
  ocr_confidence REAL,
  
  FOREIGN KEY (session_id) REFERENCES sessions(session_id),
  INDEX idx_session_images (session_id, created_at_ms)
);
```

### 5.2 æƒé‡è®¡ç®—å®ç°

```typescript
interface WeightConfig {
  manualHighlight: number;    // 10
  manualQuestion: number;     // 12
  manualAction: number;       // 15
  focusWindowMoment: number;  // 8
  multiCardSummary: number;   // 6
  cardExpand: number;         // æ¯æ¬¡å±•å¼€ 1ï¼Œæœ€å¤š 5
  referenceCount: number;     // æ¯æ¬¡å¼•ç”¨ 2
  recencyBoost: number;       // 2 å°æ—¶å†… 3
}

function calculateTakeawayWeight(
  candidate: TakeawayCandidate,
  config: WeightConfig,
  behaviorData?: {
    expandCount: number;
    refCount: number;
    ageMs: number;
  }
): number {
  let weight = 0;
  
  // æ‰‹åŠ¨ä¿¡å·ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰
  const signalType = candidate.metadata?.signalType;
  if (signalType === 'HIGHLIGHT') weight += config.manualHighlight;
  if (signalType === 'QUESTION') weight += config.manualQuestion;
  if (signalType === 'ACTION_ITEM') weight += config.manualAction;
  
  // ç³»ç»Ÿä¿¡å·
  if (candidate.source_type === 'session' && candidate.metadata?.isFocusWindow) {
    weight += config.focusWindowMoment;
  }
  if (candidate.source_type === 'card' && candidate.metadata?.isMultiCardSummary) {
    weight += config.multiCardSummary;
  }
  
  // è¡Œä¸ºä¿¡å·ï¼ˆå¯é€‰ï¼‰
  if (behaviorData) {
    weight += Math.min(behaviorData.expandCount * config.cardExpand, 5);
    weight += behaviorData.refCount * config.referenceCount;
    if (behaviorData.ageMs < 2 * 60 * 60 * 1000) { // <2h
      weight += config.recencyBoost;
    }
  }
  
  return weight;
}
```

### 5.3 Focus Window æ£€æµ‹

```typescript
interface Signal {
  timestamp: number; // Unix æ¯«ç§’
  type: 'HIGHLIGHT' | 'QUESTION' | 'ACTION_ITEM';
}

interface FocusWindow {
  startMs: number;
  endMs: number;
  signals: Signal[];
}

function detectFocusWindows(
  signals: Signal[],
  config: {
    preBuffer: number;  // 20000 (20ç§’)
    postBuffer: number; // 60000 (60ç§’)
    mergeThreshold: number; // 30000 (30ç§’)
    maxWindowDuration: number; // 300000 (5åˆ†é’Ÿ)
  }
): FocusWindow[] {
  const windows: FocusWindow[] = [];
  
  signals
    .filter(s => s.type === 'HIGHLIGHT') // ä¸»è¦å…³æ³¨é«˜äº®
    .sort((a, b) => a.timestamp - b.timestamp)
    .forEach((signal, idx) => {
      const start = signal.timestamp - config.preBuffer;
      const end = signal.timestamp + config.postBuffer;
      
      // å°è¯•ä¸æœ€åä¸€ä¸ªçª—å£åˆå¹¶
      const lastWindow = windows[windows.length - 1];
      if (lastWindow && start - lastWindow.endMs < config.mergeThreshold) {
        // åˆå¹¶å¹¶æ‰©å±•
        lastWindow.endMs = Math.min(end, lastWindow.startMs + config.maxWindowDuration);
        lastWindow.signals.push(signal);
      } else {
        // åˆ›å»ºæ–°çª—å£
        windows.push({
          startMs: start,
          endMs: Math.min(end, start + config.maxWindowDuration),
          signals: [signal]
        });
      }
    });
  
  return windows;
}
```

### 5.4 æ™ºèƒ½å¿«ç…§ç®—æ³•

```typescript
interface FrameMetadata {
  timestamp: number;
  hash: string;      // 32x32 æ„ŸçŸ¥å“ˆå¸Œ
  sharpness: number; // Laplacian æ–¹å·®
  density: number;   // è¾¹ç¼˜æ•° / ç†µ
}

class SnapshotManager {
  private candidateSlot: FrameMetadata | null = null;
  private lastSavedHash: string | null = null;
  
  processFrame(frame: ImageData, timestamp: number): boolean {
    const meta = this.analyzeFrame(frame, timestamp);
    
    // æ£€æµ‹åœºæ™¯å˜åŒ–
    const diffRatio = this.lastSavedHash 
      ? this.hammingDistance(meta.hash, this.lastSavedHash) / 1024
      : 1.0;
    
    if (diffRatio > 0.20) {
      // é‡å¤§åœºæ™¯å˜åŒ– â†’ ä¿å­˜å€™é€‰å¹¶å¼€å§‹æ–°æ§½
      this.saveCandidate();
      this.candidateSlot = meta;
      return true;
    } else if (diffRatio > 0.05) {
      // å°å˜åŒ– â†’ å¦‚æœæ›´æœ‰ä¿¡æ¯é‡åˆ™æ›´æ–°å€™é€‰
      if (!this.candidateSlot || this.isMoreInformative(meta, this.candidateSlot)) {
        this.candidateSlot = meta;
      }
      return false;
    }
    
    return false; // æ— æ˜¾è‘—å˜åŒ–
  }
  
  private isMoreInformative(newFrame: FrameMetadata, oldFrame: FrameMetadata): boolean {
    // åŠ æƒè¯„åˆ†ï¼šåå¥½æ›´æ¸…æ™° + æ›´å¯†é›†çš„å¸§
    const newScore = newFrame.sharpness * 0.6 + newFrame.density * 0.4;
    const oldScore = oldFrame.sharpness * 0.6 + oldFrame.density * 0.4;
    return newScore > oldScore * 1.1; // 10% é˜ˆå€¼é¿å…æŠ–åŠ¨
  }
  
  private analyzeFrame(frame: ImageData, timestamp: number): FrameMetadata {
    // å®ç°ï¼šè®¡ç®—æ„ŸçŸ¥å“ˆå¸Œã€Laplacian æ–¹å·®ã€è¾¹ç¼˜å¯†åº¦
    // å ä½è¿”å›
    return {
      timestamp,
      hash: 'computed_hash',
      sharpness: 120.5,
      density: 0.34
    };
  }
  
  private saveCandidate(): void {
    if (this.candidateSlot) {
      // æŒä¹…åŒ–åˆ° IndexedDB/æ–‡ä»¶ç³»ç»Ÿ
      this.lastSavedHash = this.candidateSlot.hash;
      // ... å­˜å‚¨é€»è¾‘
      this.candidateSlot = null;
    }
  }
  
  private hammingDistance(hash1: string, hash2: string): number {
    // è®¡ç®—ä¸åŒä½æ•°
    let distance = 0;
    for (let i = 0; i < hash1.length; i++) {
      if (hash1[i] !== hash2[i]) distance++;
    }
    return distance;
  }
}
```

---

## 6. å¤–éƒ¨é›†æˆä¸ä¾èµ–

### 6.1 RECNote éŸ³é¢‘æ¨¡å—

**ç”¨é€”**ï¼šä¸ºç‚¹å‡»æ’­æ”¾å¯¼èˆªæä¾›éŸ³é¢‘-ç¬”è®°æ—¶é—´æˆ³åŒæ­¥

**é›†æˆç‚¹**
1. **å½•éŸ³ API**ï¼š
   ```typescript
   interface RECNoteRecorder {
     startRecording(noteId: string): Promise<{ recordingId: string }>;
     stopRecording(): Promise<{ duration: number; filePath: string }>;
     getCurrentOffset(): number; // è‡ªå¼€å§‹ä»¥æ¥çš„æ¯«ç§’æ•°
   }
   ```

2. **å›æ”¾ API**ï¼š
   ```typescript
   interface RECNotePlayer {
     loadRecording(recordingId: string): Promise<void>;
     seekTo(offsetMs: number): void;
     play(): void;
     pause(): void;
   }
   ```

3. **é”šç‚¹å­˜å‚¨**ï¼šå¸¦éŸ³é¢‘é”šç‚¹çš„æ®µè½å­˜å‚¨ï¼š
   ```typescript
   meta: {
     audioAnchor: {
       recordingId: string;
       offsetMs: number;
     }
   }
   ```

**æŠ€æœ¯è§„æ ¼**ï¼ˆæ¥è‡ª RECNote PRDï¼‰
- éŸ³é¢‘æ ¼å¼ï¼š**16kHz å•å£°é“ Opus @ 24kbps** â†’ çº¦ 12MB/å°æ—¶
- æœ¬åœ°å¤„ç†ï¼šç©ºé—² CPU æ—¶é—´è¿è¡Œ Whisper è½¬å†™
- FTS ç´¢å¼•ï¼š`FTS5` + `sqlite-vss` ç”¨äºè¯­ä¹‰æœç´¢
- éšç§ï¼šæœ¬åœ°ä¼˜å…ˆå­˜å‚¨ï¼Œäº‘åŒæ­¥å¯é€‰

**èŒè´£åˆ’åˆ†**
- RECNote å¤„ç†ï¼šå½•éŸ³ã€ç¼–ç ã€å›æ”¾ã€è½¬å†™
- Eventlog å¤„ç†ï¼šé”šç‚¹å…ƒæ•°æ®ã€UI è§¦å‘ã€å›é¡¾é›†æˆ

### 6.2 æ™ºèƒ½å¿«ç…§æ¨¡å—

**ç”¨é€”**ï¼šæ— éœ€å®Œæ•´è§†é¢‘å½•åˆ¶å³å¯æ•è·ä¼šè®®/å±å¹•è¯æ®

**é›†æˆç‚¹**
1. **ä¼šè¯ç”Ÿå‘½å‘¨æœŸ**ï¼š
   ```typescript
   interface SnapshotSession {
     startCapture(config: CaptureConfig): Promise<{ sessionId: string }>;
     stopCapture(): Promise<{ imageCount: number; totalSize: number }>;
     onFrameCaptured: (imageId: string, timestamp: number) => void;
   }
   ```

2. **å›¾åƒæ£€ç´¢**ï¼š
   ```typescript
   interface SnapshotAPI {
     getImage(imageId: string): Promise<{ blob: Blob; ocr?: string }>;
     getSessionImages(sessionId: string): Promise<ImageRecord[]>;
     runOCR(imageId: string): Promise<{ text: string; confidence: number }>;
   }
   ```

3. **é«˜äº®ç»‘å®š**ï¼šç”¨æˆ·åœ¨ä¼šè¯æœŸé—´åˆ›å»º `HIGHLIGHT` Signal æ—¶ï¼š
   ```typescript
   // EventLog åˆ›å»ºå¸¦å½“å‰ä¸Šä¸‹æ–‡çš„ Signal
   const signal = {
     signal_id: uuid(),
     signal_type: 'HIGHLIGHT',
     created_at: Date.now(),
     image_id: await snapshotAPI.getCurrentImageId(), // æœ€æ–°æˆ–å¼ºåˆ¶æ•è·
     audio_offset_ms: recnoteRecorder.getCurrentOffset()
   };
   ```

**æŠ€æœ¯è§„æ ¼**ï¼ˆæ¥è‡ªå¿«ç…§ PRDï¼‰
- åœºæ™¯æ£€æµ‹ï¼š>20% å˜åŒ– â†’ æ–°åœºæ™¯ï¼Œ>5% â†’ å€™é€‰æ›´æ–°
- å€™é€‰æ§½ï¼šæ¯ä¸ªåœºæ™¯ä»…ä¿å­˜ä¿¡æ¯æœ€ä¸°å¯Œçš„å¸§
- è´¨é‡æŒ‡æ ‡ï¼šæ¸…æ™°åº¦ï¼ˆLaplacian æ–¹å·®ï¼‰+ å¯†åº¦ï¼ˆè¾¹ç¼˜æ•°ï¼‰
- å­˜å‚¨ï¼šIndexedDBï¼ˆwebï¼‰æˆ–æ–‡ä»¶ç³»ç»Ÿï¼ˆElectronï¼‰ï¼Œå‹ç¼© WebP/JPEG

**èŒè´£åˆ’åˆ†**
- å¿«ç…§æ¨¡å—å¤„ç†ï¼šå¸§æ•è·ã€åœºæ™¯æ£€æµ‹ã€OCR æ‰§è¡Œ
- Eventlog å¤„ç†ï¼šSignal åˆ°å›¾åƒç»‘å®šã€å›é¡¾ä¸­çš„å¼•ç”¨æ¸²æŸ“

---

## 7. å®æ–½è·¯çº¿å›¾

> **æ¶æ„å¯¹é½**ï¼šæ‰€æœ‰ Phase å¿…é¡»éµå¾ª [EVENT_FIELD_CONTRACT_SSOT_ARCHITECTURE.md Â§ 0.4](../architecture/EVENT_FIELD_CONTRACT_SSOT_ARCHITECTURE.md#04-signal-å­—æ®µå¥‘çº¦å®Œæ•´-schema) çš„ Signal å¥‘çº¦ã€‚

### å‰ç½®ä¾èµ–ï¼ˆå¿…é¡»å…ˆå®Œæˆï¼‰

**PD-1ï¼šSSOT æ›´æ–°**
- [ ] æ˜ç¡® dwell/attention timer ä¸ºæœ¬åœ°æ´¾ç”Ÿæ•°æ®ï¼ˆä¸çº³å…¥ Behavior(Timeblock)ï¼›ä¸æ–°å¢ Event çš„â€œåˆ†ç±»/å¯è§æ€§â€ç±»å­—æ®µï¼‰
- [ ] å®šä¹‰ facets + view configurationï¼ˆä½œä¸º Derived Indexï¼Œä¸å†™å› Eventï¼‰
- [ ] æ˜ç¡® Signal å­—æ®µå¥‘çº¦ï¼ˆå·²å®Œæˆ Â§ 0.4ï¼‰
- [ ] å®šä¹‰ Artifact / EvidenceLink å®ä½“è§„èŒƒ

**PD-2ï¼šæ•°æ®åº“ Schema**
- [ ] åˆ›å»º `signals` è¡¨ï¼ˆIndexedDB schema + ç´¢å¼•ï¼‰
- [ ] åˆ›å»º `artifacts` è¡¨
- [ ] åˆ›å»º `evidence_links` è¡¨
- [ ] åˆ›å»º `session_details` è¡¨ï¼ˆå¯é€‰ï¼ŒFocus Window ä¸“ç”¨ï¼‰

**PD-3ï¼šæœåŠ¡å±‚å®æ–½**
- [ ] å®ç° `SignalService`ï¼ˆCRUD + å»é‡ + çº§è”åˆ é™¤ï¼‰
- [ ] å®ç° `ArtifactService`ï¼ˆç‰ˆæœ¬ç®¡ç† + å¢é‡æ›´æ–°ï¼‰
- [ ] å®ç° `EvidenceLinkService`ï¼ˆè¯æ®é“¾ç®¡ç†ï¼‰

### MVP-1ï¼šSignal åŸºç¡€è®¾æ–½ï¼ˆPhase 1ï¼Œç¬¬ 1-3 å‘¨ï¼‰

**ç›®æ ‡**ï¼šå»ºç«‹ Signal ç‹¬ç«‹å­˜å‚¨ + æ‰‹åŠ¨æ ‡è®° UI

**å‰ç½®æ¡ä»¶**ï¼šPD-1, PD-2, PD-3 å®Œæˆ

**äº¤ä»˜ç‰©**
- [ ] `signals` è¡¨å®æ–½ï¼ˆIndexedDB + ç´¢å¼•ï¼š`[eventId+type]`, `[createdAt]`, `[status]`ï¼‰
- [ ] `SignalService` å®ç°ï¼š
  - [ ] `createSignal()` - å»é‡ + ç”Ÿæˆ signalId
  - [ ] `getSignalsByEvent()` - æŒ‰ eventId æŸ¥è¯¢
  - [ ] `deleteSignalsByEvent()` - çº§è”åˆ é™¤
  - [ ] ï¼ˆå¯é€‰ï¼‰`EventSignalIndexService.rebuild()` - å†™å…¥ `event_signal_index`ï¼ˆDerived Storeï¼Œå¯é‡å»ºï¼‰
- [ ] EventService é›†æˆï¼š
  - [ ] `deleteEvent()` è°ƒç”¨ `SignalService.deleteSignalsByEvent()`
- [ ] UI å±‚å®ç°ï¼š
  - [ ] å³é”®èœå•"æ ‡è®°ä¸ºé‡ç‚¹/ç–‘é—®/è¡ŒåŠ¨é¡¹"
  - [ ] Signal å›¾æ ‡æ˜¾ç¤ºï¼ˆâ­/â“/âœ…ï¼‰
- [ ] Holographic Map é›†æˆï¼š
  - [ ] æ ‘å½¢å¤§çº²æ˜¾ç¤º Signal è£…é¥°
  - [ ] æŒ‰ Signal ç±»å‹è¿‡æ»¤
- [ ] Canvas Minimap é›†æˆï¼š
  - [ ] Signal ä½ç½®å¯è§†åŒ–ï¼ˆåœ†ç‚¹ + é¢œè‰²ï¼‰
  - [ ] ç‚¹å‡»è·³è½¬

**æˆåŠŸæ ‡å‡†**
- æ‰€æœ‰ Signal å†™å…¥å¿…é¡»é€šè¿‡ `SignalService`ï¼ˆç¦æ­¢ç›´æ¥å†™ signals è¡¨ï¼‰
- æ‰‹åŠ¨æ ‡è®°çš„ Signal æ­£ç¡®æŒä¹…åŒ–å¹¶åœ¨ UI æ˜¾ç¤º
- Event åˆ é™¤æ—¶è‡ªåŠ¨çº§è”åˆ é™¤å…³è” Signal
- Holographic Map å’Œ Minimap å®æ—¶æ›´æ–°ï¼ˆé˜²æŠ– 500msï¼‰

### MVP-2ï¼šè¡Œä¸ºæ•°æ®æ•è·ï¼ˆPhase 2ï¼Œç¬¬ 4-6 å‘¨ï¼‰

**ç›®æ ‡**ï¼šè‡ªåŠ¨æ•è·ç”¨æˆ·è¡Œä¸º + ç”Ÿæˆè¡Œä¸º Signal

**äº¤ä»˜ç‰©**
- [ ] `BehaviorTracker` å®ç°ï¼š
  - [ ] åœç•™æ—¶é•¿è¿½è¸ªï¼ˆæ´»è·ƒæ—¶é—´è®¡ç®—ï¼Œæ’é™¤æŒ‚æœºï¼‰
  - [ ] å¤åˆ¶/ç¼–è¾‘/æé—®è¡Œä¸ºæ•è·
  - [ ] æ‰¹é‡èšåˆåˆ° `Signal.behaviorMeta`
- [ ] è‡ªåŠ¨ Signal ç”Ÿæˆï¼š
  - [ ] `user_copy` - å¤åˆ¶å†…å®¹æ—¶åˆ›å»º
  - [ ] `user_edit` - ç¼–è¾‘è¶…è¿‡ N æ¬¡æ—¶åˆ›å»º
  - [ ] `user_question` - æé—® AI æ—¶åˆ›å»º
- [ ] `behaviorMeta` å­˜å‚¨ï¼š
  - [ ] `selectedText` - é€‰ä¸­çš„æ–‡å­—
  - [ ] `nodeSummary` - Node summary as chunk
  - [ ] `articleSummary` - Article summary
  - [ ] `actionCount` / `totalDwellTime` - èšåˆç»Ÿè®¡

**æˆåŠŸæ ‡å‡†**
- ç”¨æˆ·å¤åˆ¶/ç¼–è¾‘/æé—®æ—¶è‡ªåŠ¨åˆ›å»ºå¯¹åº” Signal
- `behaviorMeta` åªå­˜èšåˆæ•°æ® + å¿…éœ€æ–‡æœ¬ï¼ˆä¸å­˜åŸå§‹äº‹ä»¶æµï¼‰
- æ´»è·ƒæ—¶é—´è®¡ç®—å‡†ç¡®ï¼ˆ5 åˆ†é’Ÿæ— äº¤äº’åœæ­¢è®¡æ—¶ï¼‰

### MVP-3ï¼šSession Brief ç”Ÿæˆï¼ˆPhase 1 æ ¸å¿ƒåŠŸèƒ½ï¼Œç¬¬ 7-10 å‘¨ï¼‰

**ç›®æ ‡**ï¼šSession ç»“æŸæ—¶è‡ªåŠ¨ç”Ÿæˆ Granola é£æ ¼ Brief

**å‰ç½®æ¡ä»¶**ï¼šMVP-1 å®Œæˆï¼ŒAttentionSessionï¼ˆæœ¬åœ°ï¼‰å¯ç”¨

**äº¤ä»˜ç‰©**
 - [ ] dwell/attention â†’ AttentionSession æµç¨‹ï¼š
  - [ ] Start tracking åˆ›å»º attentionSessionï¼ˆæœ¬åœ°ï¼Œç»‘å®š eventIdï¼‰
  - [ ] Stop tracking è§¦å‘ Session Brief ç”Ÿæˆ
  - [ ] SessionBrief é€šè¿‡æ—¶é—´çª—èšåˆ EventLog/Signals/Transcriptï¼ˆä¸ä¾èµ– Behavior/Timeblock å…³è”å­—æ®µï¼‰
- [ ] `SessionBriefService` å®ç°ï¼š
  - [ ] `buildSessionContextBlocks()` - æ„å»ºä¸Šä¸‹æ–‡
  - [ ] `extractClaims()` - AI æŠ½å–å€™é€‰
  - [ ] `synthesizeClaims()` - å»é‡å½’å¹¶
  - [ ] `generateSessionBrief()` - ç”Ÿæˆæœ€ç»ˆ Artifact
- [ ] Artifact å­˜å‚¨ï¼š
  - [ ] å›ºå®š schemaï¼š`tldr / key_points / decisions / action_items / open_questions`
  - [ ] `status='draft'` åˆå§‹çŠ¶æ€
- [ ] EvidenceLink åˆ›å»ºï¼š
  - [ ] æ¯æ¡ claim å…³è” 1-3 ä¸ª sourceRef
  - [ ] æ”¯æŒå›è·³åˆ° timestampNode / transcript chunk / signal
- [ ] UI å®ç°ï¼š
  - [ ] Session Brief å±•ç¤ºé¢æ¿
  - [ ] è¯æ®é“¾æ¥å¯ç‚¹å‡»å›è·³
  - [ ] ç¼–è¾‘ Briefï¼ˆstatus å˜ä¸º 'edited'ï¼‰

**æˆåŠŸæ ‡å‡†**
- Session ç»“æŸåè‡ªåŠ¨ç”Ÿæˆ Briefï¼ˆ<30 ç§’ï¼‰
- Brief åŒ…å«ç»“æ„åŒ–å†…å®¹ï¼ˆå›ºå®š schemaï¼‰
- æ¯æ¡ç»“è®ºè‡³å°‘ 1 æ¡ EvidenceLink
- ç”¨æˆ·å¯ç‚¹å‡»è¯æ®å›è·³åˆ°åŸæ–‡

### MVP-4ï¼šDaily Narrative ç”Ÿæˆï¼ˆPhase 1 æ ¸å¿ƒåŠŸèƒ½ï¼Œç¬¬ 11-14 å‘¨ï¼‰

**ç›®æ ‡**ï¼šæ¯æ—¥è‡ªåŠ¨ç”Ÿæˆç¬¬ä¸€äººç§°å™äº‹æ—¥è®°

**å‰ç½®æ¡ä»¶**ï¼šMVP-2, MVP-3 å®Œæˆ

**äº¤ä»˜ç‰©**
- [ ] é‡è¦æ€§è¯„åˆ†ç®—æ³•å®æ–½ï¼ˆè§ Â§ 3.A.1ï¼‰ï¼š
  - [ ] `calculateImportance()` - å¤šç»´åº¦è¯„åˆ†
  - [ ] `filterImportantEvents()` - åˆ†å±‚è¿‡æ»¤
  - [ ] `ensureDiversity()` - å¤šæ ·æ€§çº¦æŸ
- [ ] `DailyNarrativeService` å®ç°ï¼š
  - [ ] `collectDailyEvidence()` - æ”¶é›†å½“å¤©è¯æ®
  - [ ] `generateNarrativeText()` - è°ƒç”¨ AI ç”Ÿæˆå™äº‹
  - [ ] `createDailyArtifact()` - åˆ›å»º Artifactï¼ˆscope='daily'ï¼‰
- [ ] Prompt æ¨¡æ¿å®æ–½ï¼ˆç¬¬ä¸€äººç§° + æƒ…æ„Ÿè¡¨è¾¾ï¼‰
- [ ] UI å®ç°ï¼š
  - [ ] Daily Narrative é¢æ¿ï¼ˆè§ Â§ 3.2.2ï¼‰
  - [ ] å¯ç¼–è¾‘ + é‡æ–°ç”Ÿæˆ
  - [ ] å½’æ¡£å¹¶æ ‡è®°å®Œæˆ

**æˆåŠŸæ ‡å‡†**
- æ¯æ—¥ 9 ç‚¹è‡ªåŠ¨ç”Ÿæˆæˆ–æ‰‹åŠ¨è§¦å‘
- ç”Ÿæˆå†…å®¹ç¬¦åˆ"ç¬¬ä¸€äººç§° + è‡ªç„¶æµç•…"è¦æ±‚
- ç”¨æˆ·å¯ç¼–è¾‘å¹¶ä¿å­˜ä¿®æ”¹ï¼ˆstatus='edited'ï¼‰
- å…¸å‹ä¸€å¤©ç”Ÿæˆæ—¶é—´ <30 ç§’

### MVP-5ï¼šéŸ³é¢‘åŒæ­¥ï¼ˆç¬¬ 15-17 å‘¨ï¼‰

**ç›®æ ‡**ï¼šé›†æˆ RECNote è¿›è¡ŒéŸ³é¢‘-ç¬”è®°é”šå®š

**äº¤ä»˜ç‰©**
- [ ] RECNote å½•éŸ³é›†æˆï¼ˆç¬”è®° UI ä¸­çš„å¼€å§‹/åœæ­¢ï¼‰
- [ ] æ®µè½ä¸­çš„ `audioAnchor` å…ƒæ•°æ®å­˜å‚¨
- [ ] ç‚¹å‡»æ’­æ”¾ï¼šæ®µè½ â†’ éŸ³é¢‘å®šä½åˆ°åç§»
- [ ] æœ¬åœ° Whisper è½¬å†™ï¼ˆåå°ä»»åŠ¡ï¼‰

**æˆåŠŸæ ‡å‡†**
- éŸ³é¢‘ä»¥ <12MB/å°æ—¶å½•åˆ¶ï¼ˆOpus 24kbpsï¼‰
- å‡†ç¡®çš„åç§»æ•è·ï¼ˆÂ±1 ç§’ï¼‰
- æµç•…çš„å›æ”¾å®šä½
- è½¬å†™åœ¨ç©ºé—² CPU ä¸Šä»¥ 2 å€å®æ—¶é€Ÿåº¦å®Œæˆ

### MVP-6ï¼šä¼šè®®å¿«ç…§ + Focus Windowï¼ˆç¬¬ 18-21 å‘¨ï¼‰

**ç›®æ ‡**ï¼šä¼šè®®è¯æ®çš„æ™ºèƒ½å¸§æ•è· + Focus Window é«˜äº®

**äº¤ä»˜ç‰©**
- [ ] å±å¹•æ•è·ä¼šè¯ç®¡ç†
- [ ] åœºæ™¯æ£€æµ‹ + å€™é€‰æ§½ç®—æ³•
- [ ] Signal åˆ°å›¾åƒç»‘å®šï¼ˆé«˜äº® â†’ å½“å‰æˆªå›¾ï¼‰
- [ ] OCR å¤„ç†ï¼ˆèŠ‚æµï¼‰
- [ ] å¸¦ `[ref: image ...]` çš„ä¼šè®®è¦ç‚¹ç¬”è®°ç”Ÿæˆ
- [ ] Canvas Minimap é›†æˆ Focus Window é«˜äº®æ˜¾ç¤º

**æˆåŠŸæ ‡å‡†**
- 1 å°æ—¶ä¼šè®® â†’ 30-80 å¼ æˆªå›¾ï¼ˆä¸æ˜¯æ•°åƒå¼ ï¼‰
- å…³é”®æ—¶åˆ»é“¾æ¥åˆ°æ­£ç¡®å›¾åƒ
- OCR æ–‡æœ¬å¯æœç´¢
- ç”¨æˆ·å¯ç‚¹å‡»å¼•ç”¨ â†’ æŸ¥çœ‹å›¾åƒ + åœ¨æ—¶é—´æˆ³æ’­æ”¾éŸ³é¢‘
- Minimap å®æ—¶æ˜¾ç¤º Focus Window é‡‘è‰²é«˜äº®åŒºåŸŸ

### MVP åï¼šé«˜çº§åŠŸèƒ½

**ç¬¬ 2 é˜¶æ®µï¼ˆç¬¬ 6-9 ä¸ªæœˆï¼‰**
- [ ] æ¯å‘¨/æ¯æœˆå¤åˆ©å¼å›é¡¾
- [ ] å…±é¸£æŸ¥è¯¢ + å¡ç‰‡ç”Ÿæˆ
- [ ] å…æ Signal åˆ›å»ºçš„è¯­éŸ³æç¤ºè¯æ£€æµ‹
- [ ] åŸºäºè¡Œä¸ºçš„æƒé‡ç»„ä»¶ï¼ˆå±•å¼€æ¬¡æ•°ã€å¼•ç”¨æ¬¡æ•°ï¼‰
- [ ] Canvas Minimap é«˜çº§åŠŸèƒ½ï¼š
  - [ ] Takeaway å¯†åº¦çƒ­åŠ›å›¾
  - [ ] Hover æ—¶æ˜¾ç¤ºæ®µè½æ–‡å­—é¢„è§ˆ
  - [ ] æ‹–åŠ¨è§†çª—æ»‘å—è¿ç»­æ»šåŠ¨
  - [ ] è¯æ®é“¾æ¥å¯è§†åŒ–ï¼ˆè™šçº¿è¿æ¥å¼•ç”¨å…³ç³»ï¼‰
- [ ] å¸¦äº‘å¤„ç†çš„ç§»åŠ¨åº”ç”¨ï¼ˆPro ç”¨æˆ·ï¼‰

**ç¬¬ 3 é˜¶æ®µï¼ˆç¬¬ 10-12 ä¸ªæœˆï¼‰**
- [ ] æ—¥å†é›†æˆï¼ˆå¯¼å…¥äº‹ä»¶ä½œä¸ºæ—¶é—´çº¿è¯æ®ï¼‰
- [ ] ä»»åŠ¡ç®¡ç†å™¨å¯¼å‡ºï¼ˆè¡ŒåŠ¨é¡¹ â†’ Todoist ç­‰ï¼‰
- [ ] åä½œä¼šè¯å…±äº«ï¼ˆéšç§å—æ§ï¼‰
- [ ] é«˜çº§åˆ†æï¼ˆä¸»é¢˜è¶‹åŠ¿ã€ç”Ÿäº§åŠ›æ´å¯Ÿï¼‰

---

## 8. æˆåŠŸæŒ‡æ ‡

### ç”¨æˆ·å‚ä¸åº¦
- **ä½¿ç”¨å›é¡¾çš„æ—¥æ´»ç”¨æˆ·**ï¼šæ¯å‘¨ç”Ÿæˆ â‰¥1 æ¬¡æ¯æ—¥å™äº‹çš„ç”¨æˆ·ç™¾åˆ†æ¯”
- **å¹³å‡å›é¡¾æ—¶é—´**ï¼šç›®æ ‡ <3 åˆ†é’Ÿé˜…è¯»æ¯æ—¥å™äº‹
- **æ”¶è·ä¿ç•™ç‡**ï¼šæ ‡è®°ä¸ºæœ‰ä»·å€¼çš„ takeaway ç™¾åˆ†æ¯”ï¼ˆç‚¹èµ/å½’æ¡£ vs. åˆ é™¤ï¼‰

### æŠ€æœ¯æ€§èƒ½
- **EventLog å†™å…¥å»¶è¿Ÿ**ï¼šp95 <50ms
- **æ¯æ—¥å™äº‹ç”Ÿæˆæ—¶é—´**ï¼šå…¸å‹ä¸€å¤© p95 <30 ç§’
- **éŸ³é¢‘å¤„ç†**ï¼šWhisper è½¬å†™ä»¥ 2 å€å®æ—¶é€Ÿåº¦å®Œæˆ
- **å¿«ç…§æ•ˆç‡**ï¼šä¼šè®®ä¼šè¯ç”Ÿæˆçš„å¸§æ•° <1fps å…¨å½•åˆ¶çš„ 10%

### è´¨é‡æŒ‡æ ‡
- **æ”¶è·ç›¸å…³æ€§**ï¼šç”¨æˆ·åé¦ˆåˆ†æ•°ï¼ˆ1-5 åˆ†ï¼‰å¹³å‡ >3.5
- **Signal ç²¾ç¡®åº¦**ï¼šæ‰‹åŠ¨æ ‡è®°çš„é«˜äº®å‡ºç°åœ¨æ ¸å¿ƒæ”¶è·ä¸­çš„ç™¾åˆ†æ¯” >80%
- **OCR å‡†ç¡®æ€§**ï¼šä¿å­˜æˆªå›¾çš„å¹³å‡ç½®ä¿¡åº¦åˆ†æ•° >70%

---

## 9. éšç§ä¸å®‰å…¨è€ƒè™‘

### æ•°æ®é©»ç•™
- **é»˜è®¤æœ¬åœ°ä¼˜å…ˆ**ï¼šéŸ³é¢‘æ–‡ä»¶å’Œæˆªå›¾å­˜å‚¨åœ¨è®¾å¤‡ä¸Š
- **äº‘åŒæ­¥å¯é€‰**ï¼šç”¨æˆ·æ˜ç¡®å¯ç”¨äº‘å¤‡ä»½ï¼Œå¹¶æ¸…æ¥šæŠ«éœ²æ•°æ®æ”¿ç­–
- **åŠ å¯†**ï¼šæ‰€æœ‰äº‘åŒæ­¥åª’ä½“é™æ€åŠ å¯†ï¼ˆAES-256ï¼‰

### ç”¨æˆ·æ§åˆ¶
- **ç»†ç²’åº¦åˆ é™¤**ï¼šç”¨æˆ·å¯åˆ é™¤å•ä¸ªäº‹ä»¶ã€ä¼šè¯ã€å›¾åƒ
- **ä¼šè¯éšç§æ¨¡å¼**ï¼šé€‰é¡¹"ç¦»çº¿è®°å½•"ï¼ˆæ— äº‘åŒæ­¥ï¼ŒN å¤©åè‡ªåŠ¨åˆ é™¤ï¼‰
- **è¯æ®ç¼–è¾‘**ï¼šèƒ½å¤Ÿäº‹åæ¨¡ç³Š/åˆ é™¤ç‰¹å®šæˆªå›¾

### åˆè§„æ€§
- **GDPR**ï¼šè®¿é—®ã€å¯¼å‡ºã€åˆ é™¤æ‰€æœ‰ä¸ªäººæ•°æ®çš„æƒåˆ©
- **æ•°æ®å¯¼å‡º**ï¼šå®Œæ•´è¯æ®å­˜æ¡£å¯å¯¼å‡ºä¸º JSON + åª’ä½“æ–‡ä»¶
- **é€æ˜åº¦**ï¼šå½•éŸ³/å±å¹•æ—¶ UI ä¸­æ¸…æ¥šæŠ«éœ²

---

## 10. å¾…è§£å†³é—®é¢˜ä¸æœªæ¥æ¢ç´¢

### æŠ€æœ¯å€ºåŠ¡é¡¹
- **åµŒå…¥æ¨¡å‹é€‰æ‹©**ï¼šç”¨äº takeaway èšç±»çš„æ¨¡å‹ï¼Ÿï¼ˆsentence-transformers vs. OpenAIï¼‰
- **OCR åº“**ï¼šTesseract.jsï¼ˆæœ¬åœ°ï¼‰vs. äº‘ OCRï¼ˆGoogle Visionï¼‰ï¼Ÿå»¶è¿Ÿ vs. æˆæœ¬æƒè¡¡
- **ç§»åŠ¨éŸ³é¢‘å¤„ç†**ï¼šèƒ½å¦åœ¨è®¾å¤‡ä¸Šè¿è¡Œè½»é‡çº§ Whisperï¼Œè¿˜æ˜¯æ€»æ˜¯æ¨è¿Ÿåˆ°æ¡Œé¢ï¼Ÿ

### è®¾è®¡æ­§ä¹‰
- **å…±é¸£é˜ˆå€¼è°ƒä¼˜**ï¼šä»€ä¹ˆç›¸ä¼¼åº¦åˆ†æ•°æœ€æœ‰æ•ˆï¼Ÿç”¨æˆ·å¯è°ƒè¿˜æ˜¯è‡ªåŠ¨æ ¡å‡†ï¼Ÿ
- **Focus Window åˆå¹¶**ï¼šå¦‚ä½•å¤„ç†å¿«é€Ÿè¿ç»­çš„ 3+ ä¸ªé«˜äº®ï¼Ÿå½“å‰é€»è¾‘å¯èƒ½è¿‡åº¦åˆå¹¶
- **æ”¶è·å»é‡**ï¼šå¦‚ä½•æ£€æµ‹è·¨å¤©çš„è¿‘é‡å¤ takeawayï¼ŸåµŒå…¥ç›¸ä¼¼åº¦ + æ–‡æœ¬æ¨¡ç³ŠåŒ¹é…ï¼Ÿ

### äº§å“ç­–ç•¥
- **è´§å¸åŒ–**ï¼šå…è´¹å±‚ï¼ˆä»…æœ¬åœ°ï¼‰vs. Proï¼ˆäº‘ + å³æ—¶å¤„ç†ï¼‰ï¼Ÿå­˜å‚¨é™åˆ¶ï¼Ÿ
- **åä½œ**ï¼šä¼šè¯åº”å¯å…±äº«å—ï¼Ÿä¼šè®®å½•éŸ³çš„éšç§å½±å“
- **ç¬¬ä¸‰æ–¹é›†æˆ**ï¼šä¼˜å…ˆè€ƒè™‘å“ªäº›æ—¥å†/ä»»åŠ¡ç®¡ç†å™¨ï¼ŸAPI è®¾è®¡ï¼Ÿ

---

## 11. é™„å½•ï¼šå…³é”®æœ¯è¯­å¿«é€Ÿå‚è€ƒ

| æœ¯è¯­ | å®šä¹‰ | å­˜å‚¨ |
|------|------|------|
| **EventLog** | ä¸å¯å˜äº¤äº’æ—¥å¿— | `event_log` è¡¨ |
| **Signal** | ç”¨æˆ·å‘èµ·çš„é‡è¦æ€§æ ‡è®° | `signals` è¡¨ |
| **Session** | è¿ç»­å½•åˆ¶æ—¶æ®µ | `sessions` è¡¨ |
| **TakeawayCandidate** | ç”¨äºæ¯æ—¥èšåˆçš„å¾®è§‚ç»“è®º | `takeaway_candidates` è¡¨ |
| **Focus Window** | Signal å‘¨å›´çš„é«˜ä¼˜å…ˆçº§æ—¶é—´èŒƒå›´ | æŒ‰éœ€è®¡ç®— |
| **Holographic Map** | è‡ªåŠ¨ç”Ÿæˆçš„å¯è¿‡æ»¤å¤§çº² | ä»ç¬”è®°ç»“æ„ç”Ÿæˆ |
| **Daily Narrative** | ç»“æ„åŒ–æ¯æ—¥å›é¡¾è¾“å‡º | ç”Ÿæˆçš„æ–‡æ¡£ï¼Œå¯é€‰ä¿å­˜ |
| **Resonance** | è·¨ç¬”è®°è¯­ä¹‰è¿æ¥ | `resonance_queries` + å¡ç‰‡ç±»å‹ |
| **RECNote** | éŸ³é¢‘-ç¬”è®°æ—¶é—´æˆ³åŒæ­¥æ¨¡å— | ç‹¬ç«‹æ¨¡å—ï¼Œé€šè¿‡ API é›†æˆ |
| **Intelligent Snapshot** | æ™ºèƒ½ä¼šè®®æˆªå›¾æ•è· | ç‹¬ç«‹æ¨¡å—ï¼Œé€šè¿‡ API é›†æˆ |

---

**æ–‡æ¡£çŠ¶æ€**ï¼šå‡†å¤‡å®æ–½ã€‚æ‰€æœ‰æ ¸å¿ƒéœ€æ±‚å·²æŒ‡å®šï¼Œè¶³å¤Ÿè¯¦ç»†ä»¥ä¾›å¼€å‘ã€‚å¾…è§£å†³é—®é¢˜å·²æ ‡è®°ï¼Œå¾…å†²åˆºè§„åˆ’æ—¶è§£å†³ã€‚

**ä¸‹ä¸€æ­¥**ï¼š 
1. ä¸å·¥ç¨‹å›¢é˜Ÿè¿›è¡ŒæŠ€æœ¯å®¡æŸ¥
2. æ•²å®š MVP-1 å†²åˆºå¾…åŠäº‹é¡¹
3. å»ºç«‹ EventLog åŸºç¡€è®¾æ–½å’Œæµ‹è¯•æ¡†æ¶
4. å¼€å§‹å…¨æ¯ç›®å½• UI å®æ–½
