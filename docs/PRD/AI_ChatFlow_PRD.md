# AI ChatFlow PRD - å†…è” AI å¯¹è¯æµ

## ğŸ“‹ äº§å“æ¦‚è¿°

### æ„¿æ™¯
åœ¨ EventLog ç¬”è®°ä¸­é€šè¿‡ `@ai` è§¦å‘ AI å¯¹è¯ï¼Œæé—®å’Œå›ç­”è‡ªåŠ¨ä¿å­˜ä¸º Toggle èŠ‚ç‚¹ï¼Œæ”¯æŒå¤šæ¨¡å‹åˆ‡æ¢ï¼Œæ— ç¼èå…¥ç”¨æˆ·çš„ç¬”è®°å·¥ä½œæµã€‚

### æ ¸å¿ƒä»·å€¼
- ğŸš€ **é›¶åˆ‡æ¢æˆæœ¬**ï¼šæ— éœ€ç¦»å¼€ç¬”è®°ï¼Œç›´æ¥å¯¹è¯ AI
- ğŸ’¾ **è‡ªåŠ¨å½’æ¡£**ï¼šå¯¹è¯å†å²è‡ªåŠ¨ä¿å­˜ï¼Œå¯æŠ˜å æŸ¥çœ‹
- ğŸ¯ **ä¸Šä¸‹æ–‡æ„ŸçŸ¥**ï¼šç†è§£å½“å‰äº‹ä»¶å’Œç¬”è®°å†…å®¹
- ğŸ”€ **å¤šæ¨¡å‹æ”¯æŒ**ï¼šGPT-4ã€Claudeã€Gemini ç­‰è‡ªç”±åˆ‡æ¢
- ğŸ“ **ç¬”è®°åŸç”Ÿ**ï¼šAI å›ç­”å¯ç¼–è¾‘ã€å¯å¼•ç”¨ã€å¯æœç´¢

---

## ğŸ¯ ç›®æ ‡ç”¨æˆ· & ä½¿ç”¨åœºæ™¯

### ç›®æ ‡ç”¨æˆ·
1. **çŸ¥è¯†å·¥ä½œè€…**ï¼šéœ€è¦å¿«é€ŸæŸ¥è¯¢èµ„æ–™ã€æ€»ç»“å†…å®¹
2. **é¡¹ç›®ç®¡ç†è€…**ï¼šéœ€è¦ AI è¾…åŠ©è§„åˆ’ä»»åŠ¡ã€åˆ†ææ•°æ®
3. **å­¦ä¹ è€…**ï¼šéœ€è¦ AI è§£é‡Šæ¦‚å¿µã€æ•´ç†ç¬”è®°
4. **åˆ›ä½œè€…**ï¼šéœ€è¦ AI å¤´è„‘é£æš´ã€æ¶¦è‰²æ–‡æ¡ˆ

### æ ¸å¿ƒåœºæ™¯

#### åœºæ™¯ 1ï¼šç¬”è®°ä¸­å¿«é€Ÿæé—®
```
ç”¨æˆ·åœ¨è®°å½•ä¼šè®®ç¬”è®°æ—¶ï¼š
1. è¾“å…¥ "@ai å¸®æˆ‘æ€»ç»“ä¸Šé¢çš„è®¨è®ºè¦ç‚¹"
2. AI è‡ªåŠ¨è¯»å–ä¸Šæ–‡ï¼Œç”Ÿæˆæ‘˜è¦
3. å›ç­”ä¿å­˜ä¸º Toggle èŠ‚ç‚¹ï¼Œå¯æŠ˜å 
```

#### åœºæ™¯ 2ï¼šå¤šè½®å¯¹è¯æ·±å…¥æ¢è®¨
```
ç”¨æˆ·åœ¨å­¦ä¹ æ–°æ¦‚å¿µæ—¶ï¼š
1. "@ai ä»€ä¹ˆæ˜¯ LangGraphï¼Ÿ"
2. AI å›ç­”åŸºç¡€æ¦‚å¿µ
3. ç»§ç»­è¿½é—®ï¼š"ç»™æˆ‘ä¸€ä¸ªå®é™…ä¾‹å­"
4. AI æä¾›ä»£ç ç¤ºä¾‹
5. æ‰€æœ‰ Q&A æŠ˜å åœ¨ä¸€ä¸ª Thread é‡Œ
```

#### åœºæ™¯ 3ï¼šåˆ‡æ¢æ¨¡å‹è·å¾—ä¸åŒè§†è§’
```
ç”¨æˆ·éœ€è¦å¯¹æ¯”ä¸åŒ AI çš„è§‚ç‚¹ï¼š
1. "@ai:gpt4 å¦‚ä½•è®¾è®¡è¿™ä¸ªç³»ç»Ÿï¼Ÿ"
2. GPT-4 ç»™å‡ºå»ºè®®
3. "@ai:claude åŒæ ·çš„é—®é¢˜"
4. Claude ç»™å‡ºä¸åŒæ–¹æ¡ˆ
5. ç”¨æˆ·å¯¹æ¯”é€‰æ‹©æœ€ä½³æ–¹æ¡ˆ
```

#### åœºæ™¯ 4ï¼šåŸºäºä¸Šä¸‹æ–‡çš„æ™ºèƒ½åŠ©æ‰‹
```
ç”¨æˆ·åœ¨æ´»åŠ¨ç­–åˆ’ç¬”è®°ä¸­ï¼š
1. "@ai åŸºäºè¿™ä¸ªæ´»åŠ¨ï¼Œå¸®æˆ‘ç”ŸæˆæŠ¥åè¡¨é—®é¢˜"
2. AI è¯»å–æ´»åŠ¨ä¿¡æ¯ï¼ˆæ—¶é—´ã€åœ°ç‚¹ã€ç±»å‹ï¼‰
3. ç”Ÿæˆä¸ªæ€§åŒ–çš„æŠ¥åè¡¨
```

---

## ğŸ—ï¸ åŠŸèƒ½è®¾è®¡

### 1. è§¦å‘æœºåˆ¶

#### 1.1 è§¦å‘æ–¹å¼
- **ä¸»è§¦å‘å™¨**ï¼š`@ai` æˆ– `@AI`
- **æ¨¡å‹æŒ‡å®š**ï¼š`@ai:gpt4`, `@ai:claude`, `@ai:gemini`
- **å¿«æ·å‘½ä»¤**ï¼š
  - `@ai.sum` - æ€»ç»“ä¸Šæ–‡
  - `@ai.explain` - è§£é‡Šé€‰ä¸­å†…å®¹
  - `@ai.translate` - ç¿»è¯‘
  - `@ai.fix` - ä¿®æ­£è¯­æ³•
  - `@ai.expand` - æ‰©å±•å†…å®¹

#### 1.2 äº¤äº’æµç¨‹
```
ç”¨æˆ·è¾“å…¥ "@ai" â†’ UnifiedMentionMenu å¼¹å‡º
    â†“
é€‰æ‹©æ¨¡å‹ï¼ˆå¯é€‰ï¼‰â†’ è¾“å…¥é—®é¢˜
    â†“
æŒ‰ Enter å‘é€ â†’ æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
    â†“
æµå¼å“åº”æ˜¾ç¤º â†’ è‡ªåŠ¨ä¿å­˜ä¸º Toggle èŠ‚ç‚¹
```

### 2. Toggle èŠ‚ç‚¹è®¾è®¡

#### 2.1 èŠ‚ç‚¹ç»“æ„
```typescript
interface AIChatToggle extends ParagraphNode {
  type: 'ai-chat-toggle';
  collapsed: boolean;  // æ˜¯å¦æŠ˜å 
  threadId: string;    // å¯¹è¯çº¿ç¨‹ ID
  children: [
    {
      type: 'ai-question';
      question: string;
      timestamp: string;
      user: string;
    },
    {
      type: 'ai-answer';
      answer: string;
      model: 'gpt4' | 'claude' | 'gemini' | 'hunyuan';
      timestamp: string;
      tokens: { prompt: number; completion: number };
      followUp?: string[];  // å»ºè®®çš„åç»­é—®é¢˜
    }
  ];
}
```

#### 2.2 è§†è§‰è®¾è®¡
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¤– AI å¯¹è¯ Â· GPT-4 Â· 2åˆ†é’Ÿå‰      [â–¼]  â”‚  â† æŠ˜å æ ‡é¢˜æ 
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ‘¤ ä½ : å¸®æˆ‘æ€»ç»“ä¸Šé¢çš„ä¼šè®®è®¨è®ºè¦ç‚¹      â”‚  â† é—®é¢˜ï¼ˆç”¨æˆ·å¤´åƒï¼‰
â”‚                                         â”‚
â”‚ ğŸ¤– GPT-4:                               â”‚  â† å›ç­”ï¼ˆæ¨¡å‹å›¾æ ‡ï¼‰
â”‚ æ ¹æ®ä¸Šæ–‡ï¼Œä¼šè®®çš„æ ¸å¿ƒè®¨è®ºè¦ç‚¹åŒ…æ‹¬ï¼š     â”‚
â”‚ 1. é¡¹ç›®è¿›åº¦æ›´æ–°                         â”‚
â”‚ 2. èµ„æºåˆ†é…é—®é¢˜                         â”‚
â”‚ 3. ä¸‹å‘¨é‡Œç¨‹ç¢‘                           â”‚
â”‚                                         â”‚
â”‚ ğŸ’¡ ä½ å¯èƒ½è¿˜æƒ³é—®:                        â”‚  â† å»ºè®®çš„åç»­é—®é¢˜
â”‚   â€¢ å¦‚ä½•ä¼˜åŒ–èµ„æºåˆ†é…ï¼Ÿ                  â”‚
â”‚   â€¢ ä¸‹å‘¨é‡Œç¨‹ç¢‘çš„å…·ä½“ä»»åŠ¡æ˜¯ä»€ä¹ˆï¼Ÿ        â”‚
â”‚                                         â”‚
â”‚ [ç»§ç»­å¯¹è¯] [åˆ‡æ¢æ¨¡å‹] [å¤åˆ¶] [åˆ é™¤]     â”‚  â† æ“ä½œæŒ‰é’®
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

æŠ˜å åï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¤– AI å¯¹è¯ Â· GPT-4 Â· 2åˆ†é’Ÿå‰      [â–¶]  â”‚  â† ç‚¹å‡»å±•å¼€
â”‚ "å¸®æˆ‘æ€»ç»“ä¸Šé¢çš„ä¼šè®®è®¨è®ºè¦ç‚¹"           â”‚  â† æ˜¾ç¤ºé—®é¢˜é¢„è§ˆ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. æ¨¡å‹ç®¡ç†

#### 3.1 æ”¯æŒçš„æ¨¡å‹
| æ¨¡å‹ | è§¦å‘å™¨ | ç‰¹ç‚¹ | ç”¨é€” |
|------|--------|------|------|
| GPT-4 | `@ai:gpt4` | å…¨èƒ½ã€æ¨ç†å¼º | å¤æ‚åˆ†æã€ä»£ç  |
| Claude | `@ai:claude` | é•¿æ–‡æœ¬ã€åˆ›ä½œ | æ–‡ç« å†™ä½œã€æ€»ç»“ |
| Gemini | `@ai:gemini` | å¤šæ¨¡æ€ | å›¾ç‰‡ç†è§£ã€è§†é¢‘ |
| æ··å…ƒ | `@ai:hunyuan` | ä¸­æ–‡ä¼˜åŒ– | ä¸­æ–‡åˆ›ä½œã€æœ¬åœ°åŒ– |

#### 3.2 æ¨¡å‹é€‰æ‹©å™¨
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é€‰æ‹© AI æ¨¡å‹                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ“ GPT-4 (é»˜è®¤)              â”‚
â”‚   â€¢ æœ€å¼ºæ¨ç†èƒ½åŠ›            â”‚
â”‚   â€¢ $0.03/1K tokens         â”‚
â”‚                             â”‚
â”‚   Claude 3 Sonnet           â”‚
â”‚   â€¢ 200K ä¸Šä¸‹æ–‡             â”‚
â”‚   â€¢ $0.003/1K tokens        â”‚
â”‚                             â”‚
â”‚   Gemini Pro                â”‚
â”‚   â€¢ æ”¯æŒå›¾ç‰‡è¾“å…¥            â”‚
â”‚   â€¢ å…è´¹                    â”‚
â”‚                             â”‚
â”‚   æ··å…ƒ (è…¾è®¯)               â”‚
â”‚   â€¢ ä¸­æ–‡ä¼˜åŒ–                â”‚
â”‚   â€¢ å·²é…ç½®                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. ä¸Šä¸‹æ–‡ç®¡ç†

#### 4.1 ä¸Šä¸‹æ–‡æ¥æº
1. **EventLog å†…å®¹**ï¼šå½“å‰ç¬”è®°çš„å…¨éƒ¨æ–‡å­—
2. **Event å…ƒæ•°æ®**ï¼šæ ‡é¢˜ã€æ ‡ç­¾ã€æ—¶é—´ã€åœ°ç‚¹
3. **å¯¹è¯å†å²**ï¼šåŒä¸€ Thread çš„å‰åº Q&A
4. **é€‰ä¸­æ–‡æœ¬**ï¼šç”¨æˆ·é«˜äº®çš„å†…å®¹
5. **å…³è”äº‹ä»¶**ï¼šé€šè¿‡ @mention å¼•ç”¨çš„äº‹ä»¶

#### 4.2 ä¸Šä¸‹æ–‡æ„å»º
```typescript
interface ChatContext {
  // Event ä¿¡æ¯
  event: {
    id: string;
    title: string;
    tags: string[];
    startTime?: string;
    location?: string;
  };
  
  // ç¬”è®°å†…å®¹
  eventLog: {
    plainText: string;      // çº¯æ–‡æœ¬å†…å®¹
    slateNodes: Descendant[];  // Slate èŠ‚ç‚¹ï¼ˆåŒ…å«æ ¼å¼ï¼‰
    images?: string[];      // å›¾ç‰‡ URL
    attachments?: Attachment[];
  };
  
  // å¯¹è¯å†å²
  chatHistory: Array<{
    role: 'user' | 'assistant';
    content: string;
    timestamp: string;
  }>;
  
  // é€‰ä¸­å†…å®¹
  selection?: {
    text: string;
    nodeType: string;
  };
  
  // å…³è”äº‹ä»¶
  linkedEvents?: Event[];
}
```

#### 4.3 æ™ºèƒ½ä¸Šä¸‹æ–‡å‹ç¼©
- **Token é™åˆ¶**ï¼šæ ¹æ®æ¨¡å‹ context window è‡ªåŠ¨å‹ç¼©
- **ä¼˜å…ˆçº§æ’åº**ï¼š
  1. ç”¨æˆ·é—®é¢˜
  2. é€‰ä¸­æ–‡æœ¬
  3. æœ€è¿‘ 3 è½®å¯¹è¯
  4. Event å…ƒæ•°æ®
  5. EventLog æœ€å 2000 å­—
- **å‹ç¼©ç­–ç•¥**ï¼š
  - ç§»é™¤ Markdown æ ¼å¼
  - æå–å…³é”®å¥å­
  - ä¿ç•™æ•°å­—å’Œæ—¥æœŸ

### 5. æµå¼å“åº”

#### 5.1 æ˜¾ç¤ºæ•ˆæœ
```
ğŸ¤– æ­£åœ¨æ€è€ƒ...

ğŸ¤– GPT-4:
æ ¹æ®ä¸Šæ–‡ï¼Œä¼šè®®çš„æ ¸å¿ƒâ–ˆ  â† æ‰“å­—æœºæ•ˆæœ

ğŸ¤– GPT-4:
æ ¹æ®ä¸Šæ–‡ï¼Œä¼šè®®çš„æ ¸å¿ƒè®¨è®ºè¦ç‚¹åŒ…æ‹¬ï¼š
1. é¡¹ç›®è¿›åº¦æ›´æ–°â–ˆ
```

#### 5.2 æŠ€æœ¯å®ç°
```typescript
async function* streamChatResponse(
  question: string,
  context: ChatContext,
  model: AIModel
): AsyncGenerator<string> {
  const llm = getLLMService(model);
  
  // æ„å»º prompt
  const prompt = buildChatPrompt(question, context);
  
  // æµå¼è°ƒç”¨
  for await (const chunk of llm.stream(prompt)) {
    yield chunk.text;
  }
}

// åœ¨ Slate ä¸­å®æ—¶æ’å…¥
editor.insertText(chunk, { at: answerPath });
```

### 6. å¿«æ·å‘½ä»¤

#### 6.1 é¢„å®šä¹‰å‘½ä»¤
| å‘½ä»¤ | è¯´æ˜ | Prompt æ¨¡æ¿ |
|------|------|-------------|
| `@ai.sum` | æ€»ç»“ä¸Šæ–‡ | "è¯·æ€»ç»“ä»¥ä¸‹å†…å®¹çš„æ ¸å¿ƒè¦ç‚¹ï¼š\n{context}" |
| `@ai.explain` | è§£é‡Šé€‰ä¸­å†…å®¹ | "è¯·è¯¦ç»†è§£é‡Šï¼š{selection}" |
| `@ai.translate` | ç¿»è¯‘ä¸ºè‹±æ–‡/ä¸­æ–‡ | "è¯·ç¿»è¯‘ä¸º{lang}ï¼š{selection}" |
| `@ai.fix` | ä¿®æ­£è¯­æ³•å’Œæ‹¼å†™ | "è¯·ä¿®æ­£ä»¥ä¸‹æ–‡å­—çš„è¯­æ³•é”™è¯¯ï¼š{selection}" |
| `@ai.expand` | æ‰©å±•å†…å®¹ | "è¯·å°†ä»¥ä¸‹å†…å®¹æ‰©å±•ä¸º3æ®µè¯¦ç»†è¯´æ˜ï¼š{selection}" |
| `@ai.code` | ç”Ÿæˆä»£ç  | "è¯·ç”Ÿæˆ{lang}ä»£ç ï¼š{selection}" |

#### 6.2 è‡ªå®šä¹‰å‘½ä»¤
ç”¨æˆ·å¯ä»¥åœ¨è®¾ç½®ä¸­æ·»åŠ è‡ªå®šä¹‰å‘½ä»¤ï¼š
```typescript
interface CustomCommand {
  trigger: string;        // å¦‚ "@ai.review"
  name: string;           // "ä»£ç å®¡æŸ¥"
  promptTemplate: string; // "è¯·å®¡æŸ¥ä»¥ä¸‹ä»£ç ï¼š{selection}"
  model: AIModel;         // é»˜è®¤æ¨¡å‹
  autoRun: boolean;       // æ˜¯å¦è‡ªåŠ¨è¿è¡Œ
}
```

---

## ğŸ› ï¸ æŠ€æœ¯å®ç°

### 1. æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ç”¨æˆ·äº¤äº’å±‚ (ModalSlate)          â”‚
â”‚  - UnifiedMentionMenu (@ai è§¦å‘)        â”‚
â”‚  - AIChatToggle ç»„ä»¶                     â”‚
â”‚  - æµå¼å“åº”æ˜¾ç¤º                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       AI ChatFlow Service               â”‚
â”‚  - ä¸Šä¸‹æ–‡æå–                            â”‚
â”‚  - Prompt æ„å»º                           â”‚
â”‚  - æµå¼è°ƒç”¨ç®¡ç†                          â”‚
â”‚  - å¯¹è¯å†å²ç®¡ç†                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        å¤šæ¨¡å‹é€‚é…å±‚                      â”‚
â”‚  - GPT-4 Adapter                        â”‚
â”‚  - Claude Adapter                       â”‚
â”‚  - Gemini Adapter                       â”‚
â”‚  - Hunyuan Adapter                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         LLMService (ç»Ÿä¸€æ¥å£)           â”‚
â”‚  - stream(prompt)                       â”‚
â”‚  - chat(messages)                       â”‚
â”‚  - embeddings(text)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. æ ¸å¿ƒç»„ä»¶

#### 2.1 AIChatToggle ç»„ä»¶
```typescript
// src/components/SlateCore/elements/AIChatToggle.tsx
interface AIChatToggleProps {
  question: string;
  answer?: string;
  model: AIModel;
  threadId: string;
  collapsed: boolean;
  onToggle: () => void;
  onContinue: () => void;
  onSwitchModel: (model: AIModel) => void;
  onDelete: () => void;
}

export const AIChatToggle: React.FC<AIChatToggleProps> = ({
  question,
  answer,
  model,
  collapsed,
  onToggle,
  onContinue,
  onSwitchModel,
  onDelete
}) => {
  return (
    <div className="ai-chat-toggle" data-collapsed={collapsed}>
      {/* æ ‡é¢˜æ  */}
      <div className="toggle-header" onClick={onToggle}>
        <span className="model-icon">{getModelIcon(model)}</span>
        <span className="question-preview">{question}</span>
        <span className="toggle-icon">{collapsed ? 'â–¶' : 'â–¼'}</span>
      </div>
      
      {/* å†…å®¹åŒºï¼ˆæŠ˜å æ—¶éšè—ï¼‰*/}
      {!collapsed && (
        <div className="toggle-content">
          {/* é—®é¢˜ */}
          <div className="question-block">
            <span className="user-icon">ğŸ‘¤</span>
            <div className="question-text">{question}</div>
          </div>
          
          {/* å›ç­” */}
          <div className="answer-block">
            <span className="ai-icon">{getModelIcon(model)}</span>
            <div className="answer-text">
              {answer ? (
                <Markdown>{answer}</Markdown>
              ) : (
                <LoadingDots />
              )}
            </div>
          </div>
          
          {/* æ“ä½œæŒ‰é’® */}
          <div className="action-buttons">
            <button onClick={onContinue}>ç»§ç»­å¯¹è¯</button>
            <ModelSelector current={model} onChange={onSwitchModel} />
            <button onClick={() => copyToClipboard(answer)}>å¤åˆ¶</button>
            <button onClick={onDelete}>åˆ é™¤</button>
          </div>
        </div>
      )}
    </div>
  );
};
```

#### 2.2 AIChatFlowService
```typescript
// src/services/AIChatFlowService.ts
export class AIChatFlowService {
  private llmService: LLMService;
  private contextExtractor: ContextExtractor;
  
  /**
   * å‘é€ AI é—®é¢˜
   */
  async *askAI(
    question: string,
    options: {
      eventId: string;
      model: AIModel;
      threadId?: string;
      selection?: string;
    }
  ): AsyncGenerator<string> {
    // 1. æå–ä¸Šä¸‹æ–‡
    const context = await this.contextExtractor.extract({
      eventId: options.eventId,
      threadId: options.threadId,
      selection: options.selection
    });
    
    // 2. æ„å»º prompt
    const prompt = this.buildPrompt(question, context);
    
    // 3. æµå¼è°ƒç”¨ LLM
    const llm = this.getLLM(options.model);
    for await (const chunk of llm.stream(prompt)) {
      yield chunk.text;
    }
    
    // 4. ä¿å­˜å¯¹è¯å†å²
    await this.saveChatHistory({
      threadId: options.threadId || generateThreadId(),
      question,
      answer: fullAnswer,
      model: options.model,
      timestamp: new Date().toISOString()
    });
  }
  
  /**
   * æ„å»º prompt
   */
  private buildPrompt(question: string, context: ChatContext): string {
    return `ä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½åŠ©æ‰‹ï¼Œå¸®åŠ©ç”¨æˆ·åœ¨ç¬”è®°ä¸­å›ç­”é—®é¢˜ã€‚

å½“å‰äº‹ä»¶ä¿¡æ¯ï¼š
- æ ‡é¢˜ï¼š${context.event.title}
- æ ‡ç­¾ï¼š${context.event.tags.join(', ')}
${context.event.startTime ? `- æ—¶é—´ï¼š${context.event.startTime}` : ''}

ç¬”è®°å†…å®¹ï¼š
${context.eventLog.plainText.slice(0, 2000)}

${context.chatHistory.length > 0 ? `
å¯¹è¯å†å²ï¼š
${context.chatHistory.map(h => `${h.role === 'user' ? 'ç”¨æˆ·' : 'AI'}: ${h.content}`).join('\n')}
` : ''}

ç”¨æˆ·é—®é¢˜ï¼š${question}

è¯·å›ç­”ç”¨æˆ·çš„é—®é¢˜ã€‚å¦‚æœé—®é¢˜ä¸ä¸Šä¸‹æ–‡ç›¸å…³ï¼Œè¯·ç»“åˆä¸Šä¸‹æ–‡å›ç­”ã€‚`;
  }
  
  /**
   * è·å– LLM å®ä¾‹
   */
  private getLLM(model: AIModel): LLMService {
    switch (model) {
      case 'gpt4':
        return new GPT4Service(config.openai);
      case 'claude':
        return new ClaudeService(config.anthropic);
      case 'gemini':
        return new GeminiService(config.google);
      case 'hunyuan':
        return new HunyuanService(config.tencent);
      default:
        return this.llmService; // é»˜è®¤
    }
  }
}
```

#### 2.3 UnifiedMentionMenu æ‰©å±•
```typescript
// src/components/UnifiedMentionMenu/UnifiedMentionMenu.tsx
// æ·»åŠ  AI ç±»å‹çš„ mention

// æ£€æµ‹ @ai è§¦å‘
if (query.startsWith('ai')) {
  const aiQuery = query.slice(2).trim(); // ç§»é™¤ "ai"
  
  // æ£€æµ‹æ¨¡å‹æŒ‡å®š (å¦‚ @ai:gpt4)
  const modelMatch = aiQuery.match(/^:(\w+)\s*/);
  const model = modelMatch ? modelMatch[1] : 'default';
  const actualQuery = modelMatch ? aiQuery.slice(modelMatch[0].length) : aiQuery;
  
  setMentionType('ai');
  setAIModel(model);
  setAIQuery(actualQuery);
}

// æ¸²æŸ“ AI èœå•
if (mentionType === 'ai') {
  return (
    <AIChatMenu
      query={aiQuery}
      model={aiModel}
      onSubmit={(question) => {
        handleAIChat(question, aiModel);
        onClose();
      }}
      onModelChange={setAIModel}
    />
  );
}
```

### 3. æ•°æ®å­˜å‚¨

#### 3.1 Chat Thread å­˜å‚¨
```typescript
// LocalStorage: ai-chat-threads-{eventId}
interface ChatThread {
  id: string;
  eventId: string;
  messages: Array<{
    role: 'user' | 'assistant';
    content: string;
    model: AIModel;
    timestamp: string;
    tokens?: { prompt: number; completion: number };
  }>;
  createdAt: string;
  updatedAt: string;
}
```

#### 3.2 EventLog é›†æˆ
```typescript
// åœ¨ EventLog.slateJson ä¸­ä¿å­˜ä¸ºç‰¹æ®ŠèŠ‚ç‚¹
{
  type: 'ai-chat-toggle',
  threadId: 'thread_123',
  collapsed: true,
  children: [
    {
      type: 'ai-question',
      text: 'å¸®æˆ‘æ€»ç»“ä¸Šé¢çš„ä¼šè®®è®¨è®ºè¦ç‚¹',
      timestamp: '2024-12-17T10:30:00Z'
    },
    {
      type: 'ai-answer',
      text: 'æ ¹æ®ä¸Šæ–‡ï¼Œä¼šè®®çš„æ ¸å¿ƒè®¨è®ºè¦ç‚¹åŒ…æ‹¬ï¼š...',
      model: 'gpt4',
      timestamp: '2024-12-17T10:30:05Z'
    }
  ]
}
```

---

## ğŸ¨ UI/UX è®¾è®¡

### 1. äº¤äº’æµç¨‹

#### æµç¨‹ 1ï¼šåŸºç¡€æé—®
```
1. ç”¨æˆ·è¾“å…¥ "@ai"
   â†“
2. å¼¹å‡º AI èœå•ï¼ˆæ˜¾ç¤ºæ¨¡å‹é€‰æ‹©ï¼‰
   â†“
3. ç”¨æˆ·è¾“å…¥é—®é¢˜ï¼ŒæŒ‰ Enter
   â†“
4. æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
   â†“
5. æµå¼æ˜¾ç¤º AI å›ç­”ï¼ˆæ‰“å­—æœºæ•ˆæœï¼‰
   â†“
6. å›ç­”å®Œæˆï¼Œè‡ªåŠ¨ä¿å­˜ä¸º Toggle èŠ‚ç‚¹
```

#### æµç¨‹ 2ï¼šå¤šè½®å¯¹è¯
```
1. ç‚¹å‡»å·²æœ‰ Toggle çš„"ç»§ç»­å¯¹è¯"
   â†“
2. å±•å¼€è¾“å…¥æ¡†
   â†“
3. è¾“å…¥åç»­é—®é¢˜
   â†“
4. AI åŸºäºå¯¹è¯å†å²å›ç­”
   â†“
5. æ–°çš„ Q&A è¿½åŠ åˆ° Toggle é‡Œ
```

#### æµç¨‹ 3ï¼šåˆ‡æ¢æ¨¡å‹
```
1. ç‚¹å‡» Toggle çš„"åˆ‡æ¢æ¨¡å‹"
   â†“
2. é€‰æ‹©æ–°æ¨¡å‹ï¼ˆå¦‚ Claudeï¼‰
   â†“
3. åŒæ ·é—®é¢˜é‡æ–°å‘é€
   â†“
4. æ–°å›ç­”æ˜¾ç¤ºåœ¨ä¸‹æ–¹
   â†“
5. ç”¨æˆ·å¯¹æ¯”ä¸¤ä¸ªå›ç­”
```

### 2. è§†è§‰è§„èŒƒ

#### 2.1 é¢œè‰²ç³»ç»Ÿ
```css
/* AI ä¸»é¢˜è‰² */
--ai-primary: #8B5CF6;      /* ç´«è‰² - AI æ ‡è¯†è‰² */
--ai-secondary: #EC4899;    /* ç²‰è‰² - å¼ºè°ƒè‰² */
--ai-success: #10B981;      /* ç»¿è‰² - æˆåŠŸçŠ¶æ€ */
--ai-warning: #F59E0B;      /* æ©™è‰² - è­¦å‘Š */

/* æ¨¡å‹é¢œè‰² */
--model-gpt4: #74AA9C;      /* GPT-4: é’ç»¿ */
--model-claude: #CC785C;    /* Claude: æ©™çº¢ */
--model-gemini: #4285F4;    /* Gemini: è“è‰² */
--model-hunyuan: #00A870;   /* æ··å…ƒ: è…¾è®¯ç»¿ */

/* Toggle èŠ‚ç‚¹ */
--toggle-bg: #F9FAFB;
--toggle-border: #E5E7EB;
--toggle-hover: #F3F4F6;
```

#### 2.2 å›¾æ ‡ç³»ç»Ÿ
- **AI æ€»å›¾æ ‡**ï¼šğŸ¤– æˆ– âœ¨
- **GPT-4**ï¼šğŸŸ¢ (OpenAI ç»¿)
- **Claude**ï¼šğŸŸ  (Anthropic æ©™)
- **Gemini**ï¼šğŸ”µ (Google è“)
- **æ··å…ƒ**ï¼šğŸŸ© (è…¾è®¯ç»¿)

#### 2.3 åŠ¨ç”»æ•ˆæœ
```css
/* æ‰“å­—æœºæ•ˆæœ */
@keyframes typing {
  from { opacity: 0.3; }
  to { opacity: 1; }
}

.ai-typing-cursor {
  animation: typing 0.8s infinite;
}

/* å±•å¼€/æŠ˜å  */
@keyframes expand {
  from {
    max-height: 0;
    opacity: 0;
  }
  to {
    max-height: 1000px;
    opacity: 1;
  }
}
```

---

## ğŸ“Š å®ç°éš¾åº¦è¯„ä¼°

### éš¾åº¦ç­‰çº§ï¼šâ­â­â­ (ä¸­ç­‰åä¸Š)

### å·²æœ‰åŸºç¡€ âœ…
1. **UnifiedMentionMenu**ï¼š@ è§¦å‘æœºåˆ¶å·²å®ç°
2. **ModalSlate**ï¼šå¯Œæ–‡æœ¬ç¼–è¾‘å™¨å·²å®Œæˆ
3. **LLMService**ï¼šAI è°ƒç”¨æ¡†æ¶å·²æ­å»º
4. **EventLog å­˜å‚¨**ï¼šSlate JSON å­˜å‚¨å·²å®Œå–„

### éœ€è¦æ–°å¢ ğŸ†•
1. **AIChatToggle ç»„ä»¶**ï¼šå¯æŠ˜å çš„ Q&A èŠ‚ç‚¹ï¼ˆä¸­ç­‰ï¼‰
2. **æµå¼å“åº”é›†æˆ**ï¼šå®æ—¶æ˜¾ç¤º AI è¾“å‡ºï¼ˆä¸­ç­‰ï¼‰
3. **ä¸Šä¸‹æ–‡æå–**ï¼šä» EventLog æå–æ™ºèƒ½ä¸Šä¸‹æ–‡ï¼ˆç®€å•ï¼‰
4. **å¤šæ¨¡å‹é€‚é…**ï¼šGPT-4/Claude/Gemini ç»Ÿä¸€æ¥å£ï¼ˆä¸­ç­‰ï¼‰
5. **å¯¹è¯å†å²ç®¡ç†**ï¼šThread å­˜å‚¨å’Œæ£€ç´¢ï¼ˆç®€å•ï¼‰

### æŠ€æœ¯æŒ‘æˆ˜ âš ï¸
1. **æµå¼å“åº”çš„ Slate é›†æˆ**ï¼šéœ€è¦åœ¨æµå¼è¾“å‡ºæ—¶å®æ—¶æ›´æ–°èŠ‚ç‚¹
2. **Token è®¡ç®—ä¸é™åˆ¶**ï¼šé¿å…è¶…å‡ºæ¨¡å‹ context window
3. **å¤šæ¨¡å‹ API é€‚é…**ï¼šä¸åŒæä¾›å•†çš„ API æ ¼å¼ä¸åŒ
4. **æ€§èƒ½ä¼˜åŒ–**ï¼šå¤§é‡å¯¹è¯å†å²çš„åŠ è½½å’Œæ¸²æŸ“

### é¢„ä¼°å·¥æ—¶
- **æ ¸å¿ƒåŠŸèƒ½**ï¼š2-3 å‘¨
  - Week 1: AIChatToggle ç»„ä»¶ + åŸºç¡€æµå¼å“åº”
  - Week 2: å¤šæ¨¡å‹é€‚é… + ä¸Šä¸‹æ–‡ç®¡ç†
  - Week 3: UI ä¼˜åŒ– + æ€§èƒ½è°ƒä¼˜
- **æ‰©å±•åŠŸèƒ½**ï¼š1-2 å‘¨
  - å¿«æ·å‘½ä»¤
  - è‡ªå®šä¹‰ Prompt
  - é«˜çº§è®¾ç½®

---

## ğŸ’¡ ç”¨æˆ·ä»·å€¼åˆ†æ

### ä¼šè®©ç”¨æˆ·å–œæ¬¢å—ï¼Ÿ**å¼ºçƒˆæ¨èå®ç°ï¼** â­â­â­â­â­

### æ ¸å¿ƒä¼˜åŠ¿
1. **æ— ç¼é›†æˆ** âœ…
   - ä¸éœ€è¦åˆ‡æ¢åº”ç”¨
   - AI å›ç­”ç›´æ¥æˆä¸ºç¬”è®°ä¸€éƒ¨åˆ†
   - è‡ªåŠ¨ä¿å­˜ï¼Œæ— éœ€æ‰‹åŠ¨å¤åˆ¶

2. **ä¸Šä¸‹æ–‡æ„ŸçŸ¥** âœ…
   - ç†è§£å½“å‰äº‹ä»¶å’Œç¬”è®°å†…å®¹
   - æä¾›æ›´ç›¸å…³çš„å›ç­”
   - æ¯”ç‹¬ç«‹ Chat å·¥å…·æ›´æ™ºèƒ½

3. **å¤šæ¨¡å‹çµæ´»æ€§** âœ…
   - ä¸åŒä»»åŠ¡ç”¨ä¸åŒæ¨¡å‹
   - é¿å…è¢«å•ä¸€å‚å•†ç»‘å®š
   - æˆæœ¬ä¼˜åŒ–ï¼ˆä¾¿å®œæ¨¡å‹å¤„ç†ç®€å•ä»»åŠ¡ï¼‰

4. **çŸ¥è¯†æ²‰æ·€** âœ…
   - æ‰€æœ‰å¯¹è¯è‡ªåŠ¨å½’æ¡£
   - å¯æœç´¢ã€å¯å¼•ç”¨
   - å½¢æˆä¸ªäººçŸ¥è¯†åº“

### å¯¹æ¯”ç«å“

| åŠŸèƒ½ | 4DNote | Notion AI | Sider Chat | ChatGPT |
|------|--------|-----------|------------|---------|
| å†…è”å¯¹è¯ | âœ… | âœ… | âŒ | âŒ |
| è‡ªåŠ¨ä¿å­˜ | âœ… (Toggle) | âš ï¸ (ä»…ç»“æœ) | âŒ | âš ï¸ (éœ€æ‰‹åŠ¨) |
| å¤šæ¨¡å‹ | âœ… | âŒ | âœ… | âŒ |
| ä¸Šä¸‹æ–‡æ„ŸçŸ¥ | âœ… | âœ… | âš ï¸ | âŒ |
| æŠ˜å æ˜¾ç¤º | âœ… | âŒ | âŒ | âŒ |
| å…è´¹ | âœ… | âŒ ($10/æœˆ) | âš ï¸ (éƒ¨åˆ†) | âš ï¸ (é™é¢) |

### æ½œåœ¨ç”¨æˆ·åé¦ˆ
> "å¤ªæ£’äº†ï¼ç»ˆäºä¸ç”¨åœ¨ç¬”è®°å’Œ ChatGPT ä¹‹é—´æ¥å›åˆ‡æ¢äº†ï¼"

> "Toggle èŠ‚ç‚¹è®¾è®¡å¤ªè´´å¿ƒï¼Œç¬”è®°ä¸ä¼šè¢« AI å¯¹è¯æä¹±"

> "å¤šæ¨¡å‹æ”¯æŒå¾ˆå®ç”¨ï¼Œå†™ä»£ç ç”¨ GPT-4ï¼Œå†™æ–‡ç« ç”¨ Claude"

> "ä¸Šä¸‹æ–‡æ„ŸçŸ¥å¤ªæ™ºèƒ½äº†ï¼Œå®ƒçœŸçš„ç†è§£æˆ‘çš„ç¬”è®°å†…å®¹"

---

## ğŸš€ å®æ–½è®¡åˆ’

### Phase 1: MVPï¼ˆ2å‘¨ï¼‰
**ç›®æ ‡**ï¼šå®ç°åŸºç¡€ AI å¯¹è¯åŠŸèƒ½

#### Week 1: æ ¸å¿ƒç»„ä»¶
- [x] AIChatToggle ç»„ä»¶ï¼ˆå±•å¼€/æŠ˜å ï¼‰
- [x] UnifiedMentionMenu æ‰©å±•ï¼ˆ@ai è§¦å‘ï¼‰
- [x] åŸºç¡€æµå¼å“åº”æ˜¾ç¤º
- [x] å•æ¨¡å‹æ”¯æŒï¼ˆHunyuanï¼‰

#### Week 2: ä¸Šä¸‹æ–‡ä¸å­˜å‚¨
- [x] ContextExtractor å®ç°
- [x] ChatThread å­˜å‚¨
- [x] EventLog é›†æˆ
- [x] åŸºç¡€ UI æ ·å¼

#### éªŒæ”¶æ ‡å‡†
- âœ… èƒ½åœ¨ ModalSlate ä¸­è¾“å…¥ `@ai é—®é¢˜`
- âœ… AI å›ç­”æµå¼æ˜¾ç¤º
- âœ… è‡ªåŠ¨ä¿å­˜ä¸º Toggle èŠ‚ç‚¹
- âœ… å¯å±•å¼€/æŠ˜å æŸ¥çœ‹

### Phase 2: å¤šæ¨¡å‹æ”¯æŒï¼ˆ1å‘¨ï¼‰
**ç›®æ ‡**ï¼šæ”¯æŒ GPT-4/Claude/Gemini

#### Week 3: æ¨¡å‹é€‚é…
- [ ] GPT-4 Adapter
- [ ] Claude Adapter
- [ ] Gemini Adapter
- [ ] æ¨¡å‹é€‰æ‹©å™¨ UI
- [ ] `@ai:gpt4` è¯­æ³•æ”¯æŒ

#### éªŒæ”¶æ ‡å‡†
- âœ… å¯åˆ‡æ¢ä¸åŒæ¨¡å‹
- âœ… æ¯ä¸ªæ¨¡å‹ç‹¬ç«‹é…ç½®
- âœ… æ˜¾ç¤ºæ¨¡å‹å›¾æ ‡å’Œåç§°

### Phase 3: é«˜çº§åŠŸèƒ½ï¼ˆ1å‘¨ï¼‰
**ç›®æ ‡**ï¼šå¿«æ·å‘½ä»¤å’Œä¼˜åŒ–

#### Week 4: åŠŸèƒ½å¢å¼º
- [ ] å¿«æ·å‘½ä»¤ (`@ai.sum`, `@ai.explain` ç­‰)
- [ ] å¤šè½®å¯¹è¯æ”¯æŒ
- [ ] å»ºè®®åç»­é—®é¢˜
- [ ] æ€§èƒ½ä¼˜åŒ–

#### éªŒæ”¶æ ‡å‡†
- âœ… 6ä¸ªå¿«æ·å‘½ä»¤å¯ç”¨
- âœ… å¯åŸºäºå†å²ç»§ç»­å¯¹è¯
- âœ… AI ç»™å‡º 3 ä¸ªåç»­é—®é¢˜å»ºè®®

### Phase 4: æ‰“ç£¨ï¼ˆ1å‘¨ï¼‰
**ç›®æ ‡**ï¼šUI/UX ä¼˜åŒ–å’Œæµ‹è¯•

#### Week 5: æŠ›å…‰
- [ ] åŠ¨ç”»æ•ˆæœä¼˜åŒ–
- [ ] é”™è¯¯å¤„ç†å®Œå–„
- [ ] ç”¨æˆ·æ–‡æ¡£
- [ ] æ€§èƒ½æµ‹è¯•
- [ ] Bug ä¿®å¤

---

## ğŸ¯ æˆåŠŸæŒ‡æ ‡

### æ ¸å¿ƒæŒ‡æ ‡
1. **ä½¿ç”¨é¢‘ç‡**
   - ç›®æ ‡ï¼šæ¯ç”¨æˆ·æ¯å¤© 5+ æ¬¡ AI å¯¹è¯
   - æµ‹é‡ï¼šç»Ÿè®¡ `@ai` è§¦å‘æ¬¡æ•°

2. **ç•™å­˜ç‡**
   - ç›®æ ‡ï¼šå¯ç”¨å 7 å¤©ç•™å­˜ > 80%
   - æµ‹é‡ï¼šå¯ç”¨è¯¥åŠŸèƒ½çš„ç”¨æˆ· 7 å¤©åä»åœ¨ä½¿ç”¨

3. **å¯¹è¯è´¨é‡**
   - ç›®æ ‡ï¼šå¹³å‡å¯¹è¯è½®æ•° > 2
   - æµ‹é‡ï¼šç»Ÿè®¡ Thread å†…çš„æ¶ˆæ¯æ•°

4. **å¤šæ¨¡å‹ä½¿ç”¨**
   - ç›®æ ‡ï¼š30% ç”¨æˆ·ä½¿ç”¨ 2+ æ¨¡å‹
   - æµ‹é‡ï¼šç»Ÿè®¡ä¸åŒæ¨¡å‹çš„è°ƒç”¨æ¯”ä¾‹

### è¾…åŠ©æŒ‡æ ‡
1. Token æ¶ˆè€—ï¼šå¹³å‡æ¯æ¬¡å¯¹è¯ < 2000 tokens
2. å“åº”é€Ÿåº¦ï¼šé¦– token å»¶è¿Ÿ < 1s
3. é”™è¯¯ç‡ï¼šAPI è°ƒç”¨å¤±è´¥ç‡ < 5%
4. ç¬”è®°è´¨é‡ï¼šå¯ç”¨åç¬”è®°å­—æ•°å¢é•¿ > 20%

---

## ğŸ”§ æŠ€æœ¯å€ºåŠ¡ä¸ä¼˜åŒ–

### éœ€è¦æ³¨æ„çš„é—®é¢˜
1. **æˆæœ¬æ§åˆ¶**
   - Token æ¶ˆè€—ç›‘æ§
   - ç”¨æˆ·é…é¢é™åˆ¶
   - å»‰ä»·æ¨¡å‹ä¼˜å…ˆ

2. **éšç§å®‰å…¨**
   - æ•æ„Ÿä¿¡æ¯è¿‡æ»¤
   - æœ¬åœ°æ•°æ®ä¸ä¸Šä¼ 
   - ç”¨æˆ·æ˜ç¡®æˆæƒ

3. **æ€§èƒ½ä¼˜åŒ–**
   - ä¸Šä¸‹æ–‡å‹ç¼©ç®—æ³•
   - å¯¹è¯å†å²åˆ†é¡µåŠ è½½
   - æµå¼å“åº”å–æ¶ˆæœºåˆ¶

4. **é”™è¯¯å¤„ç†**
   - API é™æµé‡è¯•
   - ç½‘ç»œè¶…æ—¶å¤„ç†
   - é™çº§æ–¹æ¡ˆï¼ˆç¦»çº¿æ¨¡å¼ï¼‰

### æœªæ¥æ‰©å±•æ–¹å‘
1. **è¯­éŸ³è¾“å…¥**ï¼šè¯­éŸ³è½¬æ–‡å­—åå‘é€ç»™ AI
2. **å›¾ç‰‡ç†è§£**ï¼šä¸Šä¼ å›¾ç‰‡è®© AI åˆ†æ
3. **ä»£ç æ‰§è¡Œ**ï¼šAI ç”Ÿæˆçš„ä»£ç å¯è¿è¡Œ
4. **çŸ¥è¯†å›¾è°±**ï¼šåŸºäºå¯¹è¯æ„å»ºçŸ¥è¯†ç½‘ç»œ
5. **åä½œ AI**ï¼šå¤šç”¨æˆ·å…±äº« AI Thread

---

## ğŸ“š å‚è€ƒèµ„æ–™

### ç«å“åˆ†æ
- [Notion AI](https://www.notion.so/product/ai)
- [Sider Chat](https://sider.ai/)
- [Cursor](https://cursor.sh/)
- [GitHub Copilot Chat](https://github.com/features/copilot)

### æŠ€æœ¯æ–‡æ¡£
- [LangChain Streaming](https://js.langchain.com/docs/expression_language/streaming)
- [OpenAI Streaming API](https://platform.openai.com/docs/api-reference/streaming)
- [Slate Custom Elements](https://docs.slatejs.org/concepts/08-rendering#elements)

---

## ğŸ“ é™„å½•

### A. Prompt æ¨¡æ¿ç¤ºä¾‹

#### æ€»ç»“æ¨¡æ¿
```
ä½ æ˜¯ä¸€ä¸ªæ“…é•¿æ€»ç»“çš„åŠ©æ‰‹ã€‚è¯·æ€»ç»“ä»¥ä¸‹å†…å®¹çš„æ ¸å¿ƒè¦ç‚¹ï¼š

{content}

è¦æ±‚ï¼š
- æå– 3-5 ä¸ªæ ¸å¿ƒè¦ç‚¹
- æ¯ä¸ªè¦ç‚¹ç”¨ä¸€å¥è¯æ¦‚æ‹¬
- ä½¿ç”¨ Markdown åˆ—è¡¨æ ¼å¼
```

#### è§£é‡Šæ¨¡æ¿
```
ä½ æ˜¯ä¸€ä¸ªè€å¿ƒçš„è€å¸ˆã€‚è¯·è¯¦ç»†è§£é‡Šä»¥ä¸‹å†…å®¹ï¼š

{selection}

è¦æ±‚ï¼š
- ç”¨ç®€å•æ˜“æ‡‚çš„è¯­è¨€
- ä¸¾ä¾‹è¯´æ˜
- å¦‚æœæ¶‰åŠæŠ€æœ¯æ¦‚å¿µï¼Œç”¨ç±»æ¯”è§£é‡Š
```

### B. API é…ç½®ç¤ºä¾‹

```typescript
// src/config/ai-chat.config.ts
export const aiChatConfig = {
  models: {
    gpt4: {
      provider: 'openai',
      model: 'gpt-4-turbo-preview',
      apiKey: process.env.OPENAI_API_KEY,
      maxTokens: 4096,
      temperature: 0.7,
    },
    claude: {
      provider: 'anthropic',
      model: 'claude-3-sonnet-20240229',
      apiKey: process.env.ANTHROPIC_API_KEY,
      maxTokens: 4096,
      temperature: 0.7,
    },
    gemini: {
      provider: 'google',
      model: 'gemini-pro',
      apiKey: process.env.GOOGLE_API_KEY,
      maxTokens: 2048,
      temperature: 0.7,
    },
    hunyuan: {
      provider: 'tencent',
      model: 'hunyuan-lite',
      secretId: process.env.TENCENT_SECRET_ID,
      secretKey: process.env.TENCENT_SECRET_KEY,
      maxTokens: 2048,
      temperature: 0.7,
    }
  },
  
  defaultModel: 'hunyuan',
  
  contextLimits: {
    eventLogMaxChars: 2000,
    chatHistoryMaxMessages: 10,
    totalMaxTokens: 4000,
  },
  
  ui: {
    streamingDelay: 20,  // ms between chunks
    typingSpeed: 50,     // chars per second
    autoCollapse: true,  // auto collapse after answer
  }
};
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¥æœŸ**: 2024-12-17  
**è´Ÿè´£äºº**: Zoey Gong  
**çŠ¶æ€**: ğŸ“‹ è§„åˆ’ä¸­

---

## æ€»ç»“

**AI ChatFlow æ˜¯ä¸€ä¸ªæå…·ä»·å€¼çš„åŠŸèƒ½**ï¼Œå»ºè®®ä¼˜å…ˆçº§ï¼šâ­â­â­â­â­

### ä¸ºä»€ä¹ˆè¦åšï¼Ÿ
1. âœ… æŠ€æœ¯å¯è¡Œæ€§é«˜ï¼ˆå·²æœ‰åŸºç¡€æ¡†æ¶ï¼‰
2. âœ… ç”¨æˆ·ä»·å€¼æ˜ç¡®ï¼ˆæ— ç¼é›†æˆã€è‡ªåŠ¨ä¿å­˜ï¼‰
3. âœ… å·®å¼‚åŒ–ç«äº‰åŠ›ï¼ˆToggle èŠ‚ç‚¹ + å¤šæ¨¡å‹ï¼‰
4. âœ… æˆæœ¬å¯æ§ï¼ˆæŒ‰éœ€è°ƒç”¨ï¼Œç”¨æˆ·è‡ªé… APIï¼‰

### å»ºè®®å®æ–½é¡ºåº
1. **MVP (2å‘¨)**ï¼šåŸºç¡€å¯¹è¯ + Toggle èŠ‚ç‚¹
2. **å¤šæ¨¡å‹ (1å‘¨)**ï¼šGPT-4/Claude/Gemini
3. **å¿«æ·å‘½ä»¤ (1å‘¨)**ï¼š`@ai.sum` ç­‰
4. **æ‰“ç£¨ (1å‘¨)**ï¼šUI/UX ä¼˜åŒ–

**æ€»è€—æ—¶ï¼š5å‘¨ï¼Œå³å¯ä¸Šçº¿å®Œæ•´åŠŸèƒ½ï¼** ğŸš€
